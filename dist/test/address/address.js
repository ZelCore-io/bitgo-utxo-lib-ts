"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getOutputScripts = exports.readFixture = void 0;
const path = require("path");
const assert = require("assert");
const utxolib = require("../../src");
const src_1 = require("../../src");
const testutil_1 = require("../../src/testutil");
const outputScripts_util_1 = require("../integration_local_rpc/generate/outputScripts.util");
const fixtureUtil = require("../fixture.util");
async function readFixture(network, suffix, defaultValue) {
    return await fixtureUtil.readFixture(path.join(__dirname, 'fixtures', `${utxolib.getNetworkName(network)}${suffix}.json`), defaultValue);
}
exports.readFixture = readFixture;
const keyTriples = Array.from({ length: 4 }).map((v, i) => (0, testutil_1.getKeyTriple)(`${i}`));
function getOutputScripts(network) {
    return keyTriples.flatMap((keys) => outputScripts_util_1.scriptTypes
        .filter((t) => (0, outputScripts_util_1.isSupportedDepositType)(network, t))
        .map((scriptType) => {
        return [scriptType, (0, outputScripts_util_1.createScriptPubKey)(keys, scriptType, network)];
    }));
}
exports.getOutputScripts = getOutputScripts;
function runWithAddressFormat(network, addressFormat) {
    describe(`network=${(0, src_1.getNetworkName)(network)}` + (addressFormat ? ` addressFormat=${addressFormat}` : ''), function () {
        let vectors;
        let refVectors;
        before('prepare fixtures', async function () {
            vectors = getOutputScripts(network).map(([scriptType, scriptPubKey]) => [
                scriptType,
                scriptPubKey.toString('hex'),
                addressFormat === undefined
                    ? utxolib.address.fromOutputScript(scriptPubKey, network)
                    : utxolib.addressFormat.fromOutputScriptWithFormat(scriptPubKey, addressFormat, network),
            ]);
            refVectors = await readFixture(network, (addressFormat !== null && addressFormat !== void 0 ? addressFormat : 'default') === 'default' ? '' : `-${addressFormat}`, vectors);
        });
        it('matches test vectors, parses to scriptPubKeyHex, implements toCanonicalFormat', function () {
            assert.strictEqual(vectors.length, refVectors.length);
            vectors.forEach((v, i) => {
                assert.deepStrictEqual(v, refVectors[i]);
                const [, scriptPubKeyHex, address] = v;
                if (!addressFormat || addressFormat === 'default') {
                    assert.strictEqual(utxolib.address.toOutputScript(address, network).toString('hex'), scriptPubKeyHex);
                }
                else {
                    assert.throws(() => {
                        utxolib.address.toOutputScript(address, network);
                    });
                    assert.strictEqual(utxolib.addressFormat.toOutputScriptWithFormat(address, addressFormat, network).toString('hex'), scriptPubKeyHex);
                }
                assert.strictEqual(utxolib.addressFormat.toCanonicalFormat(address, network), utxolib.address.fromOutputScript(Buffer.from(scriptPubKeyHex, 'hex'), network));
                if (network.bech32 && !address.startsWith(network.bech32)) {
                    const { hash, version } = utxolib.address.fromBase58Check(address, network);
                    assert.deepStrictEqual(utxolib.address.toBase58Check(hash, version, network), address);
                }
            });
        });
    });
}
describe('Address', function () {
    (0, src_1.getNetworkList)().forEach((network) => {
        const formats = utxolib.addressFormat.addressFormats.filter((f) => utxolib.addressFormat.isSupportedAddressFormat(f, network));
        [undefined, ...formats].forEach((f) => {
            runWithAddressFormat(network, f);
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWRkcmVzcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3Rlc3QvYWRkcmVzcy9hZGRyZXNzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLDZCQUE2QjtBQUM3QixpQ0FBaUM7QUFDakMscUNBQXFDO0FBQ3JDLG1DQUEyRDtBQUMzRCxpREFBa0Q7QUFFbEQsNkZBSzhEO0FBRzlELCtDQUErQztBQUl4QyxLQUFLLFVBQVUsV0FBVyxDQUFJLE9BQXdCLEVBQUUsTUFBYyxFQUFFLFlBQWU7SUFDNUYsT0FBTyxNQUFNLFdBQVcsQ0FBQyxXQUFXLENBQ2xDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLFVBQVUsRUFBRSxHQUFHLE9BQU8sQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLEdBQUcsTUFBTSxPQUFPLENBQUMsRUFDcEYsWUFBWSxDQUNiLENBQUM7QUFDSixDQUFDO0FBTEQsa0NBS0M7QUFFRCxNQUFNLFVBQVUsR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUUsTUFBTSxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsSUFBQSx1QkFBWSxFQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0FBRWpGLFNBQWdCLGdCQUFnQixDQUFDLE9BQXdCO0lBQ3ZELE9BQU8sVUFBVSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFLENBQ2pDLGdDQUFXO1NBQ1IsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxJQUFBLDJDQUFzQixFQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsQ0FBQztTQUNqRCxHQUFHLENBQUMsQ0FBQyxVQUFVLEVBQXdCLEVBQUU7UUFDeEMsT0FBTyxDQUFDLFVBQVUsRUFBRSxJQUFBLHVDQUFrQixFQUFDLElBQUksRUFBRSxVQUFVLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQztJ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Q3pELE1BQU0sRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxlQUFlLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDO29CQUM1RSxNQUFNLENBQUMsZUFBZSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLElBQUksRUFBRSxPQUFPLEVBQUUsT0FBTyxDQUFDLEVBQUUsT0FBTyxDQUFDLENBQUM7aUJBQ3hGO1lBQ0gsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FDRixDQUFDO0FBQ0osQ0FBQztBQUVELFFBQVEsQ0FBQyxTQUFTLEVBQUU7SUFDbEIsSUFBQSxvQkFBYyxHQUFFLENBQUMsT0FBTyxDQUFDLENBQUMsT0FBTyxFQUFFLEVBQUU7UUFDbkMsTUFBTSxPQUFPLEdBQUcsT0FBTyxDQUFDLGFBQWEsQ0FBQyxjQUFjLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FDaEUsT0FBTyxDQUFDLGFBQWEsQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDLEVBQUUsT0FBTyxDQUFDLENBQzNELENBQUM7UUFFRixDQUFDLFNBQVMsRUFBRSxHQUFHLE9BQU8sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFO1lBQ3BDLG9CQUFvQixDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsQ0FBQztRQUNuQyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xyXG5pbXBvcnQgKiBhcyBhc3NlcnQgZnJvbSAnYXNzZXJ0JztcclxuaW1wb3J0ICogYXMgdXR4b2xpYiBmcm9tICcuLi8uLi9zcmMnO1xyXG5pbXBvcnQgeyBnZXROZXR3b3JrTGlzdCwgZ2V0TmV0d29ya05hbWUgfSBmcm9tICcuLi8uLi9zcmMnO1xyXG5pbXBvcnQgeyBnZXRLZXlUcmlwbGUgfSBmcm9tICcuLi8uLi9zcmMvdGVzdHV0aWwnO1xyXG5cclxuaW1wb3J0IHtcclxuICBjcmVhdGVTY3JpcHRQdWJLZXksXHJcbiAgaXNTdXBwb3J0ZWREZXBvc2l0VHlwZSxcclxuICBTY3JpcHRUeXBlLFxyXG4gIHNjcmlwdFR5cGVzLFxyXG59IGZyb20gJy4uL2ludGVncmF0aW9uX2xvY2FsX3JwYy9nZW5lcmF0ZS9vdXRwdXRTY3JpcHRzLnV0aWwnO1xyXG5cclxuaW1wb3J0IHsgQWRkcmVzc0Zvcm1hdCB9IGZyb20gJy4uLy4uL3NyYy9hZGRyZXNzRm9ybWF0JztcclxuaW1wb3J0ICogYXMgZml4dHVyZVV0aWwgZnJvbSAnLi4vZml4dHVyZS51dGlsJztcclxuXHJcbmV4cG9ydCB0eXBlIEFkZHJlc3NUZXN0VmVjdG9yID0gW3NjcmlwdFR5cGU6IFNjcmlwdFR5cGUsIG91dHB1dFNjcmlwdEhleDogc3RyaW5nLCBhZGRyZXNzOiBzdHJpbmddO1xyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJlYWRGaXh0dXJlPFQ+KG5ldHdvcms6IHV0eG9saWIuTmV0d29yaywgc3VmZml4OiBzdHJpbmcsIGRlZmF1bHRWYWx1ZTogVCk6IFByb21pc2U8VD4ge1xyXG4gIHJldHVybiBhd2FpdCBmaXh0dXJlVXRpbC5yZWFkRml4dHVyZShcclxuICAgIHBhdGguam9pbihfX2Rpcm5hbWUsICdmaXh0dXJlcycsIGAke3V0eG9saWIuZ2V0TmV0d29ya05hbWUobmV0d29yayl9JHtzdWZmaXh9Lmpzb25gKSxcclxuICAgIGRlZmF1bHRWYWx1ZVxyXG4gICk7XHJcbn1cclxuXHJcbmNvbnN0IGtleVRyaXBsZXMgPSBBcnJheS5mcm9tKHsgbGVuZ3RoOiA0IH0pLm1hcCgodiwgaSkgPT4gZ2V0S2V5VHJpcGxlKGAke2l9YCkpO1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldE91dHB1dFNjcmlwdHMobmV0d29yazogdXR4b2xpYi5OZXR3b3JrKTogW1NjcmlwdFR5cGUsIEJ1ZmZlcl1bXSB7XHJcbiAgcmV0dXJuIGtleVRyaXBsZXMuZmxhdE1hcCgoa2V5cykgPT5cclxuICAgIHNjcmlwdFR5cGVzXHJcbiAgICAgIC5maWx0ZXIoKHQpID0+IGlzU3VwcG9ydGVkRGVwb3NpdFR5cGUobmV0d29yaywgdCkpXHJcbiAgICAgIC5tYXAoKHNjcmlwdFR5cGUpOiBbU2NyaXB0VHlwZSwgQnVmZmVyXSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIFtzY3JpcHRUeXBlLCBjcmVhdGVTY3JpcHRQdWJLZXkoa2V5cywgc2NyaXB0VHlwZSwgbmV0d29yayldO1xyXG4gICAgICB9KVxyXG4gICk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHJ1bldpdGhBZGRyZXNzRm9ybWF0KG5ldHdvcmssIGFkZHJlc3NGb3JtYXQ/OiBBZGRyZXNzRm9ybWF0KSB7XHJcbiAgZGVzY3JpYmUoXHJcbiAgICBgbmV0d29yaz0ke2dldE5ldHdvcmtOYW1lKG5ldHdvcmspfWAgKyAoYWRkcmVzc0Zvcm1hdCA/IGAgYWRkcmVzc0Zvcm1hdD0ke2FkZHJlc3NGb3JtYXR9YCA6ICcnKSxcclxuICAgIGZ1bmN0aW9uICgpIHtcclxuICAgICAgbGV0IHZlY3RvcnM6IEFkZHJlc3NUZXN0VmVjdG9yW107XHJcbiAgICAgIGxldCByZWZWZWN0b3JzOiBBZGRyZXNzVGVzdFZlY3RvcltdO1xyXG5cclxuICAgICAgYmVmb3JlKCdwcmVwYXJlIGZpeHR1cmVzJywgYXN5bmMgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZlY3RvcnMgPSBnZXRPdXRwdXRTY3JpcHRzKG5ldHdvcmspLm1hcChcclxuICAgICAgICAgIChbc2NyaXB0VHlwZSwgc2NyaXB0UHViS2V5XSk6IEFkZHJlc3NUZXN0VmVjdG9yID0+IFtcclxuICAgICAgICAgICAgc2NyaXB0VHlwZSxcclxuICAgICAgICAgICAgc2NyaXB0UHViS2V5LnRvU3RyaW5nKCdoZXgnKSxcclxuICAgICAgICAgICAgYWRkcmVzc0Zvcm1hdCA9PT0gdW5kZWZpbmVkXHJcbiAgICAgICAgICAgICAgPyB1dHhvbGliLmFkZHJlc3MuZnJvbU91dHB1dFNjcmlwdChzY3JpcHRQdWJLZXksIG5ldHdvcmspXHJcbiAgICAgICAgICAgICAgOiB1dHhvbGliLmFkZHJlc3NGb3JtYXQuZnJvbU91dHB1dFNjcmlwdFdpdGhGb3JtYXQoc2NyaXB0UHViS2V5LCBhZGRyZXNzRm9ybWF0LCBuZXR3b3JrKSxcclxuICAgICAgICAgIF1cclxuICAgICAgICApO1xyXG5cclxuICAgICAgICByZWZWZWN0b3JzID0gYXdhaXQgcmVhZEZpeHR1cmUoXHJcbiAgICAgICAgICBuZXR3b3JrLFxyXG4gICAgICAgICAgKGFkZHJlc3NGb3JtYXQgPz8gJ2RlZmF1bHQnKSA9PT0gJ2RlZmF1bHQnID8gJycgOiBgLSR7YWRkcmVzc0Zvcm1hdH1gLFxyXG4gICAgICAgICAgdmVjdG9yc1xyXG4gICAgICAgICk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgaXQoJ21hdGNoZXMgdGVzdCB2ZWN0b3JzLCBwYXJzZXMgdG8gc2NyaXB0UHViS2V5SGV4LCBpbXBsZW1lbnRzIHRvQ2Fub25pY2FsRm9ybWF0JywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGFzc2VydC5zdHJpY3RFcXVhbCh2ZWN0b3JzLmxlbmd0aCwgcmVmVmVjdG9ycy5sZW5ndGgpO1xyXG4gICAgICAgIHZlY3RvcnMuZm9yRWFjaCgodiwgaSkgPT4ge1xyXG4gICAgICAgICAgYXNzZXJ0LmRlZXBTdHJpY3RFcXVhbCh2LCByZWZWZWN0b3JzW2ldKTtcclxuICAgICAgICAgIGNvbnN0IFssIHNjcmlwdFB1YktleUhleCwgYWRkcmVzc10gPSB2O1xyXG5cclxuICAgICAgICAgIGlmICghYWRkcmVzc0Zvcm1hdCB8fCBhZGRyZXNzRm9ybWF0ID09PSAnZGVmYXVsdCcpIHtcclxuICAgICAgICAgICAgYXNzZXJ0LnN0cmljdEVxdWFsKHV0eG9saWIuYWRkcmVzcy50b091dHB1dFNjcmlwdChhZGRyZXNzLCBuZXR3b3JrKS50b1N0cmluZygnaGV4JyksIHNjcmlwdFB1YktleUhleCk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBhc3NlcnQudGhyb3dzKCgpID0+IHtcclxuICAgICAgICAgICAgICB1dHhvbGliLmFkZHJlc3MudG9PdXRwdXRTY3JpcHQoYWRkcmVzcywgbmV0d29yayk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBhc3NlcnQuc3RyaWN0RXF1YWwoXHJcbiAgICAgICAgICAgICAgdXR4b2xpYi5hZGRyZXNzRm9ybWF0LnRvT3V0cHV0U2NyaXB0V2l0aEZvcm1hdChhZGRyZXNzLCBhZGRyZXNzRm9ybWF0LCBuZXR3b3JrKS50b1N0cmluZygnaGV4JyksXHJcbiAgICAgICAgICAgICAgc2NyaXB0UHViS2V5SGV4XHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgYXNzZXJ0LnN0cmljdEVxdWFsKFxyXG4gICAgICAgICAgICB1dHhvbGliLmFkZHJlc3NGb3JtYXQudG9DYW5vbmljYWxGb3JtYXQoYWRkcmVzcywgbmV0d29yayksXHJcbiAgICAgICAgICAgIHV0eG9saWIuYWRkcmVzcy5mcm9tT3V0cHV0U2NyaXB0KEJ1ZmZlci5mcm9tKHNjcmlwdFB1YktleUhleCwgJ2hleCcpLCBuZXR3b3JrKVxyXG4gICAgICAgICAgKTtcclxuXHJcbiAgICAgICAgICBpZiAobmV0d29yay5iZWNoMzIgJiYgIWFkZHJlc3Muc3RhcnRzV2l0aChuZXR3b3JrLmJlY2gzMikpIHtcclxuICAgICAgICAgICAgY29uc3QgeyBoYXNoLCB2ZXJzaW9uIH0gPSB1dHhvbGliLmFkZHJlc3MuZnJvbUJhc2U1OENoZWNrKGFkZHJlc3MsIG5ldHdvcmspO1xyXG4gICAgICAgICAgICBhc3NlcnQuZGVlcFN0cmljdEVxdWFsKHV0eG9saWIuYWRkcmVzcy50b0Jhc2U1OENoZWNrKGhhc2gsIHZlcnNpb24sIG5ldHdvcmspLCBhZGRyZXNzKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgKTtcclxufVxyXG5cclxuZGVzY3JpYmUoJ0FkZHJlc3MnLCBmdW5jdGlvbiAoKSB7XHJcbiAgZ2V0TmV0d29ya0xpc3QoKS5mb3JFYWNoKChuZXR3b3JrKSA9PiB7XHJcbiAgICBjb25zdCBmb3JtYXRzID0gdXR4b2xpYi5hZGRyZXNzRm9ybWF0LmFkZHJlc3NGb3JtYXRzLmZpbHRlcigoZikgPT5cclxuICAgICAgdXR4b2xpYi5hZGRyZXNzRm9ybWF0LmlzU3VwcG9ydGVkQWRkcmVzc0Zvcm1hdChmLCBuZXR3b3JrKVxyXG4gICAgKTtcclxuXHJcbiAgICBbdW5kZWZpbmVkLCAuLi5mb3JtYXRzXS5mb3JFYWNoKChmKSA9PiB7XHJcbiAgICAgIHJ1bldpdGhBZGRyZXNzRm9ybWF0KG5ldHdvcmssIGYpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn0pO1xyXG4iXX0=