"use strict";
// OP_RETURN {aa21a9ed} {commitment}
Object.defineProperty(exports, "__esModule", { value: true });
exports.decode = exports.encode = exports.check = void 0;
const __1 = require("../../");
const __2 = require("../../");
const types = require("bitcoinjs-lib/src/types");
const typeforce = require('typeforce');
const HEADER = Buffer.from('aa21a9ed', 'hex');
function check(script) {
    const buffer = __1.script.compile(script);
    return (buffer.length > 37 && buffer[0] === __2.opcodes.OP_RETURN && buffer[1] === 0x24 && buffer.slice(2, 6).equals(HEADER));
}
exports.check = check;
check.toJSON = () => {
    return 'Witness commitment output';
};
function encode(commitment) {
    typeforce(types.Hash256bit, commitment);
    const buffer = Buffer.allocUnsafe(36);
    HEADER.copy(buffer, 0);
    commitment.copy(buffer, 4);
    return __1.script.compile([__2.opcodes.OP_RETURN, buffer]);
}
exports.encode = encode;
function decode(buffer) {
    typeforce(check, buffer);
    return __1.script.decompile(buffer)[1].slice(4, 36);
}
exports.decode = decode;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3V0cHV0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL3RlbXBsYXRlcy93aXRuZXNzY29tbWl0bWVudC9vdXRwdXQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLG9DQUFvQzs7O0FBRXBDLDhCQUEyQztBQUMzQyw4QkFBaUM7QUFDakMsaURBQWlEO0FBRWpELE1BQU0sU0FBUyxHQUFHLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQztBQUV2QyxNQUFNLE1BQU0sR0FBVyxNQUFNLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxLQUFLLENBQUMsQ0FBQztBQUV0RCxTQUFnQixLQUFLLENBQUMsTUFBdUM7SUFDM0QsTUFBTSxNQUFNLEdBQUcsVUFBTyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUV2QyxPQUFPLENBQ0wsTUFBTSxDQUFDLE1BQU0sR0FBRyxFQUFFLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxLQUFLLFdBQU8sQ0FBQyxTQUFTLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxLQUFLLElBQUksSUFBSSxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQ2pILENBQUM7QUFDSixDQUFDO0FBTkQsc0JBTUM7QUFFRCxLQUFLLENBQUMsTUFBTSxHQUFHLEdBQVcsRUFBRTtJQUMxQixPQUFPLDJCQUEyQixDQUFDO0FBQ3JDLENBQUMsQ0FBQztBQUVGLFNBQWdCLE1BQU0sQ0FBQyxVQUFrQjtJQUN2QyxTQUFTLENBQUMsS0FBSyxDQUFDLFVBQVUsRUFBRSxVQUFVLENBQUMsQ0FBQztJQUV4QyxNQUFNLE1BQU0sR0FBRyxNQUFNLENBQUMsV0FBVyxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ3RDLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQ3ZCLFVBQVUsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBRTNCLE9BQU8sVUFBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDLFdBQU8sQ0FBQyxTQUFTLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQztBQUN0RCxDQUFDO0FBUkQsd0JBUUM7QUFFRCxTQUFnQixNQUFNLENBQUMsTUFBYztJQUNuQyxTQUFTLENBQUMsS0FBSyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBRXpCLE9BQVEsVUFBTyxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUUsQ0FBQyxDQUFDLENBQVksQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0FBQ2hFLENBQUM7QUFKRCx3QkFJQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIE9QX1JFVFVSTiB7YWEyMWE5ZWR9IHtjb21taXRtZW50fVxyXG5cclxuaW1wb3J0IHsgc2NyaXB0IGFzIGJzY3JpcHQgfSBmcm9tICcuLi8uLi8nO1xyXG5pbXBvcnQgeyBvcGNvZGVzIH0gZnJvbSAnLi4vLi4vJztcclxuaW1wb3J0ICogYXMgdHlwZXMgZnJvbSAnYml0Y29pbmpzLWxpYi9zcmMvdHlwZXMnO1xyXG5cclxuY29uc3QgdHlwZWZvcmNlID0gcmVxdWlyZSgndHlwZWZvcmNlJyk7XHJcblxyXG5jb25zdCBIRUFERVI6IEJ1ZmZlciA9IEJ1ZmZlci5mcm9tKCdhYTIxYTllZCcsICdoZXgnKTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjaGVjayhzY3JpcHQ6IEJ1ZmZlciB8IEFycmF5PG51bWJlciB8IEJ1ZmZlcj4pOiBib29sZWFuIHtcclxuICBjb25zdCBidWZmZXIgPSBic2NyaXB0LmNvbXBpbGUoc2NyaXB0KTtcclxuXHJcbiAgcmV0dXJuIChcclxuICAgIGJ1ZmZlci5sZW5ndGggPiAzNyAmJiBidWZmZXJbMF0gPT09IG9wY29kZXMuT1BfUkVUVVJOICYmIGJ1ZmZlclsxXSA9PT0gMHgyNCAmJiBidWZmZXIuc2xpY2UoMiwgNikuZXF1YWxzKEhFQURFUilcclxuICApO1xyXG59XHJcblxyXG5jaGVjay50b0pTT04gPSAoKTogc3RyaW5nID0+IHtcclxuICByZXR1cm4gJ1dpdG5lc3MgY29tbWl0bWVudCBvdXRwdXQnO1xyXG59O1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGVuY29kZShjb21taXRtZW50OiBCdWZmZXIpOiBCdWZmZXIge1xyXG4gIHR5cGVmb3JjZSh0eXBlcy5IYXNoMjU2Yml0LCBjb21taXRtZW50KTtcclxuXHJcbiAgY29uc3QgYnVmZmVyID0gQnVmZmVyLmFsbG9jVW5zYWZlKDM2KTtcclxuICBIRUFERVIuY29weShidWZmZXIsIDApO1xyXG4gIGNvbW1pdG1lbnQuY29weShidWZmZXIsIDQpO1xyXG5cclxuICByZXR1cm4gYnNjcmlwdC5jb21waWxlKFtvcGNvZGVzLk9QX1JFVFVSTiwgYnVmZmVyXSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBkZWNvZGUoYnVmZmVyOiBCdWZmZXIpOiBCdWZmZXIge1xyXG4gIHR5cGVmb3JjZShjaGVjaywgYnVmZmVyKTtcclxuXHJcbiAgcmV0dXJuIChic2NyaXB0LmRlY29tcGlsZShidWZmZXIpIVsxXSBhcyBCdWZmZXIpLnNsaWNlKDQsIDM2KTtcclxufVxyXG4iXX0=