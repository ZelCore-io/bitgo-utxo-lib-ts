"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const assert = require("assert");
const bitgo_1 = require("../../../src/bitgo");
const testutil_1 = require("../../../src/testutil");
const Musig2_1 = require("../../../src/bitgo/Musig2");
const outputScripts_1 = require("../../../src/bitgo/outputScripts");
const Musig2Util_1 = require("./Musig2Util");
const p2trMusig2Unspent = (0, Musig2Util_1.getUnspents)(['p2trMusig2'], Musig2Util_1.rootWalletKeys);
const outputType = 'p2trMusig2';
const CHANGE_INDEX = 100;
describe('p2trMusig2', function () {
    describe('p2trMusig2 key path', function () {
        it(`create psbt, nonces, sign (internal verify) - success`, function () {
            const walletKeys = Musig2Util_1.rootWalletKeys.deriveForChainAndIndex((0, bitgo_1.getExternalChainCode)('p2trMusig2'), 0);
            const unspents = (0, Musig2Util_1.getUnspents)(outputScripts_1.scriptTypes2Of3.map((t) => t), Musig2Util_1.rootWalletKeys);
            // WP creates PSBT during build API, serializes it, and sends the psbt to user
            const buildPsbt = (0, Musig2Util_1.constructPsbt)(unspents, Musig2Util_1.rootWalletKeys, 'bitgo', 'user', outputType);
            const buildPsbtSer = buildPsbt.toHex();
            // User de-serialises the psbt, ands the user nonce, and sends it to the hsm so that it can add the bitgo nonce
            const userPsbt = (0, bitgo_1.createPsbtFromHex)(buildPsbtSer, Musig2Util_1.network);
            userPsbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.user);
            const userPsbtSer = userPsbt.toHex();
            // HSM deserializes the user psbt, adds the deterministic bitgo nonce, and sends that back to the user
            const bitgoPsbt = (0, bitgo_1.createPsbtFromHex)(userPsbtSer, Musig2Util_1.network);
            bitgoPsbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.bitgo, { deterministic: true });
            const bitgoPsbtSer = bitgoPsbt.toHex();
            // User combines the psbt with the bitgo nonce, adds user signature, and sends half-signed to hsm
            const bitgoPsbtDeser = (0, bitgo_1.createPsbtFromHex)(bitgoPsbtSer, Musig2Util_1.network);
            userPsbt.combine(bitgoPsbtDeser);
            userPsbt.signAllInputsHD(Musig2Util_1.rootWalletKeys.user);
            const userPsbtHalfSignedHex = userPsbt.toHex();
            // WP de-serialises the psbt and validates user sig
            const userPsbtDes = (0, bitgo_1.createPsbtFromHex)(userPsbtHalfSignedHex, Musig2Util_1.network);
            assert.ok(userPsbtDes.validateTaprootMusig2SignaturesOfInput(4, walletKeys.user.publicKey));
            // WP sends to hsm for signature and returns a fully signed psbt
            const psbt = (0, bitgo_1.createPsbtFromHex)(userPsbtHalfSignedHex, Musig2Util_1.network);
            psbt.signAllInputsHD(Musig2Util_1.rootWalletKeys.bitgo, { deterministic: true });
            unspents.forEach((unspent, index) => {
                if ((0, bitgo_1.scriptTypeForChain)(unspent.chain) !== 'p2trMusig2') {
                    assert.strictEqual(psbt.getProprietaryKeyVals(index).length, 0);
                    return;
                }
                (0, Musig2Util_1.validatePsbtP2trMusig2Input)(psbt, index, unspent, 'keyPath');
                (0, Musig2Util_1.validatePsbtP2trMusig2Output)(psbt, 0);
                (0, Musig2Util_1.validateParticipantsKeyVals)(psbt, index, unspent);
                (0, Musig2Util_1.validateNoncesKeyVals)(psbt, index, unspent);
                (0, Musig2Util_1.validatePartialSigKeyVals)(psbt, index, unspent);
            });
            assert.ok(psbt.validateSignaturesOfAllInputs());
            psbt.finalizeAllInputs();
            unspents.forEach((unspent, index) => {
                (0, Musig2Util_1.validateFinalizedInput)(psbt, index, unspent);
            });
            const tx = psbt.extractTransaction();
            assert.ok((0, testutil_1.verifyFullySignedSignatures)(tx, unspents, Musig2Util_1.rootWalletKeys, 'bitgo', 'user'));
            unspents.map((unspent, inputIndex) => {
                assert.deepStrictEqual((0, bitgo_1.verifySignatureWithUnspent)(tx, inputIndex, unspents, Musig2Util_1.rootWalletKeys), [
                    true,
                    false,
                    true,
                ]);
            });
        });
        it(`parse tx`, function () {
            const psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'bitgo', 'user', outputType);
            (0, Musig2Util_1.validateParsedTaprootKeyPathPsbt)(psbt, 0, 'unsigned');
            psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.user);
            psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.bitgo);
            psbt.signAllInputsHD(Musig2Util_1.rootWalletKeys.user);
            (0, Musig2Util_1.validateParsedTaprootKeyPathPsbt)(psbt, 0, 'halfsigned');
            psbt.signAllInputsHD(Musig2Util_1.rootWalletKeys.bitgo);
            (0, Musig2Util_1.validateParsedTaprootKeyPathPsbt)(psbt, 0, 'fullysigned');
            psbt.finalizeAllInputs();
            assert.throws(() => (0, bitgo_1.parsePsbtInput)(psbt.data.inputs[0]), (e) => e.message === 'Finalized PSBT parsing is not supported');
            const tx = psbt.extractTransaction();
            (0, Musig2Util_1.validateParsedTaprootKeyPathTxInput)(psbt, tx);
        });
        describe('create nonce', function () {
            it(`update with new nonce should be allowed`, function () {
                const psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'bitgo', 'p2sh');
                psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.user);
                let noncesKeyVals = psbt.getProprietaryKeyVals(0, {
                    identifier: bitgo_1.PSBT_PROPRIETARY_IDENTIFIER,
                    subtype: bitgo_1.ProprietaryKeySubtype.MUSIG2_PUB_NONCE,
                });
                assert.strictEqual(noncesKeyVals.length, 1);
                const userNonceKey = noncesKeyVals[0].key.keydata;
                const userNonceValue = noncesKeyVals[0].value;
                psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.bitgo);
                psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.user);
                noncesKeyVals = psbt.getProprietaryKeyVals(0, {
                    identifier: bitgo_1.PSBT_PROPRIETARY_IDENTIFIER,
                    subtype: bitgo_1.ProprietaryKeySubtype.MUSIG2_PUB_NONCE,
                });
                assert.strictEqual(noncesKeyVals.length, 2);
                noncesKeyVals = noncesKeyVals.filter((kv) => kv.key.keydata.equals(userNonceKey));
                assert.strictEqual(noncesKeyVals.length, 1);
                assert.ok(!noncesKeyVals[0].value.equals(userNonceValue));
            });
            it(`Cosigner nonce creation fail should not enforce the signer to recreate nonce`, function () {
                const psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'bitgo', 'p2sh');
                psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.user);
                const tapBip32Derivation = psbt.data.inputs[0].tapBip32Derivation;
                psbt.data.inputs[0].tapBip32Derivation = undefined;
                assert.throws(() => psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.bitgo), (e) => e.message === 'tapBip32Derivation is required to create nonce');
                psbt.data.inputs[0].tapBip32Derivation = tapBip32Derivation;
                psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.bitgo);
                psbt.signAllInputsHD(Musig2Util_1.rootWalletKeys.user);
                psbt.signAllInputsHD(Musig2Util_1.rootWalletKeys.bitgo);
                const noncesKeyVals = psbt.getProprietaryKeyVals(0, {
                    identifier: bitgo_1.PSBT_PROPRIETARY_IDENTIFIER,
                    subtype: bitgo_1.ProprietaryKeySubtype.MUSIG2_PUB_NONCE,
                });
                assert.strictEqual(noncesKeyVals.length, 2);
                const partialSigKeyVals = psbt.getProprietaryKeyVals(0, {
                    identifier: bitgo_1.PSBT_PROPRIETARY_IDENTIFIER,
                    subtype: bitgo_1.ProprietaryKeySubtype.MUSIG2_PARTIAL_SIG,
                });
                assert.strictEqual(partialSigKeyVals.length, 2);
                const participantKeyVals = psbt.getProprietaryKeyVals(0, {
                    identifier: bitgo_1.PSBT_PROPRIETARY_IDENTIFIER,
                    subtype: bitgo_1.ProprietaryKeySubtype.MUSIG2_PARTICIPANT_PUB_KEYS,
                });
                assert.strictEqual(participantKeyVals.length, 1);
            });
            it('Cosigner can create a deterministic nonce', function () {
                const psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'bitgo', 'p2sh');
                psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.user);
                psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.bitgo, { deterministic: true });
                const noncesKeyVals = psbt.getProprietaryKeyVals(0, {
                    identifier: bitgo_1.PSBT_PROPRIETARY_IDENTIFIER,
                    subtype: bitgo_1.ProprietaryKeySubtype.MUSIG2_PUB_NONCE,
                });
                assert.strictEqual(noncesKeyVals.length, 2);
            });
            it('Cosigner cannot create a deterministic nonce if there is no signer nonce', function () {
                const psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'bitgo', 'p2sh');
                assert.throws(() => psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.bitgo, { deterministic: true }), (e) => e.message === 'No nonces found on input #0');
                let noncesKeyVals = psbt.getProprietaryKeyVals(0, {
                    identifier: bitgo_1.PSBT_PROPRIETARY_IDENTIFIER,
                    subtype: bitgo_1.ProprietaryKeySubtype.MUSIG2_PUB_NONCE,
                });
                assert.strictEqual(noncesKeyVals.length, 0);
                psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.bitgo);
                assert.throws(() => psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.bitgo, { deterministic: true }), (e) => e.message === 'signer nonce must be set if cosigner nonce is to be derived deterministically');
                noncesKeyVals = psbt.getProprietaryKeyVals(0, {
                    identifier: bitgo_1.PSBT_PROPRIETARY_IDENTIFIER,
                    subtype: bitgo_1.ProprietaryKeySubtype.MUSIG2_PUB_NONCE,
                });
                assert.strictEqual(noncesKeyVals.length, 1);
            });
            it('Cosigner cannot add entropy to deterministic nonce creation', function () {
                const psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'bitgo', 'p2sh');
                psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.user);
                assert.throws(() => psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.bitgo, {
                    deterministic: true,
                    sessionId: Buffer.allocUnsafe(32),
                }), (e) => e.message === 'Cannot add extra entropy when generating a deterministic nonce');
                const noncesKeyVals = psbt.getProprietaryKeyVals(0, {
                    identifier: bitgo_1.PSBT_PROPRIETARY_IDENTIFIER,
                    subtype: bitgo_1.ProprietaryKeySubtype.MUSIG2_PUB_NONCE,
                });
                assert.strictEqual(noncesKeyVals.length, 1);
            });
            it('Signer cannot create a deterministic nonce', function () {
                const psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'bitgo', 'p2sh');
                assert.throws(() => psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.user, { deterministic: true }), (e) => e.message === `Only the cosigner's nonce can be set deterministically`);
                const noncesKeyVals = psbt.getProprietaryKeyVals(0, {
                    identifier: bitgo_1.PSBT_PROPRIETARY_IDENTIFIER,
                    subtype: bitgo_1.ProprietaryKeySubtype.MUSIG2_PUB_NONCE,
                });
                assert.strictEqual(noncesKeyVals.length, 0);
            });
            it(`skipped if tapInternalKey doesn't match participant pub keys agg`, function () {
                const psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'bitgo', 'p2sh');
                psbt.data.inputs[0].tapInternalKey = Musig2Util_1.dummyTapInternalKey;
                assert.throws(() => psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.user), (e) => e.message === 'tapInternalKey and aggregated participant pub keys does not match');
                assert.strictEqual(psbt.getProprietaryKeyVals(0).length, 1);
            });
            it(`fails if sessionId size is invalid`, function () {
                const psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'bitgo', 'p2sh');
                assert.throws(() => psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.user, { sessionId: Buffer.allocUnsafe(33) }), (e) => e.message === 'Invalid sessionId size 33');
                assert.strictEqual(psbt.getProprietaryKeyVals(0).length, 1);
            });
            it(`fails if private key is missing`, function () {
                const psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'bitgo', 'p2sh');
                assert.throws(() => psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.user.neutered()), (e) => e.message === 'private key is required to generate nonce');
                assert.strictEqual(psbt.getProprietaryKeyVals(0).length, 1);
            });
            it(`fails if tapBip32Derivation is missing`, function () {
                const psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'bitgo', 'p2sh');
                psbt.data.inputs[0].tapBip32Derivation = [];
                assert.throws(() => psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.user), (e) => e.message === 'tapBip32Derivation is required to create nonce');
                assert.strictEqual(psbt.getProprietaryKeyVals(0).length, 1);
            });
            it(`fails if participant pub keys is missing`, function () {
                const psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'bitgo', 'p2sh');
                psbt.data.inputs[0].unknownKeyVals = [];
                assert.throws(() => psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.user), (e) => e.message === 'Found 0 matching participant key value instead of 1');
                assert.strictEqual(psbt.getProprietaryKeyVals(0).length, 0);
            });
            it(`fails if participant pub keys keydata size is invalid`, function () {
                const psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'bitgo', 'p2sh');
                const keyVals = psbt.getProprietaryKeyVals(0);
                keyVals[0].key.keydata = Buffer.concat([keyVals[0].key.keydata, Buffer.from('dummy')]);
                psbt.data.inputs[0].unknownKeyVals = [];
                psbt.addProprietaryKeyValToInput(0, keyVals[0]);
                assert.throws(() => psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.user), (e) => e.message === `Invalid keydata size ${keyVals[0].key.keydata.length} for participant pub keys`);
                assert.strictEqual(psbt.getProprietaryKeyVals(0).length, 1);
            });
            it(`fails if participant keydata tapOutputKey in invalid`, function () {
                const psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'bitgo', 'p2sh');
                const keyVals = psbt.getProprietaryKeyVals(0);
                keyVals[0].key.keydata = Buffer.concat([Musig2Util_1.dummyTapOutputKey, keyVals[0].key.keydata.subarray(32)]);
                psbt.data.inputs[0].unknownKeyVals = [];
                psbt.addProprietaryKeyValToInput(0, keyVals[0]);
                assert.throws(() => psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.user), (e) => e.message === `Invalid participants keydata tapOutputKey`);
                assert.strictEqual(psbt.getProprietaryKeyVals(0).length, 1);
            });
            it(`fails if participant keydata tapInternalKey in invalid`, function () {
                const psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'bitgo', 'p2sh');
                const keyVals = psbt.getProprietaryKeyVals(0);
                keyVals[0].key.keydata = Buffer.concat([keyVals[0].key.keydata.subarray(0, 32), Musig2Util_1.dummyTapInternalKey]);
                psbt.data.inputs[0].unknownKeyVals = [];
                psbt.addProprietaryKeyValToInput(0, keyVals[0]);
                assert.throws(() => psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.user), (e) => e.message === `Invalid participants keydata tapInternalKey`);
                assert.strictEqual(psbt.getProprietaryKeyVals(0).length, 1);
            });
            it(`fails if tapInternalKey and aggregated participant pub keys don't match`, function () {
                const psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'bitgo', 'p2sh');
                const keyVals = psbt.getProprietaryKeyVals(0);
                const walletKeys = Musig2Util_1.rootWalletKeys.deriveForChainAndIndex((0, bitgo_1.getInternalChainCode)('p2trMusig2'), 1);
                const tapInternalKey = (0, Musig2_1.createTapInternalKey)([walletKeys.user.publicKey, walletKeys.bitgo.publicKey]);
                const tapOutputKey = (0, Musig2_1.createTapOutputKey)(tapInternalKey, psbt.data.inputs[0].tapMerkleRoot);
                keyVals[0].key.keydata = Buffer.concat([tapOutputKey, tapInternalKey]);
                keyVals[0].value = Buffer.concat([walletKeys.user.publicKey, walletKeys.bitgo.publicKey]);
                psbt.data.inputs[0].unknownKeyVals = [];
                psbt.addProprietaryKeyValToInput(0, keyVals[0]);
                assert.throws(() => psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.user), (e) => e.message === `tapInternalKey and aggregated participant pub keys does not match`);
                assert.strictEqual(psbt.getProprietaryKeyVals(0).length, 1);
            });
            it(`fails if keydata size of participant pub keys is invalid`, function () {
                const psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'bitgo', 'p2sh');
                const keyVals = psbt.getProprietaryKeyVals(0);
                keyVals[0].key.keydata = Buffer.allocUnsafe(65);
                psbt.data.inputs[0].unknownKeyVals = [];
                psbt.addProprietaryKeyValToInput(0, keyVals[0]);
                assert.throws(() => psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.user), (e) => e.message === `Invalid keydata size 65 for participant pub keys`);
                assert.strictEqual(psbt.getProprietaryKeyVals(0).length, 1);
            });
            it(`fails if valuedata size of participant pub keys is invalid`, function () {
                const psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'bitgo', 'p2sh');
                const keyVals = psbt.getProprietaryKeyVals(0);
                keyVals[0].value = Buffer.allocUnsafe(67);
                psbt.data.inputs[0].unknownKeyVals = [];
                psbt.addProprietaryKeyValToInput(0, keyVals[0]);
                assert.throws(() => psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.user), (e) => e.message === `Invalid valuedata size 67 for participant pub keys`);
                assert.strictEqual(psbt.getProprietaryKeyVals(0).length, 1);
            });
            it(`fails if duplicate participant pub keys found`, function () {
                const psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'bitgo', 'p2sh');
                const keyVals = psbt.getProprietaryKeyVals(0);
                keyVals[0].value = Buffer.concat([keyVals[0].value.subarray(33), keyVals[0].value.subarray(33)]);
                psbt.data.inputs[0].unknownKeyVals = [];
                psbt.addProprietaryKeyValToInput(0, keyVals[0]);
                assert.throws(() => psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.user), (e) => e.message === `Duplicate participant pub keys found`);
                assert.strictEqual(psbt.getProprietaryKeyVals(0).length, 1);
            });
            it(`fails if no fingerprint match`, function () {
                var _a;
                const psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'bitgo', 'p2sh');
                (_a = psbt.data.inputs[0].tapBip32Derivation) === null || _a === void 0 ? void 0 : _a.forEach((bv) => (bv.masterFingerprint = Buffer.allocUnsafe(4)));
                assert.throws(() => psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.user), (e) => e.message === 'No bip32Derivation masterFingerprint matched the HD keyPair fingerprint');
                assert.strictEqual(psbt.getProprietaryKeyVals(0).length, 1);
            });
            it(`fails if pubkey did not match tapBip32Derivation`, function () {
                var _a;
                const psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'bitgo', 'p2sh');
                const walletKeys = Musig2Util_1.rootWalletKeys.deriveForChainAndIndex((0, bitgo_1.getInternalChainCode)('p2trMusig2'), CHANGE_INDEX);
                (_a = psbt.data.inputs[0].tapBip32Derivation) === null || _a === void 0 ? void 0 : _a.forEach((bv) => {
                    bv.path = walletKeys.paths[2];
                });
                assert.throws(() => psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.user), (e) => e.message === 'pubkey did not match bip32Derivation');
                assert.strictEqual(psbt.getProprietaryKeyVals(0).length, 1);
            });
            it(`fails if root wallet key derive more than one tapBip32Derivation`, function () {
                var _a;
                const psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'bitgo', 'p2sh');
                const walletKeys = Musig2Util_1.rootWalletKeys.deriveForChainAndIndex(p2trMusig2Unspent[0].chain, p2trMusig2Unspent[0].index);
                (_a = psbt.data.inputs[0].tapBip32Derivation) === null || _a === void 0 ? void 0 : _a.forEach((bv, index) => {
                    bv.path = walletKeys.paths[0];
                    bv.pubkey = (0, outputScripts_1.toXOnlyPublicKey)(walletKeys.publicKeys[0]);
                    bv.masterFingerprint = Musig2Util_1.rootWalletKeys.user.fingerprint;
                });
                assert.throws(() => psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.user), (e) => e.message.startsWith('more than one matching derivation for fingerprint'));
                assert.strictEqual(psbt.getProprietaryKeyVals(0).length, 1);
            });
            it(`fails if derived wallet key does not match any participant key`, function () {
                const psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'bitgo', 'p2sh');
                const keyVals = psbt.getProprietaryKeyVals(0);
                const walletKeys = Musig2Util_1.rootWalletKeys.deriveForChainAndIndex((0, bitgo_1.getInternalChainCode)('p2trMusig2'), 1);
                const tapInternalKey = (0, Musig2_1.createTapInternalKey)([walletKeys.user.publicKey, walletKeys.bitgo.publicKey]);
                psbt.data.inputs[0].tapInternalKey = tapInternalKey;
                keyVals[0].value = Buffer.concat([walletKeys.user.publicKey, walletKeys.bitgo.publicKey]);
                const tapOutputKey = (0, Musig2_1.createTapOutputKey)(tapInternalKey, psbt.data.inputs[0].tapMerkleRoot);
                keyVals[0].key.keydata = Buffer.concat([tapOutputKey, tapInternalKey]);
                psbt.data.inputs[0].unknownKeyVals = [];
                psbt.addProprietaryKeyValToInput(0, keyVals[0]);
                assert.throws(() => psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.user), (e) => e.message === `participant plain pub key should match one bip32Derivation plain pub key`);
                assert.strictEqual(psbt.getProprietaryKeyVals(0).length, 1);
            });
        });
        describe('sign', function () {
            it(`fails if privateKey is missing`, function () {
                const psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'bitgo', 'p2sh');
                psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.user);
                psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.bitgo);
                assert.throws(() => psbt.signTaprootInputHD(0, Musig2Util_1.rootWalletKeys.user.neutered()), (e) => e.message === 'privateKey is required to sign p2tr musig2');
                assert.strictEqual(psbt.getProprietaryKeyVals(0).length, 3);
            });
            it(`fails if tapInternalKey is missing`, function () {
                const psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'bitgo', 'p2sh');
                const walletKeys = Musig2Util_1.rootWalletKeys.deriveForChainAndIndex(p2trMusig2Unspent[0].chain, p2trMusig2Unspent[0].index);
                psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.user);
                psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.bitgo);
                psbt.data.inputs[0].tapInternalKey = undefined;
                assert.throws(() => psbt.signTaprootMusig2Input(0, {
                    publicKey: walletKeys.user.publicKey,
                    privateKey: walletKeys.user.privateKey,
                }), (e) => e.message === 'not a taproot musig2 input');
                assert.strictEqual(psbt.getProprietaryKeyVals(0).length, 3);
            });
            it('only the cosigner can add a deterministic signature', function () {
                const psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'bitgo', 'p2sh');
                psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.user);
                psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.bitgo, { deterministic: true });
                assert.throws(() => psbt.signInputHD(0, Musig2Util_1.rootWalletKeys.user, { deterministic: true }), (e) => e.message === 'can only add a deterministic signature on the cosigner');
            });
            it('cosigner can sign deterministically', function () {
                const psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'bitgo', 'p2sh');
                psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.user);
                psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.bitgo, { deterministic: true });
                psbt.signAllInputsHD(Musig2Util_1.rootWalletKeys.user);
                psbt.signAllInputsHD(Musig2Util_1.rootWalletKeys.bitgo, { deterministic: true });
                assert.ok(psbt.validateSignaturesOfAllInputs());
                assert.ok(psbt.finalizeAllInputs());
            });
            it('cosigner can sign non-deterministically', function () {
                const psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'bitgo', 'p2sh');
                psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.user);
                psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.bitgo, { deterministic: false });
                psbt.signAllInputsHD(Musig2Util_1.rootWalletKeys.user);
                psbt.signAllInputsHD(Musig2Util_1.rootWalletKeys.bitgo, { deterministic: false });
                assert.ok(psbt.validateSignaturesOfAllInputs());
                assert.ok(psbt.finalizeAllInputs());
            });
        });
        it(`fails if tapMerkleRoot is missing`, function () {
            const psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'bitgo', 'p2sh');
            const walletKeys = Musig2Util_1.rootWalletKeys.deriveForChainAndIndex(p2trMusig2Unspent[0].chain, p2trMusig2Unspent[0].index);
            psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.user);
            psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.bitgo);
            psbt.data.inputs[0].tapMerkleRoot = undefined;
            assert.throws(() => psbt.signTaprootMusig2Input(0, {
                publicKey: walletKeys.user.publicKey,
                privateKey: walletKeys.user.privateKey,
            }), (e) => e.message === 'not a taproot musig2 input');
            assert.strictEqual(psbt.getProprietaryKeyVals(0).length, 3);
        });
        it(`fails if participant pub keys is missing`, function () {
            const psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'bitgo', 'p2sh');
            psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.user);
            psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.bitgo);
            psbt.data.inputs[0].unknownKeyVals = [];
            assert.throws(() => psbt.signTaprootInputHD(0, Musig2Util_1.rootWalletKeys.user), (e) => e.message === 'Found 0 matching participant key value instead of 1');
            assert.strictEqual(psbt.getProprietaryKeyVals(0).length, 0);
        });
        it(`fails if signer pub key is not matching any participant pub keys`, function () {
            const psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'bitgo', 'p2sh');
            psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.user);
            psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.bitgo);
            assert.throws(() => psbt.signTaprootMusig2Input(0, {
                privateKey: Musig2Util_1.rootWalletKeys.backup.privateKey,
                publicKey: Musig2Util_1.rootWalletKeys.backup.publicKey,
            }), (e) => e.message === 'signer pub key should match one of participant pub keys');
            assert.strictEqual(psbt.getProprietaryKeyVals(0).length, 3);
        });
        it(`fails if more than 2 nonce key value exists`, function () {
            var _a;
            const psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'bitgo', 'p2sh');
            psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.user);
            psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.bitgo);
            (_a = psbt.data.inputs[0].unknownKeyVals) === null || _a === void 0 ? void 0 : _a.push(psbt.data.inputs[0].unknownKeyVals[2]);
            assert.throws(() => psbt.signTaprootInputHD(0, Musig2Util_1.rootWalletKeys.user), (e) => e.message === 'Found 3 matching nonce key value instead of 1 or 2');
            assert.strictEqual(psbt.getProprietaryKeyVals(0).length, 4);
        });
        it(`fails if 2 nonce key value do not exist`, function () {
            var _a;
            const psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'bitgo', 'p2sh');
            psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.user);
            psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.bitgo);
            (_a = psbt.data.inputs[0].unknownKeyVals) === null || _a === void 0 ? void 0 : _a.splice(2);
            assert.throws(() => psbt.signTaprootInputHD(0, Musig2Util_1.rootWalletKeys.user), (e) => e.message === 'Found 1 matching nonce key value instead of 2');
            assert.strictEqual(psbt.getProprietaryKeyVals(0).length, 2);
        });
        it(`fails if nonce keydata size is invalid`, function () {
            var _a;
            const psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'bitgo', 'p2sh');
            psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.user);
            psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.bitgo);
            const keyVals = psbt.getProprietaryKeyVals(0, {
                identifier: bitgo_1.PSBT_PROPRIETARY_IDENTIFIER,
                subtype: bitgo_1.ProprietaryKeySubtype.MUSIG2_PUB_NONCE,
            });
            keyVals[1].key.keydata = Buffer.concat([keyVals[1].key.keydata, Buffer.from('dummy')]);
            (_a = psbt.data.inputs[0].unknownKeyVals) === null || _a === void 0 ? void 0 : _a.splice(2);
            psbt.addProprietaryKeyValToInput(0, keyVals[1]);
            assert.throws(() => psbt.signTaprootInputHD(0, Musig2Util_1.rootWalletKeys.user), (e) => e.message === `Invalid keydata size ${keyVals[1].key.keydata.length} for nonce`);
            assert.strictEqual(psbt.getProprietaryKeyVals(0).length, 3);
        });
        it(`fails if nonce valuedata size is invalid`, function () {
            var _a;
            const psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'bitgo', 'p2sh');
            psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.user);
            psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.bitgo);
            const keyVals = psbt.getProprietaryKeyVals(0, {
                identifier: bitgo_1.PSBT_PROPRIETARY_IDENTIFIER,
                subtype: bitgo_1.ProprietaryKeySubtype.MUSIG2_PUB_NONCE,
            });
            keyVals[1].value = Buffer.concat([keyVals[1].value, Buffer.from('dummy')]);
            (_a = psbt.data.inputs[0].unknownKeyVals) === null || _a === void 0 ? void 0 : _a.splice(2);
            psbt.addProprietaryKeyValToInput(0, keyVals[1]);
            assert.throws(() => psbt.signTaprootInputHD(0, Musig2Util_1.rootWalletKeys.user), (e) => e.message === `Invalid valuedata size ${keyVals[1].value.length} for nonce`);
            assert.strictEqual(psbt.getProprietaryKeyVals(0).length, 3);
        });
        it(`fails if nonce keydata is invalid`, function () {
            var _a;
            const psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'bitgo', 'p2sh');
            psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.user);
            psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.bitgo);
            const dummyRootWalletKeys = new bitgo_1.RootWalletKeys((0, testutil_1.getKeyTriple)('dummy'));
            const dummyP2trMusig2Unspent = (0, Musig2Util_1.getUnspents)(['p2trMusig2'], dummyRootWalletKeys);
            const dummyPsbt = (0, Musig2Util_1.constructPsbt)(dummyP2trMusig2Unspent, dummyRootWalletKeys, 'user', 'bitgo', 'p2sh');
            dummyPsbt.setAllInputsMusig2NonceHD(dummyRootWalletKeys.user);
            dummyPsbt.setAllInputsMusig2NonceHD(dummyRootWalletKeys.bitgo);
            const dummyKeyVals = dummyPsbt.getProprietaryKeyVals(0, {
                identifier: bitgo_1.PSBT_PROPRIETARY_IDENTIFIER,
                subtype: bitgo_1.ProprietaryKeySubtype.MUSIG2_PUB_NONCE,
            });
            (_a = psbt.data.inputs[0].unknownKeyVals) === null || _a === void 0 ? void 0 : _a.splice(1);
            dummyKeyVals.forEach((kv, i) => psbt.addProprietaryKeyValToInput(0, dummyKeyVals[i]));
            assert.throws(() => psbt.signTaprootInputHD(0, Musig2Util_1.rootWalletKeys.user), (e) => e.message === `Invalid nonce keydata participant pub key`);
            assert.strictEqual(psbt.getProprietaryKeyVals(0).length, 3);
        });
        it(`fails if nonce keydata tapOutputKey is invalid`, function () {
            var _a;
            const psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'bitgo', 'p2sh');
            psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.user);
            psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.bitgo);
            const keyVals = psbt.getProprietaryKeyVals(0, {
                identifier: bitgo_1.PSBT_PROPRIETARY_IDENTIFIER,
                subtype: bitgo_1.ProprietaryKeySubtype.MUSIG2_PUB_NONCE,
            });
            keyVals[1].key.keydata = Buffer.concat([keyVals[1].key.keydata.subarray(0, 33), Musig2Util_1.dummyTapOutputKey]);
            (_a = psbt.data.inputs[0].unknownKeyVals) === null || _a === void 0 ? void 0 : _a.splice(2);
            psbt.addProprietaryKeyValToInput(0, keyVals[1]);
            assert.throws(() => psbt.signTaprootInputHD(0, Musig2Util_1.rootWalletKeys.user), (e) => e.message === `Invalid nonce keydata tapOutputKey`);
            assert.strictEqual(psbt.getProprietaryKeyVals(0).length, 3);
        });
    });
    describe('p2trMusig2 script path', function () {
        it(`psbt creation success and musig2 skips`, function () {
            let psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'backup', outputType);
            psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.user);
            psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.backup);
            assert.strictEqual(psbt.getProprietaryKeyVals(0).length, 0);
            psbt.signAllInputsHD(Musig2Util_1.rootWalletKeys.user);
            psbt.signAllInputsHD(Musig2Util_1.rootWalletKeys.backup);
            (0, Musig2Util_1.validatePsbtP2trMusig2Input)(psbt, 0, p2trMusig2Unspent[0], 'scriptPath');
            (0, Musig2Util_1.validatePsbtP2trMusig2Output)(psbt, 0);
            assert.ok(psbt.validateSignaturesOfAllInputs());
            psbt.finalizeAllInputs();
            (0, Musig2Util_1.validateFinalizedInput)(psbt, 0, p2trMusig2Unspent[0], 'scriptPath');
            let tx = psbt.extractTransaction();
            assert.ok((0, testutil_1.verifyFullySignedSignatures)(tx, p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'backup'));
            psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'bitgo', 'backup', outputType);
            psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.bitgo);
            psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.backup);
            psbt.signAllInputsHD(Musig2Util_1.rootWalletKeys.bitgo);
            psbt.signAllInputsHD(Musig2Util_1.rootWalletKeys.backup);
            assert.strictEqual(psbt.getProprietaryKeyVals(0).length, 0);
            (0, Musig2Util_1.validatePsbtP2trMusig2Input)(psbt, 0, p2trMusig2Unspent[0], 'scriptPath');
            (0, Musig2Util_1.validatePsbtP2trMusig2Output)(psbt, 0);
            assert.ok(psbt.validateSignaturesOfAllInputs());
            psbt.finalizeAllInputs();
            (0, Musig2Util_1.validateFinalizedInput)(psbt, 0, p2trMusig2Unspent[0], 'scriptPath');
            tx = psbt.extractTransaction();
            assert.ok((0, testutil_1.verifyFullySignedSignatures)(tx, p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'bitgo', 'backup'));
        });
        it(`parse tx`, function () {
            const psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'backup', outputType);
            (0, Musig2Util_1.validateParsedTaprootScriptPathPsbt)(psbt, 0, 'unsigned');
            psbt.signAllInputsHD(Musig2Util_1.rootWalletKeys.user);
            (0, Musig2Util_1.validateParsedTaprootScriptPathPsbt)(psbt, 0, 'halfsigned');
            psbt.signAllInputsHD(Musig2Util_1.rootWalletKeys.backup);
            (0, Musig2Util_1.validateParsedTaprootScriptPathPsbt)(psbt, 0, 'fullysigned');
            psbt.finalizeAllInputs();
            const tx = psbt.extractTransaction();
            const psbtDuplicate = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'backup', outputType);
            (0, Musig2Util_1.validateParsedTaprootScriptPathTxInput)(psbtDuplicate, tx, 0);
        });
    });
    describe('validate p2tr Musig2 signatures', function () {
        it(`validate with pubkey`, function () {
            const walletKeys = Musig2Util_1.rootWalletKeys.deriveForChainAndIndex(p2trMusig2Unspent[0].chain, p2trMusig2Unspent[0].index);
            let psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'bitgo', outputType);
            psbt.setAllInputsMusig2Nonce(walletKeys.user);
            psbt.setAllInputsMusig2Nonce(walletKeys.bitgo);
            psbt.signAllInputsHD(Musig2Util_1.rootWalletKeys.user);
            assert.ok(psbt.validateTaprootMusig2SignaturesOfInput(0, walletKeys.user.publicKey));
            psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'bitgo', outputType);
            psbt.setInputMusig2Nonce(0, walletKeys.user);
            psbt.setInputMusig2NonceHD(0, Musig2Util_1.rootWalletKeys.bitgo);
            psbt.signAllInputsHD(Musig2Util_1.rootWalletKeys.user);
            assert.ok(psbt.validateTaprootMusig2SignaturesOfInput(0, walletKeys.user.publicKey));
            psbt.signAllInputsHD(Musig2Util_1.rootWalletKeys.bitgo);
            assert.ok(psbt.validateTaprootMusig2SignaturesOfInput(0, walletKeys.bitgo.publicKey));
        });
        it(`fails if no sig`, function () {
            const walletKeys = Musig2Util_1.rootWalletKeys.deriveForChainAndIndex(p2trMusig2Unspent[0].chain, p2trMusig2Unspent[0].index);
            const psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'bitgo', outputType);
            assert.throws(() => psbt.validateSignaturesOfAllInputs(), (e) => e.message === `No signatures to validate`);
            psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.user);
            psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.bitgo);
            psbt.signAllInputsHD(Musig2Util_1.rootWalletKeys.user);
            assert.throws(() => psbt.validateTaprootMusig2SignaturesOfInput(0, walletKeys.bitgo.publicKey), (e) => e.message === `No signatures for this pubkey`);
        });
        it(`fails if no tapInternalKey and tapMerkleRoot`, function () {
            const walletKeys = Musig2Util_1.rootWalletKeys.deriveForChainAndIndex(p2trMusig2Unspent[0].chain, p2trMusig2Unspent[0].index);
            const psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'bitgo', outputType);
            psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.user);
            psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.bitgo);
            psbt.signAllInputsHD(Musig2Util_1.rootWalletKeys.user);
            psbt.signAllInputsHD(Musig2Util_1.rootWalletKeys.bitgo);
            const tapInternalKey = psbt.data.inputs[0].tapInternalKey;
            psbt.data.inputs[0].tapInternalKey = undefined;
            assert.throws(() => psbt.validateTaprootMusig2SignaturesOfInput(0), (e) => e.message === `both tapInternalKey and tapMerkleRoot are required`);
            psbt.data.inputs[0].tapInternalKey = tapInternalKey;
            psbt.data.inputs[0].tapMerkleRoot = undefined;
            assert.throws(() => psbt.validateTaprootMusig2SignaturesOfInput(0, walletKeys.bitgo.publicKey), (e) => e.message === `both tapInternalKey and tapMerkleRoot are required`);
        });
        it(`fails if no nonce and sig pub key match`, function () {
            let psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'bitgo', outputType);
            psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.user);
            psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.bitgo);
            psbt.signAllInputsHD(Musig2Util_1.rootWalletKeys.user);
            psbt.signAllInputsHD(Musig2Util_1.rootWalletKeys.bitgo);
            const partialSigs = psbt.getProprietaryKeyVals(0, {
                identifier: bitgo_1.PSBT_PROPRIETARY_IDENTIFIER,
                subtype: bitgo_1.ProprietaryKeySubtype.MUSIG2_PARTIAL_SIG,
            });
            const myRootWalletKeys = new bitgo_1.RootWalletKeys((0, testutil_1.getKeyTriple)('dummy'));
            const myUnspents = (0, Musig2Util_1.getUnspents)(['p2trMusig2'], myRootWalletKeys);
            psbt = (0, Musig2Util_1.constructPsbt)(myUnspents, myRootWalletKeys, 'user', 'bitgo', outputType);
            psbt.setAllInputsMusig2NonceHD(myRootWalletKeys.user);
            psbt.setAllInputsMusig2NonceHD(myRootWalletKeys.bitgo);
            psbt.signAllInputsHD(myRootWalletKeys.user);
            psbt.signAllInputsHD(myRootWalletKeys.bitgo);
            const participants = psbt.getProprietaryKeyVals(0, {
                identifier: bitgo_1.PSBT_PROPRIETARY_IDENTIFIER,
                subtype: bitgo_1.ProprietaryKeySubtype.MUSIG2_PARTICIPANT_PUB_KEYS,
            });
            const nonces = psbt.getProprietaryKeyVals(0, {
                identifier: bitgo_1.PSBT_PROPRIETARY_IDENTIFIER,
                subtype: bitgo_1.ProprietaryKeySubtype.MUSIG2_PUB_NONCE,
            });
            psbt.data.inputs[0].unknownKeyVals = undefined;
            psbt.addProprietaryKeyValToInput(0, participants[0]);
            psbt.addProprietaryKeyValToInput(0, nonces[0]);
            psbt.addProprietaryKeyValToInput(0, nonces[1]);
            psbt.addProprietaryKeyValToInput(0, partialSigs[0]);
            psbt.addProprietaryKeyValToInput(0, partialSigs[1]);
            assert.throws(() => psbt.validateSignaturesOfAllInputs(), (e) => e.message === `Found no pub nonce for pubkey`);
        });
        it(`fails if no valid sig`, function () {
            const psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'bitgo', outputType);
            psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.user);
            psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.bitgo);
            psbt.signAllInputsHD(Musig2Util_1.rootWalletKeys.user);
            psbt.signAllInputsHD(Musig2Util_1.rootWalletKeys.bitgo);
            const partialSigs = psbt.getProprietaryKeyVals(0, {
                identifier: bitgo_1.PSBT_PROPRIETARY_IDENTIFIER,
                subtype: bitgo_1.ProprietaryKeySubtype.MUSIG2_PARTIAL_SIG,
            });
            partialSigs[1].value = Musig2Util_1.dummyPartialSig;
            psbt.addOrUpdateProprietaryKeyValToInput(0, partialSigs[1]);
            assert.ok(!psbt.validateSignaturesOfAllInputs());
        });
    });
    describe('finalizeTaprootMusig2Input', function () {
        it('fails if invalid number for sigs', function () {
            const psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'bitgo', outputType);
            psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.user);
            psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.bitgo);
            psbt.signAllInputsHD(Musig2Util_1.rootWalletKeys.user);
            assert.throws(() => psbt.finalizeAllInputs(), (e) => e.message === `invalid number of partial signatures 1 to finalize`);
        });
    });
    describe('Psbt musig2 common functions', function () {
        it('output script should match the scriptPubKey in the prevout', function () {
            const myRootWalletKeys = new bitgo_1.RootWalletKeys((0, testutil_1.getKeyTriple)('dummy'));
            const unspents = (0, Musig2Util_1.getUnspents)(outputScripts_1.scriptTypes2Of3.map((t) => t), myRootWalletKeys);
            const psbt = (0, Musig2Util_1.constructPsbt)(unspents, Musig2Util_1.rootWalletKeys, 'user', 'bitgo', outputType);
            unspents.forEach((u, index) => {
                const scriptType = (0, bitgo_1.scriptTypeForChain)(u.chain);
                assert.throws(() => scriptType === 'p2trMusig2'
                    ? psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.user)
                    : scriptType === 'p2tr'
                        ? psbt.signTaprootInputHD(index, Musig2Util_1.rootWalletKeys.user)
                        : psbt.signInputHD(index, Musig2Util_1.rootWalletKeys.user), (e) => (0, bitgo_1.isSegwit)(u.chain) && scriptType !== 'p2shP2wsh'
                    ? e.message === `Witness script for input #${index} doesn't match the scriptPubKey in the prevout`
                    : e.message === `Redeem script for input #${index} doesn't match the scriptPubKey in the prevout`);
            });
            const p2trMusig2ScriptPathPsbt = (0, Musig2Util_1.constructPsbt)([unspents[4]], Musig2Util_1.rootWalletKeys, 'user', 'backup', outputType);
            assert.throws(() => p2trMusig2ScriptPathPsbt.signTaprootInputHD(0, Musig2Util_1.rootWalletKeys.user), (e) => e.message === `Witness script for input #0 doesn't match the scriptPubKey in the prevout`);
        });
        it(`decodePsbtMusig2ParticipantsKeyValData fails if invalid subtype or identifier is passed`, function () {
            const kv = {
                key: {
                    identifier: 'dummy',
                    subtype: 0x05,
                    keydata: Buffer.allocUnsafe(1),
                },
                value: Buffer.allocUnsafe(1),
            };
            assert.throws(() => (0, Musig2_1.decodePsbtMusig2Participants)(kv), (e) => e.message === `Invalid identifier ${kv.key.identifier} or subtype ${kv.key.subtype} for participants pub keys`);
            kv.key.identifier = bitgo_1.PSBT_PROPRIETARY_IDENTIFIER;
            assert.throws(() => (0, Musig2_1.decodePsbtMusig2Participants)(kv), (e) => e.message === `Invalid identifier ${kv.key.identifier} or subtype ${kv.key.subtype} for participants pub keys`);
        });
        it(`decodePsbtMusig2NonceKeyValData fails if invalid subtype or identifier is passed`, function () {
            const kv = {
                key: {
                    identifier: 'dummy',
                    subtype: 0x05,
                    keydata: Buffer.allocUnsafe(1),
                },
                value: Buffer.allocUnsafe(1),
            };
            assert.throws(() => (0, Musig2_1.decodePsbtMusig2Nonce)(kv), (e) => e.message === `Invalid identifier ${kv.key.identifier} or subtype ${kv.key.subtype} for nonce`);
            kv.key.identifier = bitgo_1.PSBT_PROPRIETARY_IDENTIFIER;
            assert.throws(() => (0, Musig2_1.decodePsbtMusig2Nonce)(kv), (e) => e.message === `Invalid identifier ${kv.key.identifier} or subtype ${kv.key.subtype} for nonce`);
        });
        it(`validatePsbtMusig2NoncesKeyValData fails if participant pub keys are duplicate`, function () {
            const nonceKeyValData = [0, 1].map((i) => ({
                participantPubKey: Musig2Util_1.dummyParticipantPubKeys[i],
                tapOutputKey: Musig2Util_1.dummyTapOutputKey,
                pubNonce: Musig2Util_1.dummyPubNonce,
            }));
            let participantKeyValData = {
                participantPubKeys: Musig2Util_1.dummyParticipantPubKeys,
                tapInternalKey: Musig2Util_1.dummyTapInternalKey,
                tapOutputKey: Musig2Util_1.invalidTapOutputKey,
            };
            assert.throws(() => (0, Musig2_1.assertPsbtMusig2Nonces)(nonceKeyValData, participantKeyValData), (e) => e.message === `invalid size 1. Must use x-only key.`);
            participantKeyValData = {
                participantPubKeys: [Musig2Util_1.invalidParticipantPubKeys[0], Musig2Util_1.dummyParticipantPubKeys[0]],
                tapInternalKey: Musig2Util_1.dummyTapInternalKey,
                tapOutputKey: Musig2Util_1.dummyTapOutputKey,
            };
            assert.throws(() => (0, Musig2_1.assertPsbtMusig2Nonces)(nonceKeyValData, participantKeyValData), (e) => e.message === `invalid size 1. Must use plain key.`);
            participantKeyValData = {
                participantPubKeys: [Musig2Util_1.dummyParticipantPubKeys[0], Musig2Util_1.dummyParticipantPubKeys[0]],
                tapInternalKey: Musig2Util_1.dummyTapInternalKey,
                tapOutputKey: Musig2Util_1.dummyTapOutputKey,
            };
            assert.throws(() => (0, Musig2_1.assertPsbtMusig2Nonces)(nonceKeyValData, participantKeyValData), (e) => e.message === `Duplicate participant pub keys found`);
        });
        it(`createTapTweak fails if invalid tapInternalKey or tapMerkleRoot is passed`, function () {
            assert.throws(() => (0, Musig2_1.createTapTweak)(Musig2Util_1.invalidTapInputKey, Musig2Util_1.dummyTapOutputKey), (e) => e.message === `invalid size 1. Must use x-only key.`);
            assert.throws(() => (0, Musig2_1.createTapTweak)(Musig2Util_1.dummyTapInternalKey, Musig2Util_1.invalidTapOutputKey), (e) => e.message === `invalid size 1. Must use tap merkle root.`);
        });
        it(`musig2PartialSign fails if invalid txHash is passed`, function () {
            assert.throws(() => (0, Musig2_1.musig2PartialSign)(Musig2Util_1.dummyPrivateKey, Musig2Util_1.dummyPubNonce, {
                publicKey: Musig2Util_1.dummyParticipantPubKeys[0],
                aggNonce: Musig2Util_1.dummyAggNonce,
                msg: Musig2Util_1.invalidTxHash,
            }, new Musig2_1.Musig2NonceStore()), (e) => e.message === `invalid size 1. Must use tx hash.`);
        });
        it(`encodePsbtMusig2PartialSigKeyKeyValData fails if invalid txHash is passed`, function () {
            assert.throws(() => (0, Musig2_1.encodePsbtMusig2PartialSig)({
                partialSig: Musig2Util_1.invalidPartialSig,
                participantPubKey: Musig2Util_1.dummyParticipantPubKeys[0],
                tapOutputKey: Musig2Util_1.dummyTapOutputKey,
            }), (e) => e.message === `Invalid partialSig length 1`);
        });
        it(`deleteProprietaryKeyVals`, function () {
            const psbt = (0, Musig2Util_1.constructPsbt)(p2trMusig2Unspent, Musig2Util_1.rootWalletKeys, 'user', 'bitgo', outputType);
            psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.user);
            psbt.setAllInputsMusig2NonceHD(Musig2Util_1.rootWalletKeys.bitgo);
            const key = {
                identifier: 'DUMMY',
                subtype: 100,
                keydata: Musig2Util_1.dummyTapOutputKey,
            };
            psbt.addProprietaryKeyValToInput(0, { key, value: Musig2Util_1.dummyTapInternalKey });
            psbt.deleteProprietaryKeyVals(0, { identifier: bitgo_1.PSBT_PROPRIETARY_IDENTIFIER });
            const keyVal = psbt.getProprietaryKeyVals(0);
            assert.strictEqual(keyVal.length, 1);
            assert.strictEqual(keyVal[0].key.identifier, 'DUMMY');
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTXVzaWcyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vdGVzdC9iaXRnby9wc2J0L011c2lnMi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLGlDQUFpQztBQUVqQyw4Q0FZNEI7QUFFNUIsb0RBQWtGO0FBQ2xGLHNEQVVtQztBQUNuQyxvRUFBcUY7QUFDckYsNkNBMkJzQjtBQUV0QixNQUFNLGlCQUFpQixHQUFHLElBQUEsd0JBQVcsRUFBQyxDQUFDLFlBQVksQ0FBQyxFQUFFLDJCQUFjLENBQUMsQ0FBQztBQUN0RSxNQUFNLFVBQVUsR0FBRyxZQUFZLENBQUM7QUFDaEMsTUFBTSxZQUFZLEdBQUcsR0FBRyxDQUFDO0FBRXpCLFFBQVEsQ0FBQyxZQUFZLEVBQUU7SUFDckIsUUFBUSxDQUFDLHFCQUFxQixFQUFFO1FBQzlCLEVBQUUsQ0FBQyx1REFBdUQsRUFBRTtZQUMxRCxNQUFNLFVBQVUsR0FBRywyQkFBYyxDQUFDLHNCQUFzQixDQUFDLElBQUEsNEJBQW9CLEVBQUMsWUFBWSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDaEcsTUFBTSxRQUFRLEdBQUcsSUFBQSx3QkFBVyxFQUMxQiwrQkFBZSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQzdCLDJCQUFjLENBQ2YsQ0FBQztZQUNGLDhFQUE4RTtZQUM5RSxNQUFNLFNBQVMsR0FBRyxJQUFBLDBCQUFhLEVBQUMsUUFBUSxFQUFFLDJCQUFjLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxVQUFVLENBQUMsQ0FBQztZQUN2RixNQUFNLFlBQVksR0FBRyxTQUFTLENBQUMsS0FBSyxFQUFFLENBQUM7WUFFdkMsK0dBQStHO1lBQy9HLE1BQU0sUUFBUSxHQUFHLElBQUEseUJBQWlCLEVBQUMsWUFBWSxFQUFFLG9CQUFPLENBQUMsQ0FBQztZQUMxRCxRQUFRLENBQUMseUJBQXlCLENBQUMsMkJBQWMsQ0FBQyxJQUFJ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QUMseUJBQXlCLENBQUMsMkJBQWMsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUNyRCxNQUFNLEdBQUcsR0FBRztnQkFDVixVQUFVLEVBQUUsT0FBTztnQkFDbkIsT0FBTyxFQUFFLEdBQUc7Z0JBQ1osT0FBTyxFQUFFLDhCQUFpQjthQUMzQixDQUFDO1lBQ0YsSUFBSSxDQUFDLDJCQUEyQixDQUFDLENBQUMsRUFBRSxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsZ0NBQW1CLEVBQUUsQ0FBQyxDQUFDO1lBQ3pFLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDLEVBQUUsRUFBRSxVQUFVLEVBQUUsbUNBQTJCLEVBQUUsQ0FBQyxDQUFDO1lBQzlFLE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM3QyxNQUFNLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDckMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLFVBQVUsRUFBRSxPQUFPLENBQUMsQ0FBQztRQUN4RCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBhc3NlcnQgZnJvbSAnYXNzZXJ0JztcclxuXHJcbmltcG9ydCB7XHJcbiAgY3JlYXRlUHNidEZyb21IZXgsXHJcbiAgZ2V0RXh0ZXJuYWxDaGFpbkNvZGUsXHJcbiAgZ2V0SW50ZXJuYWxDaGFpbkNvZGUsXHJcbiAgaXNTZWd3aXQsXHJcbiAgcGFyc2VQc2J0SW5wdXQsXHJcbiAgUHJvcHJpZXRhcnlLZXlTdWJ0eXBlLFxyXG4gIFBTQlRfUFJPUFJJRVRBUllfSURFTlRJRklFUixcclxuICBSb290V2FsbGV0S2V5cyxcclxuICBzY3JpcHRUeXBlRm9yQ2hhaW4sXHJcbiAgVXR4b1RyYW5zYWN0aW9uLFxyXG4gIHZlcmlmeVNpZ25hdHVyZVdpdGhVbnNwZW50LFxyXG59IGZyb20gJy4uLy4uLy4uL3NyYy9iaXRnbyc7XHJcblxyXG5pbXBvcnQgeyBnZXRLZXlUcmlwbGUsIHZlcmlmeUZ1bGx5U2lnbmVkU2lnbmF0dXJlcyB9IGZyb20gJy4uLy4uLy4uL3NyYy90ZXN0dXRpbCc7XHJcbmltcG9ydCB7XHJcbiAgY3JlYXRlVGFwSW50ZXJuYWxLZXksXHJcbiAgY3JlYXRlVGFwT3V0cHV0S2V5LFxyXG4gIGNyZWF0ZVRhcFR3ZWFrLFxyXG4gIGRlY29kZVBzYnRNdXNpZzJOb25jZSxcclxuICBkZWNvZGVQc2J0TXVzaWcyUGFydGljaXBhbnRzLFxyXG4gIGVuY29kZVBzYnRNdXNpZzJQYXJ0aWFsU2lnLFxyXG4gIG11c2lnMlBhcnRpYWxTaWduLFxyXG4gIGFzc2VydFBzYnRNdXNpZzJOb25jZXMsXHJcbiAgTXVzaWcyTm9uY2VTdG9yZSxcclxufSBmcm9tICcuLi8uLi8uLi9zcmMvYml0Z28vTXVzaWcyJztcclxuaW1wb3J0IHsgc2NyaXB0VHlwZXMyT2YzLCB0b1hPbmx5UHVibGljS2V5IH0gZnJvbSAnLi4vLi4vLi4vc3JjL2JpdGdvL291dHB1dFNjcmlwdHMnO1xyXG5pbXBvcnQge1xyXG4gIGNvbnN0cnVjdFBzYnQsXHJcbiAgZ2V0VW5zcGVudHMsXHJcbiAgaW52YWxpZFBhcnRpYWxTaWcsXHJcbiAgaW52YWxpZFBhcnRpY2lwYW50UHViS2V5cyxcclxuICBpbnZhbGlkVGFwSW5wdXRLZXksXHJcbiAgaW52YWxpZFRhcE91dHB1dEtleSxcclxuICBpbnZhbGlkVHhIYXNoLFxyXG4gIGR1bW15QWdnTm9uY2UsXHJcbiAgdmFsaWRhdGVOb25jZXNLZXlWYWxzLFxyXG4gIHZhbGlkYXRlUGFydGlhbFNpZ0tleVZhbHMsXHJcbiAgdmFsaWRhdGVQYXJ0aWNpcGFudHNLZXlWYWxzLFxyXG4gIHZhbGlkYXRlUHNidFAydHJNdXNpZzJJbnB1dCxcclxuICB2YWxpZGF0ZVBzYnRQMnRyTXVzaWcyT3V0cHV0LFxyXG4gIGR1bW15UGFydGljaXBhbnRQdWJLZXlzLFxyXG4gIGR1bW15UHJpdmF0ZUtleSxcclxuICBkdW1teVB1Yk5vbmNlLFxyXG4gIGR1bW15VGFwSW50ZXJuYWxLZXksXHJcbiAgZHVtbXlUYXBPdXRwdXRLZXksXHJcbiAgZHVtbXlQYXJ0aWFsU2lnLFxyXG4gIHZhbGlkYXRlRmluYWxpemVkSW5wdXQsXHJcbiAgbmV0d29yayxcclxuICB2YWxpZGF0ZVBhcnNlZFRhcHJvb3RLZXlQYXRoVHhJbnB1dCxcclxuICB2YWxpZGF0ZVBhcnNlZFRhcHJvb3RTY3JpcHRQYXRoVHhJbnB1dCxcclxuICB2YWxpZGF0ZVBhcnNlZFRhcHJvb3RLZXlQYXRoUHNidCxcclxuICB2YWxpZGF0ZVBhcnNlZFRhcHJvb3RTY3JpcHRQYXRoUHNidCxcclxuICByb290V2FsbGV0S2V5cyxcclxufSBmcm9tICcuL011c2lnMlV0aWwnO1xyXG5cclxuY29uc3QgcDJ0ck11c2lnMlVuc3BlbnQgPSBnZXRVbnNwZW50cyhbJ3AydHJNdXNpZzInXSwgcm9vdFdhbGxldEtleXMpO1xyXG5jb25zdCBvdXRwdXRUeXBlID0gJ3AydHJNdXNpZzInO1xyXG5jb25zdCBDSEFOR0VfSU5ERVggPSAxMDA7XHJcblxyXG5kZXNjcmliZSgncDJ0ck11c2lnMicsIGZ1bmN0aW9uICgpIHtcclxuICBkZXNjcmliZSgncDJ0ck11c2lnMiBrZXkgcGF0aCcsIGZ1bmN0aW9uICgpIHtcclxuICAgIGl0KGBjcmVhdGUgcHNidCwgbm9uY2VzLCBzaWduIChpbnRlcm5hbCB2ZXJpZnkpIC0gc3VjY2Vzc2AsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgY29uc3Qgd2FsbGV0S2V5cyA9IHJvb3RXYWxsZXRLZXlzLmRlcml2ZUZvckNoYWluQW5kSW5kZXgoZ2V0RXh0ZXJuYWxDaGFpbkNvZGUoJ3AydHJNdXNpZzInKSwgMCk7XHJcbiAgICAgIGNvbnN0IHVuc3BlbnRzID0gZ2V0VW5zcGVudHMoXHJcbiAgICAgICAgc2NyaXB0VHlwZXMyT2YzLm1hcCgodCkgPT4gdCksXHJcbiAgICAgICAgcm9vdFdhbGxldEtleXNcclxuICAgICAgKTtcclxuICAgICAgLy8gV1AgY3JlYXRlcyBQU0JUIGR1cmluZyBidWlsZCBBUEksIHNlcmlhbGl6ZXMgaXQsIGFuZCBzZW5kcyB0aGUgcHNidCB0byB1c2VyXHJcbiAgICAgIGNvbnN0IGJ1aWxkUHNidCA9IGNvbnN0cnVjdFBzYnQodW5zcGVudHMsIHJvb3RXYWxsZXRLZXlzLCAnYml0Z28nLCAndXNlcicsIG91dHB1dFR5cGUpO1xyXG4gICAgICBjb25zdCBidWlsZFBzYnRTZXIgPSBidWlsZFBzYnQudG9IZXgoKTtcclxuXHJcbiAgICAgIC8vIFVzZXIgZGUtc2VyaWFsaXNlcyB0aGUgcHNidCwgYW5kcyB0aGUgdXNlciBub25jZSwgYW5kIHNlbmRzIGl0IHRvIHRoZSBoc20gc28gdGhhdCBpdCBjYW4gYWRkIHRoZSBiaXRnbyBub25jZVxyXG4gICAgICBjb25zdCB1c2VyUHNidCA9IGNyZWF0ZVBzYnRGcm9tSGV4KGJ1aWxkUHNidFNlciwgbmV0d29yayk7XHJcbiAgICAgIHVzZXJQc2J0LnNldEFsbElucHV0c011c2lnMk5vbmNlSEQocm9vdFdhbGxldEtleXMudXNlcik7XHJcbiAgICAgIGNvbnN0IHVzZXJQc2J0U2VyID0gdXNlclBzYnQudG9IZXgoKTtcclxuXHJcbiAgICAgIC8vIEhTTSBkZXNlcmlhbGl6ZXMgdGhlIHVzZXIgcHNidCwgYWRkcyB0aGUgZGV0ZXJtaW5pc3RpYyBiaXRnbyBub25jZSwgYW5kIHNlbmRzIHRoYXQgYmFjayB0byB0aGUgdXNlclxyXG4gICAgICBjb25zdCBiaXRnb1BzYnQgPSBjcmVhdGVQc2J0RnJvbUhleCh1c2VyUHNidFNlciwgbmV0d29yayk7XHJcbiAgICAgIGJpdGdvUHNidC5zZXRBbGxJbnB1dHNNdXNpZzJOb25jZUhEKHJvb3RXYWxsZXRLZXlzLmJpdGdvLCB7IGRldGVybWluaXN0aWM6IHRydWUgfSk7XHJcbiAgICAgIGNvbnN0IGJpdGdvUHNidFNlciA9IGJpdGdvUHNidC50b0hleCgpO1xyXG5cclxuICAgICAgLy8gVXNlciBjb21iaW5lcyB0aGUgcHNidCB3aXRoIHRoZSBiaXRnbyBub25jZSwgYWRkcyB1c2VyIHNpZ25hdHVyZSwgYW5kIHNlbmRzIGhhbGYtc2lnbmVkIHRvIGhzbVxyXG4gICAgICBjb25zdCBiaXRnb1BzYnREZXNlciA9IGNyZWF0ZVBzYnRGcm9tSGV4KGJpdGdvUHNidFNlciwgbmV0d29yayk7XHJcbiAgICAgIHVzZXJQc2J0LmNvbWJpbmUoYml0Z29Qc2J0RGVzZXIpO1xyXG4gICAgICB1c2VyUHNidC5zaWduQWxsSW5wdXRzSEQocm9vdFdhbGxldEtleXMudXNlcik7XHJcbiAgICAgIGNvbnN0IHVzZXJQc2J0SGFsZlNpZ25lZEhleCA9IHVzZXJQc2J0LnRvSGV4KCk7XHJcblxyXG4gICAgICAvLyBXUCBkZS1zZXJpYWxpc2VzIHRoZSBwc2J0IGFuZCB2YWxpZGF0ZXMgdXNlciBzaWdcclxuICAgICAgY29uc3QgdXNlclBzYnREZXMgPSBjcmVhdGVQc2J0RnJvbUhleCh1c2VyUHNidEhhbGZTaWduZWRIZXgsIG5ldHdvcmspO1xyXG4gICAgICBhc3NlcnQub2sodXNlclBzYnREZXMudmFsaWRhdGVUYXByb290TXVzaWcyU2lnbmF0dXJlc09mSW5wdXQoNCwgd2FsbGV0S2V5cy51c2VyLnB1YmxpY0tleSkpO1xyXG5cclxuICAgICAgLy8gV1Agc2VuZHMgdG8gaHNtIGZvciBzaWduYXR1cmUgYW5kIHJldHVybnMgYSBmdWxseSBzaWduZWQgcHNidFxyXG4gICAgICBjb25zdCBwc2J0ID0gY3JlYXRlUHNidEZyb21IZXgodXNlclBzYnRIYWxmU2lnbmVkSGV4LCBuZXR3b3JrKTtcclxuICAgICAgcHNidC5zaWduQWxsSW5wdXRzSEQocm9vdFdhbGxldEtleXMuYml0Z28sIHsgZGV0ZXJtaW5pc3RpYzogdHJ1ZSB9KTtcclxuXHJcbiAgICAgIHVuc3BlbnRzLmZvckVhY2goKHVuc3BlbnQsIGluZGV4KSA9PiB7XHJcbiAgICAgICAgaWYgKHNjcmlwdFR5cGVGb3JDaGFpbih1bnNwZW50LmNoYWluKSAhPT0gJ3AydHJNdXNpZzInKSB7XHJcbiAgICAgICAgICBhc3NlcnQuc3RyaWN0RXF1YWwocHNidC5nZXRQcm9wcmlldGFyeUtleVZhbHMoaW5kZXgpLmxlbmd0aCwgMCk7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhbGlkYXRlUHNidFAydHJNdXNpZzJJbnB1dChwc2J0LCBpbmRleCwgdW5zcGVudCwgJ2tleVBhdGgnKTtcclxuICAgICAgICB2YWxpZGF0ZVBzYnRQMnRyTXVzaWcyT3V0cHV0KHBzYnQsIDApO1xyXG4gICAgICAgIHZhbGlkYXRlUGFydGljaXBhbnRzS2V5VmFscyhwc2J0LCBpbmRleCwgdW5zcGVudCk7XHJcbiAgICAgICAgdmFsaWRhdGVOb25jZXNLZXlWYWxzKHBzYnQsIGluZGV4LCB1bnNwZW50KTtcclxuICAgICAgICB2YWxpZGF0ZVBhcnRpYWxTaWdLZXlWYWxzKHBzYnQsIGluZGV4LCB1bnNwZW50KTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBhc3NlcnQub2socHNidC52YWxpZGF0ZVNpZ25hdHVyZXNPZkFsbElucHV0cygpKTtcclxuICAgICAgcHNidC5maW5hbGl6ZUFsbElucHV0cygpO1xyXG4gICAgICB1bnNwZW50cy5mb3JFYWNoKCh1bnNwZW50LCBpbmRleCkgPT4ge1xyXG4gICAgICAgIHZhbGlkYXRlRmluYWxpemVkSW5wdXQocHNidCwgaW5kZXgsIHVuc3BlbnQpO1xyXG4gICAgICB9KTtcclxuICAgICAgY29uc3QgdHggPSBwc2J0LmV4dHJhY3RUcmFuc2FjdGlvbigpIGFzIFV0eG9UcmFuc2FjdGlvbjxiaWdpbnQ+O1xyXG4gICAgICBhc3NlcnQub2sodmVyaWZ5RnVsbHlTaWduZWRTaWduYXR1cmVzKHR4LCB1bnNwZW50cywgcm9vdFdhbGxldEtleXMsICdiaXRnbycsICd1c2VyJykpO1xyXG4gICAgICB1bnNwZW50cy5tYXAoKHVuc3BlbnQsIGlucHV0SW5kZXgpID0+IHtcclxuICAgICAgICBhc3NlcnQuZGVlcFN0cmljdEVxdWFsKHZlcmlmeVNpZ25hdHVyZVdpdGhVbnNwZW50KHR4LCBpbnB1dEluZGV4LCB1bnNwZW50cywgcm9vdFdhbGxldEtleXMpLCBbXHJcbiAgICAgICAgICB0cnVlLFxyXG4gICAgICAgICAgZmFsc2UsXHJcbiAgICAgICAgICB0cnVlLFxyXG4gICAgICAgIF0pO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KGBwYXJzZSB0eGAsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgY29uc3QgcHNidCA9IGNvbnN0cnVjdFBzYnQocDJ0ck11c2lnMlVuc3BlbnQsIHJvb3RXYWxsZXRLZXlzLCAnYml0Z28nLCAndXNlcicsIG91dHB1dFR5cGUpO1xyXG4gICAgICB2YWxpZGF0ZVBhcnNlZFRhcHJvb3RLZXlQYXRoUHNidChwc2J0LCAwLCAndW5zaWduZWQnKTtcclxuXHJcbiAgICAgIHBzYnQuc2V0QWxsSW5wdXRzTXVzaWcyTm9uY2VIRChyb290V2FsbGV0S2V5cy51c2VyKTtcclxuICAgICAgcHNidC5zZXRBbGxJbnB1dHNNdXNpZzJOb25jZUhEKHJvb3RXYWxsZXRLZXlzLmJpdGdvKTtcclxuICAgICAgcHNidC5zaWduQWxsSW5wdXRzSEQocm9vdFdhbGxldEtleXMudXNlcik7XHJcbiAgICAgIHZhbGlkYXRlUGFyc2VkVGFwcm9vdEtleVBhdGhQc2J0KHBzYnQsIDAsICdoYWxmc2lnbmVkJyk7XHJcblxyXG4gICAgICBwc2J0LnNpZ25BbGxJbnB1dHNIRChyb290V2FsbGV0S2V5cy5iaXRnbyk7XHJcbiAgICAgIHZhbGlkYXRlUGFyc2VkVGFwcm9vdEtleVBhdGhQc2J0KHBzYnQsIDAsICdmdWxseXNpZ25lZCcpO1xyXG5cclxuICAgICAgcHNidC5maW5hbGl6ZUFsbElucHV0cygpO1xyXG4gICAgICBhc3NlcnQudGhyb3dzKFxyXG4gICAgICAgICgpID0+IHBhcnNlUHNidElucHV0KHBzYnQuZGF0YS5pbnB1dHNbMF0pLFxyXG4gICAgICAgIChlOiBhbnkpID0+IGUubWVzc2FnZSA9PT0gJ0ZpbmFsaXplZCBQU0JUIHBhcnNpbmcgaXMgbm90IHN1cHBvcnRlZCdcclxuICAgICAgKTtcclxuXHJcbiAgICAgIGNvbnN0IHR4ID0gcHNidC5leHRyYWN0VHJhbnNhY3Rpb24oKSBhcyBVdHhvVHJhbnNhY3Rpb248YmlnaW50PjtcclxuICAgICAgdmFsaWRhdGVQYXJzZWRUYXByb290S2V5UGF0aFR4SW5wdXQocHNidCwgdHgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ2NyZWF0ZSBub25jZScsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgaXQoYHVwZGF0ZSB3aXRoIG5ldyBub25jZSBzaG91bGQgYmUgYWxsb3dlZGAsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBjb25zdCBwc2J0ID0gY29uc3RydWN0UHNidChwMnRyTXVzaWcyVW5zcGVudCwgcm9vdFdhbGxldEtleXMsICd1c2VyJywgJ2JpdGdvJywgJ3Ayc2gnKTtcclxuXHJcbiAgICAgICAgcHNidC5zZXRBbGxJbnB1dHNNdXNpZzJOb25jZUhEKHJvb3RXYWxsZXRLZXlzLnVzZXIpO1xyXG5cclxuICAgICAgICBsZXQgbm9uY2VzS2V5VmFscyA9IHBzYnQuZ2V0UHJvcHJpZXRhcnlLZXlWYWxzKDAsIHtcclxuICAgICAgICAgIGlkZW50aWZpZXI6IFBTQlRfUFJPUFJJRVRBUllfSURFTlRJRklFUixcclxuICAgICAgICAgIHN1YnR5cGU6IFByb3ByaWV0YXJ5S2V5U3VidHlwZS5NVVNJRzJfUFVCX05PTkNFLFxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGFzc2VydC5zdHJpY3RFcXVhbChub25jZXNLZXlWYWxzLmxlbmd0aCwgMSk7XHJcbiAgICAgICAgY29uc3QgdXNlck5vbmNlS2V5ID0gbm9uY2VzS2V5VmFsc1swXS5rZXkua2V5ZGF0YTtcclxuICAgICAgICBjb25zdCB1c2VyTm9uY2VWYWx1ZSA9IG5vbmNlc0tleVZhbHNbMF0udmFsdWU7XHJcblxyXG4gICAgICAgIHBzYnQuc2V0QWxsSW5wdXRzTXVzaWcyTm9uY2VIRChyb290V2FsbGV0S2V5cy5iaXRnbyk7XHJcbiAgICAgICAgcHNidC5zZXRBbGxJbnB1dHNNdXNpZzJOb25jZUhEKHJvb3RXYWxsZXRLZXlzLnVzZXIpO1xyXG5cclxuICAgICAgICBub25jZXNLZXlWYWxzID0gcHNidC5nZXRQcm9wcmlldGFyeUtleVZhbHMoMCwge1xyXG4gICAgICAgICAgaWRlbnRpZmllcjogUFNCVF9QUk9QUklFVEFSWV9JREVOVElGSUVSLFxyXG4gICAgICAgICAgc3VidHlwZTogUHJvcHJpZXRhcnlLZXlTdWJ0eXBlLk1VU0lHMl9QVUJfTk9OQ0UsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgYXNzZXJ0LnN0cmljdEVxdWFsKG5vbmNlc0tleVZhbHMubGVuZ3RoLCAyKTtcclxuXHJcbiAgICAgICAgbm9uY2VzS2V5VmFscyA9IG5vbmNlc0tleVZhbHMuZmlsdGVyKChrdikgPT4ga3Yua2V5LmtleWRhdGEuZXF1YWxzKHVzZXJOb25jZUtleSkpO1xyXG4gICAgICAgIGFzc2VydC5zdHJpY3RFcXVhbChub25jZXNLZXlWYWxzLmxlbmd0aCwgMSk7XHJcbiAgICAgICAgYXNzZXJ0Lm9rKCFub25jZXNLZXlWYWxzWzBdLnZhbHVlLmVxdWFscyh1c2VyTm9uY2VWYWx1ZSkpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGl0KGBDb3NpZ25lciBub25jZSBjcmVhdGlvbiBmYWlsIHNob3VsZCBub3QgZW5mb3JjZSB0aGUgc2lnbmVyIHRvIHJlY3JlYXRlIG5vbmNlYCwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGNvbnN0IHBzYnQgPSBjb25zdHJ1Y3RQc2J0KHAydHJNdXNpZzJVbnNwZW50LCByb290V2FsbGV0S2V5cywgJ3VzZXInLCAnYml0Z28nLCAncDJzaCcpO1xyXG5cclxuICAgICAgICBwc2J0LnNldEFsbElucHV0c011c2lnMk5vbmNlSEQocm9vdFdhbGxldEtleXMudXNlcik7XHJcblxyXG4gICAgICAgIGNvbnN0IHRhcEJpcDMyRGVyaXZhdGlvbiA9IHBzYnQuZGF0YS5pbnB1dHNbMF0udGFwQmlwMzJEZXJpdmF0aW9uO1xyXG4gICAgICAgIHBzYnQuZGF0YS5pbnB1dHNbMF0udGFwQmlwMzJEZXJpdmF0aW9uID0gdW5kZWZpbmVkO1xyXG5cclxuICAgICAgICBhc3NlcnQudGhyb3dzKFxyXG4gICAgICAgICAgKCkgPT4gcHNidC5zZXRBbGxJbnB1dHNNdXNpZzJOb25jZUhEKHJvb3RXYWxsZXRLZXlzLmJpdGdvKSxcclxuICAgICAgICAgIChlOiBhbnkpID0+IGUubWVzc2FnZSA9PT0gJ3RhcEJpcDMyRGVyaXZhdGlvbiBpcyByZXF1aXJlZCB0byBjcmVhdGUgbm9uY2UnXHJcbiAgICAgICAgKTtcclxuXHJcbiAgICAgICAgcHNidC5kYXRhLmlucHV0c1swXS50YXBCaXAzMkRlcml2YXRpb24gPSB0YXBCaXAzMkRlcml2YXRpb247XHJcblxyXG4gICAgICAgIHBzYnQuc2V0QWxsSW5wdXRzTXVzaWcyTm9uY2VIRChyb290V2FsbGV0S2V5cy5iaXRnbyk7XHJcblxyXG4gICAgICAgIHBzYnQuc2lnbkFsbElucHV0c0hEKHJvb3RXYWxsZXRLZXlzLnVzZXIpO1xyXG4gICAgICAgIHBzYnQuc2lnbkFsbElucHV0c0hEKHJvb3RXYWxsZXRLZXlzLmJpdGdvKTtcclxuXHJcbiAgICAgICAgY29uc3Qgbm9uY2VzS2V5VmFscyA9IHBzYnQuZ2V0UHJvcHJpZXRhcnlLZXlWYWxzKDAsIHtcclxuICAgICAgICAgIGlkZW50aWZpZXI6IFBTQlRfUFJPUFJJRVRBUllfSURFTlRJRklFUixcclxuICAgICAgICAgIHN1YnR5cGU6IFByb3ByaWV0YXJ5S2V5U3VidHlwZS5NVVNJRzJfUFVCX05PTkNFLFxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGFzc2VydC5zdHJpY3RFcXVhbChub25jZXNLZXlWYWxzLmxlbmd0aCwgMik7XHJcblxyXG4gICAgICAgIGNvbnN0IHBhcnRpYWxTaWdLZXlWYWxzID0gcHNidC5nZXRQcm9wcmlldGFyeUtleVZhbHMoMCwge1xyXG4gICAgICAgICAgaWRlbnRpZmllcjogUFNCVF9QUk9QUklFVEFSWV9JREVOVElGSUVSLFxyXG4gICAgICAgICAgc3VidHlwZTogUHJvcHJpZXRhcnlLZXlTdWJ0eXBlLk1VU0lHMl9QQVJUSUFMX1NJRyxcclxuICAgICAgICB9KTtcclxuICAgICAgICBhc3NlcnQuc3RyaWN0RXF1YWwocGFydGlhbFNpZ0tleVZhbHMubGVuZ3RoLCAyKTtcclxuXHJcbiAgICAgICAgY29uc3QgcGFydGljaXBhbnRLZXlWYWxzID0gcHNidC5nZXRQcm9wcmlldGFyeUtleVZhbHMoMCwge1xyXG4gICAgICAgICAgaWRlbnRpZmllcjogUFNCVF9QUk9QUklFVEFSWV9JREVOVElGSUVSLFxyXG4gICAgICAgICAgc3VidHlwZTogUHJvcHJpZXRhcnlLZXlTdWJ0eXBlLk1VU0lHMl9QQVJUSUNJUEFOVF9QVUJfS0VZUyxcclxuICAgICAgICB9KTtcclxuICAgICAgICBhc3NlcnQuc3RyaWN0RXF1YWwocGFydGljaXBhbnRLZXlWYWxzLmxlbmd0aCwgMSk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgaXQoJ0Nvc2lnbmVyIGNhbiBjcmVhdGUgYSBkZXRlcm1pbmlzdGljIG5vbmNlJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGNvbnN0IHBzYnQgPSBjb25zdHJ1Y3RQc2J0KHAydHJNdXNpZzJVbnNwZW50LCByb290V2FsbGV0S2V5cywgJ3VzZXInLCAnYml0Z28nLCAncDJzaCcpO1xyXG4gICAgICAgIHBzYnQuc2V0QWxsSW5wdXRzTXVzaWcyTm9uY2VIRChyb290V2FsbGV0S2V5cy51c2VyKTtcclxuICAgICAgICBwc2J0LnNldEFsbElucHV0c011c2lnMk5vbmNlSEQocm9vdFdhbGxldEtleXMuYml0Z28sIHsgZGV0ZXJtaW5pc3RpYzogdHJ1ZSB9KTtcclxuXHJcbiAgICAgICAgY29uc3Qgbm9uY2VzS2V5VmFscyA9IHBzYnQuZ2V0UHJvcHJpZXRhcnlLZXlWYWxzKDAsIHtcclxuICAgICAgICAgIGlkZW50aWZpZXI6IFBTQlRfUFJPUFJJRVRBUllfSURFTlRJRklFUixcclxuICAgICAgICAgIHN1YnR5cGU6IFByb3ByaWV0YXJ5S2V5U3VidHlwZS5NVVNJRzJfUFVCX05PTkNFLFxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGFzc2VydC5zdHJpY3RFcXVhbChub25jZXNLZXlWYWxzLmxlbmd0aCwgMik7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgaXQoJ0Nvc2lnbmVyIGNhbm5vdCBjcmVhdGUgYSBkZXRlcm1pbmlzdGljIG5vbmNlIGlmIHRoZXJlIGlzIG5vIHNpZ25lciBub25jZScsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBjb25zdCBwc2J0ID0gY29uc3RydWN0UHNidChwMnRyTXVzaWcyVW5zcGVudCwgcm9vdFdhbGxldEtleXMsICd1c2VyJywgJ2JpdGdvJywgJ3Ayc2gnKTtcclxuXHJcbiAgICAgICAgYXNzZXJ0LnRocm93cyhcclxuICAgICAgICAgICgpID0+IHBzYnQuc2V0QWxsSW5wdXRzTXVzaWcyTm9uY2VIRChyb290V2FsbGV0S2V5cy5iaXRnbywgeyBkZXRlcm1pbmlzdGljOiB0cnVlIH0pLFxyXG4gICAgICAgICAgKGU6IGFueSkgPT4gZS5tZXNzYWdlID09PSAnTm8gbm9uY2VzIGZvdW5kIG9uIGlucHV0ICMwJ1xyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIGxldCBub25jZXNLZXlWYWxzID0gcHNidC5nZXRQcm9wcmlldGFyeUtleVZhbHMoMCwge1xyXG4gICAgICAgICAgaWRlbnRpZmllcjogUFNCVF9QUk9QUklFVEFSWV9JREVOVElGSUVSLFxyXG4gICAgICAgICAgc3VidHlwZTogUHJvcHJpZXRhcnlLZXlTdWJ0eXBlLk1VU0lHMl9QVUJfTk9OQ0UsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgYXNzZXJ0LnN0cmljdEVxdWFsKG5vbmNlc0tleVZhbHMubGVuZ3RoLCAwKTtcclxuXHJcbiAgICAgICAgcHNidC5zZXRBbGxJbnB1dHNNdXNpZzJOb25jZUhEKHJvb3RXYWxsZXRLZXlzLmJpdGdvKTtcclxuICAgICAgICBhc3NlcnQudGhyb3dzKFxyXG4gICAgICAgICAgKCkgPT4gcHNidC5zZXRBbGxJbnB1dHNNdXNpZzJOb25jZUhEKHJvb3RXYWxsZXRLZXlzLmJpdGdvLCB7IGRldGVybWluaXN0aWM6IHRydWUgfSksXHJcbiAgICAgICAgICAoZTogYW55KSA9PiBlLm1lc3NhZ2UgPT09ICdzaWduZXIgbm9uY2UgbXVzdCBiZSBzZXQgaWYgY29zaWduZXIgbm9uY2UgaXMgdG8gYmUgZGVyaXZlZCBkZXRlcm1pbmlzdGljYWxseSdcclxuICAgICAgICApO1xyXG5cclxuICAgICAgICBub25jZXNLZXlWYWxzID0gcHNidC5nZXRQcm9wcmlldGFyeUtleVZhbHMoMCwge1xyXG4gICAgICAgICAgaWRlbnRpZmllcjogUFNCVF9QUk9QUklFVEFSWV9JREVOVElGSUVSLFxyXG4gICAgICAgICAgc3VidHlwZTogUHJvcHJpZXRhcnlLZXlTdWJ0eXBlLk1VU0lHMl9QVUJfTk9OQ0UsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgYXNzZXJ0LnN0cmljdEVxdWFsKG5vbmNlc0tleVZhbHMubGVuZ3RoLCAxKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBpdCgnQ29zaWduZXIgY2Fubm90IGFkZCBlbnRyb3B5IHRvIGRldGVybWluaXN0aWMgbm9uY2UgY3JlYXRpb24nLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgY29uc3QgcHNidCA9IGNvbnN0cnVjdFBzYnQocDJ0ck11c2lnMlVuc3BlbnQsIHJvb3RXYWxsZXRLZXlzLCAndXNlcicsICdiaXRnbycsICdwMnNoJyk7XHJcbiAgICAgICAgcHNidC5zZXRBbGxJbnB1dHNNdXNpZzJOb25jZUhEKHJvb3RXYWxsZXRLZXlzLnVzZXIpO1xyXG4gICAgICAgIGFzc2VydC50aHJvd3MoXHJcbiAgICAgICAgICAoKSA9PlxyXG4gICAgICAgICAgICBwc2J0LnNldEFsbElucHV0c011c2lnMk5vbmNlSEQocm9vdFdhbGxldEtleXMuYml0Z28sIHtcclxuICAgICAgICAgICAgICBkZXRlcm1pbmlzdGljOiB0cnVlLFxyXG4gICAgICAgICAgICAgIHNlc3Npb25JZDogQnVmZmVyLmFsbG9jVW5zYWZlKDMyKSxcclxuICAgICAgICAgICAgfSksXHJcbiAgICAgICAgICAoZTogYW55KSA9PiBlLm1lc3NhZ2UgPT09ICdDYW5ub3QgYWRkIGV4dHJhIGVudHJvcHkgd2hlbiBnZW5lcmF0aW5nIGEgZGV0ZXJtaW5pc3RpYyBub25jZSdcclxuICAgICAgICApO1xyXG4gICAgICAgIGNvbnN0IG5vbmNlc0tleVZhbHMgPSBwc2J0LmdldFByb3ByaWV0YXJ5S2V5VmFscygwLCB7XHJcbiAgICAgICAgICBpZGVudGlmaWVyOiBQU0JUX1BST1BSSUVUQVJZX0lERU5USUZJRVIsXHJcbiAgICAgICAgICBzdWJ0eXBlOiBQcm9wcmlldGFyeUtleVN1YnR5cGUuTVVTSUcyX1BVQl9OT05DRSxcclxuICAgICAgICB9KTtcclxuICAgICAgICBhc3NlcnQuc3RyaWN0RXF1YWwobm9uY2VzS2V5VmFscy5sZW5ndGgsIDEpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGl0KCdTaWduZXIgY2Fubm90IGNyZWF0ZSBhIGRldGVybWluaXN0aWMgbm9uY2UnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgY29uc3QgcHNidCA9IGNvbnN0cnVjdFBzYnQocDJ0ck11c2lnMlVuc3BlbnQsIHJvb3RXYWxsZXRLZXlzLCAndXNlcicsICdiaXRnbycsICdwMnNoJyk7XHJcbiAgICAgICAgYXNzZXJ0LnRocm93cyhcclxuICAgICAgICAgICgpID0+IHBzYnQuc2V0QWxsSW5wdXRzTXVzaWcyTm9uY2VIRChyb290V2FsbGV0S2V5cy51c2VyLCB7IGRldGVybWluaXN0aWM6IHRydWUgfSksXHJcbiAgICAgICAgICAoZTogYW55KSA9PiBlLm1lc3NhZ2UgPT09IGBPbmx5IHRoZSBjb3NpZ25lcidzIG5vbmNlIGNhbiBiZSBzZXQgZGV0ZXJtaW5pc3RpY2FsbHlgXHJcbiAgICAgICAgKTtcclxuICAgICAgICBjb25zdCBub25jZXNLZXlWYWxzID0gcHNidC5nZXRQcm9wcmlldGFyeUtleVZhbHMoMCwge1xyXG4gICAgICAgICAgaWRlbnRpZmllcjogUFNCVF9QUk9QUklFVEFSWV9JREVOVElGSUVSLFxyXG4gICAgICAgICAgc3VidHlwZTogUHJvcHJpZXRhcnlLZXlTdWJ0eXBlLk1VU0lHMl9QVUJfTk9OQ0UsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgYXNzZXJ0LnN0cmljdEVxdWFsKG5vbmNlc0tleVZhbHMubGVuZ3RoLCAwKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBpdChgc2tpcHBlZCBpZiB0YXBJbnRlcm5hbEtleSBkb2Vzbid0IG1hdGNoIHBhcnRpY2lwYW50IHB1YiBrZXlzIGFnZ2AsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBjb25zdCBwc2J0ID0gY29uc3RydWN0UHNidChwMnRyTXVzaWcyVW5zcGVudCwgcm9vdFdhbGxldEtleXMsICd1c2VyJywgJ2JpdGdvJywgJ3Ayc2gnKTtcclxuICAgICAgICBwc2J0LmRhdGEuaW5wdXRzWzBdLnRhcEludGVybmFsS2V5ID0gZHVtbXlUYXBJbnRlcm5hbEtleTtcclxuICAgICAgICBhc3NlcnQudGhyb3dzKFxyXG4gICAgICAgICAgKCkgPT4gcHNidC5zZXRBbGxJbnB1dHNNdXNpZzJOb25jZUhEKHJvb3RXYWxsZXRLZXlzLnVzZXIpLFxyXG4gICAgICAgICAgKGU6IGFueSkgPT4gZS5tZXNzYWdlID09PSAndGFwSW50ZXJuYWxLZXkgYW5kIGFnZ3JlZ2F0ZWQgcGFydGljaXBhbnQgcHViIGtleXMgZG9lcyBub3QgbWF0Y2gnXHJcbiAgICAgICAgKTtcclxuICAgICAgICBhc3NlcnQuc3RyaWN0RXF1YWwocHNidC5nZXRQcm9wcmlldGFyeUtleVZhbHMoMCkubGVuZ3RoLCAxKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBpdChgZmFpbHMgaWYgc2Vzc2lvbklkIHNpemUgaXMgaW52YWxpZGAsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBjb25zdCBwc2J0ID0gY29uc3RydWN0UHNidChwMnRyTXVzaWcyVW5zcGVudCwgcm9vdFdhbGxldEtleXMsICd1c2VyJywgJ2JpdGdvJywgJ3Ayc2gnKTtcclxuICAgICAgICBhc3NlcnQudGhyb3dzKFxyXG4gICAgICAgICAgKCkgPT4gcHNidC5zZXRBbGxJbnB1dHNNdXNpZzJOb25jZUhEKHJvb3RXYWxsZXRLZXlzLnVzZXIsIHsgc2Vzc2lvbklkOiBCdWZmZXIuYWxsb2NVbnNhZmUoMzMpIH0pLFxyXG4gICAgICAgICAgKGU6IGFueSkgPT4gZS5tZXNzYWdlID09PSAnSW52YWxpZCBzZXNzaW9uSWQgc2l6ZSAzMydcclxuICAgICAgICApO1xyXG4gICAgICAgIGFzc2VydC5zdHJpY3RFcXVhbChwc2J0LmdldFByb3ByaWV0YXJ5S2V5VmFscygwKS5sZW5ndGgsIDEpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGl0KGBmYWlscyBpZiBwcml2YXRlIGtleSBpcyBtaXNzaW5nYCwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGNvbnN0IHBzYnQgPSBjb25zdHJ1Y3RQc2J0KHAydHJNdXNpZzJVbnNwZW50LCByb290V2FsbGV0S2V5cywgJ3VzZXInLCAnYml0Z28nLCAncDJzaCcpO1xyXG4gICAgICAgIGFzc2VydC50aHJvd3MoXHJcbiAgICAgICAgICAoKSA9PiBwc2J0LnNldEFsbElucHV0c011c2lnMk5vbmNlSEQocm9vdFdhbGxldEtleXMudXNlci5uZXV0ZXJlZCgpKSxcclxuICAgICAgICAgIChlOiBhbnkpID0+IGUubWVzc2FnZSA9PT0gJ3ByaXZhdGUga2V5IGlzIHJlcXVpcmVkIHRvIGdlbmVyYXRlIG5vbmNlJ1xyXG4gICAgICAgICk7XHJcbiAgICAgICAgYXNzZXJ0LnN0cmljdEVxdWFsKHBzYnQuZ2V0UHJvcHJpZXRhcnlLZXlWYWxzKDApLmxlbmd0aCwgMSk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgaXQoYGZhaWxzIGlmIHRhcEJpcDMyRGVyaXZhdGlvbiBpcyBtaXNzaW5nYCwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGNvbnN0IHBzYnQgPSBjb25zdHJ1Y3RQc2J0KHAydHJNdXNpZzJVbnNwZW50LCByb290V2FsbGV0S2V5cywgJ3VzZXInLCAnYml0Z28nLCAncDJzaCcpO1xyXG4gICAgICAgIHBzYnQuZGF0YS5pbnB1dHNbMF0udGFwQmlwMzJEZXJpdmF0aW9uID0gW107XHJcbiAgICAgICAgYXNzZXJ0LnRocm93cyhcclxuICAgICAgICAgICgpID0+IHBzYnQuc2V0QWxsSW5wdXRzTXVzaWcyTm9uY2VIRChyb290V2FsbGV0S2V5cy51c2VyKSxcclxuICAgICAgICAgIChlOiBhbnkpID0+IGUubWVzc2FnZSA9PT0gJ3RhcEJpcDMyRGVyaXZhdGlvbiBpcyByZXF1aXJlZCB0byBjcmVhdGUgbm9uY2UnXHJcbiAgICAgICAgKTtcclxuICAgICAgICBhc3NlcnQuc3RyaWN0RXF1YWwocHNidC5nZXRQcm9wcmlldGFyeUtleVZhbHMoMCkubGVuZ3RoLCAxKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBpdChgZmFpbHMgaWYgcGFydGljaXBhbnQgcHViIGtleXMgaXMgbWlzc2luZ2AsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBjb25zdCBwc2J0ID0gY29uc3RydWN0UHNidChwMnRyTXVzaWcyVW5zcGVudCwgcm9vdFdhbGxldEtleXMsICd1c2VyJywgJ2JpdGdvJywgJ3Ayc2gnKTtcclxuICAgICAgICBwc2J0LmRhdGEuaW5wdXRzWzBdLnVua25vd25LZXlWYWxzID0gW107XHJcbiAgICAgICAgYXNzZXJ0LnRocm93cyhcclxuICAgICAgICAgICgpID0+IHBzYnQuc2V0QWxsSW5wdXRzTXVzaWcyTm9uY2VIRChyb290V2FsbGV0S2V5cy51c2VyKSxcclxuICAgICAgICAgIChlOiBhbnkpID0+IGUubWVzc2FnZSA9PT0gJ0ZvdW5kIDAgbWF0Y2hpbmcgcGFydGljaXBhbnQga2V5IHZhbHVlIGluc3RlYWQgb2YgMSdcclxuICAgICAgICApO1xyXG4gICAgICAgIGFzc2VydC5zdHJpY3RFcXVhbChwc2J0LmdldFByb3ByaWV0YXJ5S2V5VmFscygwKS5sZW5ndGgsIDApO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGl0KGBmYWlscyBpZiBwYXJ0aWNpcGFudCBwdWIga2V5cyBrZXlkYXRhIHNpemUgaXMgaW52YWxpZGAsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBjb25zdCBwc2J0ID0gY29uc3RydWN0UHNidChwMnRyTXVzaWcyVW5zcGVudCwgcm9vdFdhbGxldEtleXMsICd1c2VyJywgJ2JpdGdvJywgJ3Ayc2gnKTtcclxuICAgICAgICBjb25zdCBrZXlWYWxzID0gcHNidC5nZXRQcm9wcmlldGFyeUtleVZhbHMoMCk7XHJcbiAgICAgICAga2V5VmFsc1swXS5rZXkua2V5ZGF0YSA9IEJ1ZmZlci5jb25jYXQoW2tleVZhbHNbMF0ua2V5LmtleWRhdGEsIEJ1ZmZlci5mcm9tKCdkdW1teScpXSk7XHJcbiAgICAgICAgcHNidC5kYXRhLmlucHV0c1swXS51bmtub3duS2V5VmFscyA9IFtdO1xyXG4gICAgICAgIHBzYnQuYWRkUHJvcHJpZXRhcnlLZXlWYWxUb0lucHV0KDAsIGtleVZhbHNbMF0pO1xyXG4gICAgICAgIGFzc2VydC50aHJvd3MoXHJcbiAgICAgICAgICAoKSA9PiBwc2J0LnNldEFsbElucHV0c011c2lnMk5vbmNlSEQocm9vdFdhbGxldEtleXMudXNlciksXHJcbiAgICAgICAgICAoZTogYW55KSA9PiBlLm1lc3NhZ2UgPT09IGBJbnZhbGlkIGtleWRhdGEgc2l6ZSAke2tleVZhbHNbMF0ua2V5LmtleWRhdGEubGVuZ3RofSBmb3IgcGFydGljaXBhbnQgcHViIGtleXNgXHJcbiAgICAgICAgKTtcclxuICAgICAgICBhc3NlcnQuc3RyaWN0RXF1YWwocHNidC5nZXRQcm9wcmlldGFyeUtleVZhbHMoMCkubGVuZ3RoLCAxKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBpdChgZmFpbHMgaWYgcGFydGljaXBhbnQga2V5ZGF0YSB0YXBPdXRwdXRLZXkgaW4gaW52YWxpZGAsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBjb25zdCBwc2J0ID0gY29uc3RydWN0UHNidChwMnRyTXVzaWcyVW5zcGVudCwgcm9vdFdhbGxldEtleXMsICd1c2VyJywgJ2JpdGdvJywgJ3Ayc2gnKTtcclxuICAgICAgICBjb25zdCBrZXlWYWxzID0gcHNidC5nZXRQcm9wcmlldGFyeUtleVZhbHMoMCk7XHJcbiAgICAgICAga2V5VmFsc1swXS5rZXkua2V5ZGF0YSA9IEJ1ZmZlci5jb25jYXQoW2R1bW15VGFwT3V0cHV0S2V5LCBrZXlWYWxzWzBdLmtleS5rZXlkYXRhLnN1YmFycmF5KDMyKV0pO1xyXG4gICAgICAgIHBzYnQuZGF0YS5pbnB1dHNbMF0udW5rbm93bktleVZhbHMgPSBbXTtcclxuICAgICAgICBwc2J0LmFkZFByb3ByaWV0YXJ5S2V5VmFsVG9JbnB1dCgwLCBrZXlWYWxzWzBdKTtcclxuICAgICAgICBhc3NlcnQudGhyb3dzKFxyXG4gICAgICAgICAgKCkgPT4gcHNidC5zZXRBbGxJbnB1dHNNdXNpZzJOb25jZUhEKHJvb3RXYWxsZXRLZXlzLnVzZXIpLFxyXG4gICAgICAgICAgKGU6IGFueSkgPT4gZS5tZXNzYWdlID09PSBgSW52YWxpZCBwYXJ0aWNpcGFudHMga2V5ZGF0YSB0YXBPdXRwdXRLZXlgXHJcbiAgICAgICAgKTtcclxuICAgICAgICBhc3NlcnQuc3RyaWN0RXF1YWwocHNidC5nZXRQcm9wcmlldGFyeUtleVZhbHMoMCkubGVuZ3RoLCAxKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBpdChgZmFpbHMgaWYgcGFydGljaXBhbnQga2V5ZGF0YSB0YXBJbnRlcm5hbEtleSBpbiBpbnZhbGlkYCwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGNvbnN0IHBzYnQgPSBjb25zdHJ1Y3RQc2J0KHAydHJNdXNpZzJVbnNwZW50LCByb290V2FsbGV0S2V5cywgJ3VzZXInLCAnYml0Z28nLCAncDJzaCcpO1xyXG4gICAgICAgIGNvbnN0IGtleVZhbHMgPSBwc2J0LmdldFByb3ByaWV0YXJ5S2V5VmFscygwKTtcclxuICAgICAgICBrZXlWYWxzWzBdLmtleS5rZXlkYXRhID0gQnVmZmVyLmNvbmNhdChba2V5VmFsc1swXS5rZXkua2V5ZGF0YS5zdWJhcnJheSgwLCAzMiksIGR1bW15VGFwSW50ZXJuYWxLZXldKTtcclxuICAgICAgICBwc2J0LmRhdGEuaW5wdXRzWzBdLnVua25vd25LZXlWYWxzID0gW107XHJcbiAgICAgICAgcHNidC5hZGRQcm9wcmlldGFyeUtleVZhbFRvSW5wdXQoMCwga2V5VmFsc1swXSk7XHJcbiAgICAgICAgYXNzZXJ0LnRocm93cyhcclxuICAgICAgICAgICgpID0+IHBzYnQuc2V0QWxsSW5wdXRzTXVzaWcyTm9uY2VIRChyb290V2FsbGV0S2V5cy51c2VyKSxcclxuICAgICAgICAgIChlOiBhbnkpID0+IGUubWVzc2FnZSA9PT0gYEludmFsaWQgcGFydGljaXBhbnRzIGtleWRhdGEgdGFwSW50ZXJuYWxLZXlgXHJcbiAgICAgICAgKTtcclxuICAgICAgICBhc3NlcnQuc3RyaWN0RXF1YWwocHNidC5nZXRQcm9wcmlldGFyeUtleVZhbHMoMCkubGVuZ3RoLCAxKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBpdChgZmFpbHMgaWYgdGFwSW50ZXJuYWxLZXkgYW5kIGFnZ3JlZ2F0ZWQgcGFydGljaXBhbnQgcHViIGtleXMgZG9uJ3QgbWF0Y2hgLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgY29uc3QgcHNidCA9IGNvbnN0cnVjdFBzYnQocDJ0ck11c2lnMlVuc3BlbnQsIHJvb3RXYWxsZXRLZXlzLCAndXNlcicsICdiaXRnbycsICdwMnNoJyk7XHJcbiAgICAgICAgY29uc3Qga2V5VmFscyA9IHBzYnQuZ2V0UHJvcHJpZXRhcnlLZXlWYWxzKDApO1xyXG5cclxuICAgICAgICBjb25zdCB3YWxsZXRLZXlzID0gcm9vdFdhbGxldEtleXMuZGVyaXZlRm9yQ2hhaW5BbmRJbmRleChnZXRJbnRlcm5hbENoYWluQ29kZSgncDJ0ck11c2lnMicpLCAxKTtcclxuICAgICAgICBjb25zdCB0YXBJbnRlcm5hbEtleSA9IGNyZWF0ZVRhcEludGVybmFsS2V5KFt3YWxsZXRLZXlzLnVzZXIucHVibGljS2V5LCB3YWxsZXRLZXlzLmJpdGdvLnB1YmxpY0tleV0pO1xyXG4gICAgICAgIGNvbnN0IHRhcE91dHB1dEtleSA9IGNyZWF0ZVRhcE91dHB1dEtleSh0YXBJbnRlcm5hbEtleSwgcHNidC5kYXRhLmlucHV0c1swXS50YXBNZXJrbGVSb290ISk7XHJcblxyXG4gICAgICAgIGtleVZhbHNbMF0ua2V5LmtleWRhdGEgPSBCdWZmZXIuY29uY2F0KFt0YXBPdXRwdXRLZXksIHRhcEludGVybmFsS2V5XSk7XHJcbiAgICAgICAga2V5VmFsc1swXS52YWx1ZSA9IEJ1ZmZlci5jb25jYXQoW3dhbGxldEtleXMudXNlci5wdWJsaWNLZXksIHdhbGxldEtleXMuYml0Z28ucHVibGljS2V5XSk7XHJcblxyXG4gICAgICAgIHBzYnQuZGF0YS5pbnB1dHNbMF0udW5rbm93bktleVZhbHMgPSBbXTtcclxuICAgICAgICBwc2J0LmFkZFByb3ByaWV0YXJ5S2V5VmFsVG9JbnB1dCgwLCBrZXlWYWxzWzBdKTtcclxuICAgICAgICBhc3NlcnQudGhyb3dzKFxyXG4gICAgICAgICAgKCkgPT4gcHNidC5zZXRBbGxJbnB1dHNNdXNpZzJOb25jZUhEKHJvb3RXYWxsZXRLZXlzLnVzZXIpLFxyXG4gICAgICAgICAgKGU6IGFueSkgPT4gZS5tZXNzYWdlID09PSBgdGFwSW50ZXJuYWxLZXkgYW5kIGFnZ3JlZ2F0ZWQgcGFydGljaXBhbnQgcHViIGtleXMgZG9lcyBub3QgbWF0Y2hgXHJcbiAgICAgICAgKTtcclxuICAgICAgICBhc3NlcnQuc3RyaWN0RXF1YWwocHNidC5nZXRQcm9wcmlldGFyeUtleVZhbHMoMCkubGVuZ3RoLCAxKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBpdChgZmFpbHMgaWYga2V5ZGF0YSBzaXplIG9mIHBhcnRpY2lwYW50IHB1YiBrZXlzIGlzIGludmFsaWRgLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgY29uc3QgcHNidCA9IGNvbnN0cnVjdFBzYnQocDJ0ck11c2lnMlVuc3BlbnQsIHJvb3RXYWxsZXRLZXlzLCAndXNlcicsICdiaXRnbycsICdwMnNoJyk7XHJcbiAgICAgICAgY29uc3Qga2V5VmFscyA9IHBzYnQuZ2V0UHJvcHJpZXRhcnlLZXlWYWxzKDApO1xyXG4gICAgICAgIGtleVZhbHNbMF0ua2V5LmtleWRhdGEgPSBCdWZmZXIuYWxsb2NVbnNhZmUoNjUpO1xyXG4gICAgICAgIHBzYnQuZGF0YS5pbnB1dHNbMF0udW5rbm93bktleVZhbHMgPSBbXTtcclxuICAgICAgICBwc2J0LmFkZFByb3ByaWV0YXJ5S2V5VmFsVG9JbnB1dCgwLCBrZXlWYWxzWzBdKTtcclxuICAgICAgICBhc3NlcnQudGhyb3dzKFxyXG4gICAgICAgICAgKCkgPT4gcHNidC5zZXRBbGxJbnB1dHNNdXNpZzJOb25jZUhEKHJvb3RXYWxsZXRLZXlzLnVzZXIpLFxyXG4gICAgICAgICAgKGU6IGFueSkgPT4gZS5tZXNzYWdlID09PSBgSW52YWxpZCBrZXlkYXRhIHNpemUgNjUgZm9yIHBhcnRpY2lwYW50IHB1YiBrZXlzYFxyXG4gICAgICAgICk7XHJcbiAgICAgICAgYXNzZXJ0LnN0cmljdEVxdWFsKHBzYnQuZ2V0UHJvcHJpZXRhcnlLZXlWYWxzKDApLmxlbmd0aCwgMSk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgaXQoYGZhaWxzIGlmIHZhbHVlZGF0YSBzaXplIG9mIHBhcnRpY2lwYW50IHB1YiBrZXlzIGlzIGludmFsaWRgLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgY29uc3QgcHNidCA9IGNvbnN0cnVjdFBzYnQocDJ0ck11c2lnMlVuc3BlbnQsIHJvb3RXYWxsZXRLZXlzLCAndXNlcicsICdiaXRnbycsICdwMnNoJyk7XHJcbiAgICAgICAgY29uc3Qga2V5VmFscyA9IHBzYnQuZ2V0UHJvcHJpZXRhcnlLZXlWYWxzKDApO1xyXG4gICAgICAgIGtleVZhbHNbMF0udmFsdWUgPSBCdWZmZXIuYWxsb2NVbnNhZmUoNjcpO1xyXG4gICAgICAgIHBzYnQuZGF0YS5pbnB1dHNbMF0udW5rbm93bktleVZhbHMgPSBbXTtcclxuICAgICAgICBwc2J0LmFkZFByb3ByaWV0YXJ5S2V5VmFsVG9JbnB1dCgwLCBrZXlWYWxzWzBdKTtcclxuICAgICAgICBhc3NlcnQudGhyb3dzKFxyXG4gICAgICAgICAgKCkgPT4gcHNidC5zZXRBbGxJbnB1dHNNdXNpZzJOb25jZUhEKHJvb3RXYWxsZXRLZXlzLnVzZXIpLFxyXG4gICAgICAgICAgKGU6IGFueSkgPT4gZS5tZXNzYWdlID09PSBgSW52YWxpZCB2YWx1ZWRhdGEgc2l6ZSA2NyBmb3IgcGFydGljaXBhbnQgcHViIGtleXNgXHJcbiAgICAgICAgKTtcclxuICAgICAgICBhc3NlcnQuc3RyaWN0RXF1YWwocHNidC5nZXRQcm9wcmlldGFyeUtleVZhbHMoMCkubGVuZ3RoLCAxKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBpdChgZmFpbHMgaWYgZHVwbGljYXRlIHBhcnRpY2lwYW50IHB1YiBrZXlzIGZvdW5kYCwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGNvbnN0IHBzYnQgPSBjb25zdHJ1Y3RQc2J0KHAydHJNdXNpZzJVbnNwZW50LCByb290V2FsbGV0S2V5cywgJ3VzZXInLCAnYml0Z28nLCAncDJzaCcpO1xyXG4gICAgICAgIGNvbnN0IGtleVZhbHMgPSBwc2J0LmdldFByb3ByaWV0YXJ5S2V5VmFscygwKTtcclxuICAgICAgICBrZXlWYWxzWzBdLnZhbHVlID0gQnVmZmVyLmNvbmNhdChba2V5VmFsc1swXS52YWx1ZS5zdWJhcnJheSgzMyksIGtleVZhbHNbMF0udmFsdWUuc3ViYXJyYXkoMzMpXSk7XHJcbiAgICAgICAgcHNidC5kYXRhLmlucHV0c1swXS51bmtub3duS2V5VmFscyA9IFtdO1xyXG4gICAgICAgIHBzYnQuYWRkUHJvcHJpZXRhcnlLZXlWYWxUb0lucHV0KDAsIGtleVZhbHNbMF0pO1xyXG4gICAgICAgIGFzc2VydC50aHJvd3MoXHJcbiAgICAgICAgICAoKSA9PiBwc2J0LnNldEFsbElucHV0c011c2lnMk5vbmNlSEQocm9vdFdhbGxldEtleXMudXNlciksXHJcbiAgICAgICAgICAoZTogYW55KSA9PiBlLm1lc3NhZ2UgPT09IGBEdXBsaWNhdGUgcGFydGljaXBhbnQgcHViIGtleXMgZm91bmRgXHJcbiAgICAgICAgKTtcclxuICAgICAgICBhc3NlcnQuc3RyaWN0RXF1YWwocHNidC5nZXRQcm9wcmlldGFyeUtleVZhbHMoMCkubGVuZ3RoLCAxKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBpdChgZmFpbHMgaWYgbm8gZmluZ2VycHJpbnQgbWF0Y2hgLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgY29uc3QgcHNidCA9IGNvbnN0cnVjdFBzYnQocDJ0ck11c2lnMlVuc3BlbnQsIHJvb3RXYWxsZXRLZXlzLCAndXNlcicsICdiaXRnbycsICdwMnNoJyk7XHJcbiAgICAgICAgcHNidC5kYXRhLmlucHV0c1swXS50YXBCaXAzMkRlcml2YXRpb24/LmZvckVhY2goKGJ2KSA9PiAoYnYubWFzdGVyRmluZ2VycHJpbnQgPSBCdWZmZXIuYWxsb2NVbnNhZmUoNCkpKTtcclxuICAgICAgICBhc3NlcnQudGhyb3dzKFxyXG4gICAgICAgICAgKCkgPT4gcHNidC5zZXRBbGxJbnB1dHNNdXNpZzJOb25jZUhEKHJvb3RXYWxsZXRLZXlzLnVzZXIpLFxyXG4gICAgICAgICAgKGU6IGFueSkgPT4gZS5tZXNzYWdlID09PSAnTm8gYmlwMzJEZXJpdmF0aW9uIG1hc3RlckZpbmdlcnByaW50IG1hdGNoZWQgdGhlIEhEIGtleVBhaXIgZmluZ2VycHJpbnQnXHJcbiAgICAgICAgKTtcclxuICAgICAgICBhc3NlcnQuc3RyaWN0RXF1YWwocHNidC5nZXRQcm9wcmlldGFyeUtleVZhbHMoMCkubGVuZ3RoLCAxKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBpdChgZmFpbHMgaWYgcHVia2V5IGRpZCBub3QgbWF0Y2ggdGFwQmlwMzJEZXJpdmF0aW9uYCwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGNvbnN0IHBzYnQgPSBjb25zdHJ1Y3RQc2J0KHAydHJNdXNpZzJVbnNwZW50LCByb290V2FsbGV0S2V5cywgJ3VzZXInLCAnYml0Z28nLCAncDJzaCcpO1xyXG4gICAgICAgIGNvbnN0IHdhbGxldEtleXMgPSByb290V2FsbGV0S2V5cy5kZXJpdmVGb3JDaGFpbkFuZEluZGV4KGdldEludGVybmFsQ2hhaW5Db2RlKCdwMnRyTXVzaWcyJyksIENIQU5HRV9JTkRFWCk7XHJcbiAgICAgICAgcHNidC5kYXRhLmlucHV0c1swXS50YXBCaXAzMkRlcml2YXRpb24/LmZvckVhY2goKGJ2KSA9PiB7XHJcbiAgICAgICAgICBidi5wYXRoID0gd2FsbGV0S2V5cy5wYXRoc1syXTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBhc3NlcnQudGhyb3dzKFxyXG4gICAgICAgICAgKCkgPT4gcHNidC5zZXRBbGxJbnB1dHNNdXNpZzJOb25jZUhEKHJvb3RXYWxsZXRLZXlzLnVzZXIpLFxyXG4gICAgICAgICAgKGU6IGFueSkgPT4gZS5tZXNzYWdlID09PSAncHVia2V5IGRpZCBub3QgbWF0Y2ggYmlwMzJEZXJpdmF0aW9uJ1xyXG4gICAgICAgICk7XHJcbiAgICAgICAgYXNzZXJ0LnN0cmljdEVxdWFsKHBzYnQuZ2V0UHJvcHJpZXRhcnlLZXlWYWxzKDApLmxlbmd0aCwgMSk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgaXQoYGZhaWxzIGlmIHJvb3Qgd2FsbGV0IGtleSBkZXJpdmUgbW9yZSB0aGFuIG9uZSB0YXBCaXAzMkRlcml2YXRpb25gLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgY29uc3QgcHNidCA9IGNvbnN0cnVjdFBzYnQocDJ0ck11c2lnMlVuc3BlbnQsIHJvb3RXYWxsZXRLZXlzLCAndXNlcicsICdiaXRnbycsICdwMnNoJyk7XHJcbiAgICAgICAgY29uc3Qgd2FsbGV0S2V5cyA9IHJvb3RXYWxsZXRLZXlzLmRlcml2ZUZvckNoYWluQW5kSW5kZXgoXHJcbiAgICAgICAgICBwMnRyTXVzaWcyVW5zcGVudFswXS5jaGFpbixcclxuICAgICAgICAgIHAydHJNdXNpZzJVbnNwZW50WzBdLmluZGV4XHJcbiAgICAgICAgKTtcclxuICAgICAgICBwc2J0LmRhdGEuaW5wdXRzWzBdLnRhcEJpcDMyRGVyaXZhdGlvbj8uZm9yRWFjaCgoYnYsIGluZGV4KSA9PiB7XHJcbiAgICAgICAgICBidi5wYXRoID0gd2FsbGV0S2V5cy5wYXRoc1swXTtcclxuICAgICAgICAgIGJ2LnB1YmtleSA9IHRvWE9ubHlQdWJsaWNLZXkod2FsbGV0S2V5cy5wdWJsaWNLZXlzWzBdKTtcclxuICAgICAgICAgIGJ2Lm1hc3RlckZpbmdlcnByaW50ID0gcm9vdFdhbGxldEtleXMudXNlci5maW5nZXJwcmludDtcclxuICAgICAgICB9KTtcclxuICAgICAgICBhc3NlcnQudGhyb3dzKFxyXG4gICAgICAgICAgKCkgPT4gcHNidC5zZXRBbGxJbnB1dHNNdXNpZzJOb25jZUhEKHJvb3RXYWxsZXRLZXlzLnVzZXIpLFxyXG4gICAgICAgICAgKGU6IGFueSkgPT4gZS5tZXNzYWdlLnN0YXJ0c1dpdGgoJ21vcmUgdGhhbiBvbmUgbWF0Y2hpbmcgZGVyaXZhdGlvbiBmb3IgZmluZ2VycHJpbnQnKVxyXG4gICAgICAgICk7XHJcbiAgICAgICAgYXNzZXJ0LnN0cmljdEVxdWFsKHBzYnQuZ2V0UHJvcHJpZXRhcnlLZXlWYWxzKDApLmxlbmd0aCwgMSk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgaXQoYGZhaWxzIGlmIGRlcml2ZWQgd2FsbGV0IGtleSBkb2VzIG5vdCBtYXRjaCBhbnkgcGFydGljaXBhbnQga2V5YCwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGNvbnN0IHBzYnQgPSBjb25zdHJ1Y3RQc2J0KHAydHJNdXNpZzJVbnNwZW50LCByb290V2FsbGV0S2V5cywgJ3VzZXInLCAnYml0Z28nLCAncDJzaCcpO1xyXG4gICAgICAgIGNvbnN0IGtleVZhbHMgPSBwc2J0LmdldFByb3ByaWV0YXJ5S2V5VmFscygwKTtcclxuXHJcbiAgICAgICAgY29uc3Qgd2FsbGV0S2V5cyA9IHJvb3RXYWxsZXRLZXlzLmRlcml2ZUZvckNoYWluQW5kSW5kZXgoZ2V0SW50ZXJuYWxDaGFpbkNvZGUoJ3AydHJNdXNpZzInKSwgMSk7XHJcbiAgICAgICAgY29uc3QgdGFwSW50ZXJuYWxLZXkgPSBjcmVhdGVUYXBJbnRlcm5hbEtleShbd2FsbGV0S2V5cy51c2VyLnB1YmxpY0tleSwgd2FsbGV0S2V5cy5iaXRnby5wdWJsaWNLZXldKTtcclxuICAgICAgICBwc2J0LmRhdGEuaW5wdXRzWzBdLnRhcEludGVybmFsS2V5ID0gdGFwSW50ZXJuYWxLZXk7XHJcblxyXG4gICAgICAgIGtleVZhbHNbMF0udmFsdWUgPSBCdWZmZXIuY29uY2F0KFt3YWxsZXRLZXlzLnVzZXIucHVibGljS2V5LCB3YWxsZXRLZXlzLmJpdGdvLnB1YmxpY0tleV0pO1xyXG4gICAgICAgIGNvbnN0IHRhcE91dHB1dEtleSA9IGNyZWF0ZVRhcE91dHB1dEtleSh0YXBJbnRlcm5hbEtleSwgcHNidC5kYXRhLmlucHV0c1swXS50YXBNZXJrbGVSb290ISk7XHJcbiAgICAgICAga2V5VmFsc1swXS5rZXkua2V5ZGF0YSA9IEJ1ZmZlci5jb25jYXQoW3RhcE91dHB1dEtleSwgdGFwSW50ZXJuYWxLZXldKTtcclxuICAgICAgICBwc2J0LmRhdGEuaW5wdXRzWzBdLnVua25vd25LZXlWYWxzID0gW107XHJcbiAgICAgICAgcHNidC5hZGRQcm9wcmlldGFyeUtleVZhbFRvSW5wdXQoMCwga2V5VmFsc1swXSk7XHJcblxyXG4gICAgICAgIGFzc2VydC50aHJvd3MoXHJcbiAgICAgICAgICAoKSA9PiBwc2J0LnNldEFsbElucHV0c011c2lnMk5vbmNlSEQocm9vdFdhbGxldEtleXMudXNlciksXHJcbiAgICAgICAgICAoZTogYW55KSA9PiBlLm1lc3NhZ2UgPT09IGBwYXJ0aWNpcGFudCBwbGFpbiBwdWIga2V5IHNob3VsZCBtYXRjaCBvbmUgYmlwMzJEZXJpdmF0aW9uIHBsYWluIHB1YiBrZXlgXHJcbiAgICAgICAgKTtcclxuICAgICAgICBhc3NlcnQuc3RyaWN0RXF1YWwocHNidC5nZXRQcm9wcmlldGFyeUtleVZhbHMoMCkubGVuZ3RoLCAxKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnc2lnbicsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgaXQoYGZhaWxzIGlmIHByaXZhdGVLZXkgaXMgbWlzc2luZ2AsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBjb25zdCBwc2J0ID0gY29uc3RydWN0UHNidChwMnRyTXVzaWcyVW5zcGVudCwgcm9vdFdhbGxldEtleXMsICd1c2VyJywgJ2JpdGdvJywgJ3Ayc2gnKTtcclxuICAgICAgICBwc2J0LnNldEFsbElucHV0c011c2lnMk5vbmNlSEQocm9vdFdhbGxldEtleXMudXNlcik7XHJcbiAgICAgICAgcHNidC5zZXRBbGxJbnB1dHNNdXNpZzJOb25jZUhEKHJvb3RXYWxsZXRLZXlzLmJpdGdvKTtcclxuICAgICAgICBhc3NlcnQudGhyb3dzKFxyXG4gICAgICAgICAgKCkgPT4gcHNidC5zaWduVGFwcm9vdElucHV0SEQoMCwgcm9vdFdhbGxldEtleXMudXNlci5uZXV0ZXJlZCgpKSxcclxuICAgICAgICAgIChlOiBhbnkpID0+IGUubWVzc2FnZSA9PT0gJ3ByaXZhdGVLZXkgaXMgcmVxdWlyZWQgdG8gc2lnbiBwMnRyIG11c2lnMidcclxuICAgICAgICApO1xyXG4gICAgICAgIGFzc2VydC5zdHJpY3RFcXVhbChwc2J0LmdldFByb3ByaWV0YXJ5S2V5VmFscygwKS5sZW5ndGgsIDMpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGl0KGBmYWlscyBpZiB0YXBJbnRlcm5hbEtleSBpcyBtaXNzaW5nYCwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGNvbnN0IHBzYnQgPSBjb25zdHJ1Y3RQc2J0KHAydHJNdXNpZzJVbnNwZW50LCByb290V2FsbGV0S2V5cywgJ3VzZXInLCAnYml0Z28nLCAncDJzaCcpO1xyXG5cclxuICAgICAgICBjb25zdCB3YWxsZXRLZXlzID0gcm9vdFdhbGxldEtleXMuZGVyaXZlRm9yQ2hhaW5BbmRJbmRleChcclxuICAgICAgICAgIHAydHJNdXNpZzJVbnNwZW50WzBdLmNoYWluLFxyXG4gICAgICAgICAgcDJ0ck11c2lnMlVuc3BlbnRbMF0uaW5kZXhcclxuICAgICAgICApO1xyXG5cclxuICAgICAgICBwc2J0LnNldEFsbElucHV0c011c2lnMk5vbmNlSEQocm9vdFdhbGxldEtleXMudXNlcik7XHJcbiAgICAgICAgcHNidC5zZXRBbGxJbnB1dHNNdXNpZzJOb25jZUhEKHJvb3RXYWxsZXRLZXlzLmJpdGdvKTtcclxuXHJcbiAgICAgICAgcHNidC5kYXRhLmlucHV0c1swXS50YXBJbnRlcm5hbEtleSA9IHVuZGVmaW5lZDtcclxuICAgICAgICBhc3NlcnQudGhyb3dzKFxyXG4gICAgICAgICAgKCkgPT5cclxuICAgICAgICAgICAgcHNidC5zaWduVGFwcm9vdE11c2lnMklucHV0KDAsIHtcclxuICAgICAgICAgICAgICBwdWJsaWNLZXk6IHdhbGxldEtleXMudXNlci5wdWJsaWNLZXksXHJcbiAgICAgICAgICAgICAgcHJpdmF0ZUtleTogd2FsbGV0S2V5cy51c2VyLnByaXZhdGVLZXkhLFxyXG4gICAgICAgICAgICB9KSxcclxuICAgICAgICAgIChlOiBhbnkpID0+IGUubWVzc2FnZSA9PT0gJ25vdCBhIHRhcHJvb3QgbXVzaWcyIGlucHV0J1xyXG4gICAgICAgICk7XHJcbiAgICAgICAgYXNzZXJ0LnN0cmljdEVxdWFsKHBzYnQuZ2V0UHJvcHJpZXRhcnlLZXlWYWxzKDApLmxlbmd0aCwgMyk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgaXQoJ29ubHkgdGhlIGNvc2lnbmVyIGNhbiBhZGQgYSBkZXRlcm1pbmlzdGljIHNpZ25hdHVyZScsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBjb25zdCBwc2J0ID0gY29uc3RydWN0UHNidChwMnRyTXVzaWcyVW5zcGVudCwgcm9vdFdhbGxldEtleXMsICd1c2VyJywgJ2JpdGdvJywgJ3Ayc2gnKTtcclxuICAgICAgICBwc2J0LnNldEFsbElucHV0c011c2lnMk5vbmNlSEQocm9vdFdhbGxldEtleXMudXNlcik7XHJcbiAgICAgICAgcHNidC5zZXRBbGxJbnB1dHNNdXNpZzJOb25jZUhEKHJvb3RXYWxsZXRLZXlzLmJpdGdvLCB7IGRldGVybWluaXN0aWM6IHRydWUgfSk7XHJcbiAgICAgICAgYXNzZXJ0LnRocm93cyhcclxuICAgICAgICAgICgpID0+IHBzYnQuc2lnbklucHV0SEQoMCwgcm9vdFdhbGxldEtleXMudXNlciwgeyBkZXRlcm1pbmlzdGljOiB0cnVlIH0pLFxyXG4gICAgICAgICAgKGU6IGFueSkgPT4gZS5tZXNzYWdlID09PSAnY2FuIG9ubHkgYWRkIGEgZGV0ZXJtaW5pc3RpYyBzaWduYXR1cmUgb24gdGhlIGNvc2lnbmVyJ1xyXG4gICAgICAgICk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgaXQoJ2Nvc2lnbmVyIGNhbiBzaWduIGRldGVybWluaXN0aWNhbGx5JywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGNvbnN0IHBzYnQgPSBjb25zdHJ1Y3RQc2J0KHAydHJNdXNpZzJVbnNwZW50LCByb290V2FsbGV0S2V5cywgJ3VzZXInLCAnYml0Z28nLCAncDJzaCcpO1xyXG4gICAgICAgIHBzYnQuc2V0QWxsSW5wdXRzTXVzaWcyTm9uY2VIRChyb290V2FsbGV0S2V5cy51c2VyKTtcclxuICAgICAgICBwc2J0LnNldEFsbElucHV0c011c2lnMk5vbmNlSEQocm9vdFdhbGxldEtleXMuYml0Z28sIHsgZGV0ZXJtaW5pc3RpYzogdHJ1ZSB9KTtcclxuICAgICAgICBwc2J0LnNpZ25BbGxJbnB1dHNIRChyb290V2FsbGV0S2V5cy51c2VyKTtcclxuICAgICAgICBwc2J0LnNpZ25BbGxJbnB1dHNIRChyb290V2FsbGV0S2V5cy5iaXRnbywgeyBkZXRlcm1pbmlzdGljOiB0cnVlIH0pO1xyXG4gICAgICAgIGFzc2VydC5vayhwc2J0LnZhbGlkYXRlU2lnbmF0dXJlc09mQWxsSW5wdXRzKCkpO1xyXG4gICAgICAgIGFzc2VydC5vayhwc2J0LmZpbmFsaXplQWxsSW5wdXRzKCkpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGl0KCdjb3NpZ25lciBjYW4gc2lnbiBub24tZGV0ZXJtaW5pc3RpY2FsbHknLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgY29uc3QgcHNidCA9IGNvbnN0cnVjdFBzYnQocDJ0ck11c2lnMlVuc3BlbnQsIHJvb3RXYWxsZXRLZXlzLCAndXNlcicsICdiaXRnbycsICdwMnNoJyk7XHJcbiAgICAgICAgcHNidC5zZXRBbGxJbnB1dHNNdXNpZzJOb25jZUhEKHJvb3RXYWxsZXRLZXlzLnVzZXIpO1xyXG4gICAgICAgIHBzYnQuc2V0QWxsSW5wdXRzTXVzaWcyTm9uY2VIRChyb290V2FsbGV0S2V5cy5iaXRnbywgeyBkZXRlcm1pbmlzdGljOiBmYWxzZSB9KTtcclxuICAgICAgICBwc2J0LnNpZ25BbGxJbnB1dHNIRChyb290V2FsbGV0S2V5cy51c2VyKTtcclxuICAgICAgICBwc2J0LnNpZ25BbGxJbnB1dHNIRChyb290V2FsbGV0S2V5cy5iaXRnbywgeyBkZXRlcm1pbmlzdGljOiBmYWxzZSB9KTtcclxuICAgICAgICBhc3NlcnQub2socHNidC52YWxpZGF0ZVNpZ25hdHVyZXNPZkFsbElucHV0cygpKTtcclxuICAgICAgICBhc3NlcnQub2socHNidC5maW5hbGl6ZUFsbElucHV0cygpKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdChgZmFpbHMgaWYgdGFwTWVya2xlUm9vdCBpcyBtaXNzaW5nYCwgZnVuY3Rpb24gKCkge1xyXG4gICAgICBjb25zdCBwc2J0ID0gY29uc3RydWN0UHNidChwMnRyTXVzaWcyVW5zcGVudCwgcm9vdFdhbGxldEtleXMsICd1c2VyJywgJ2JpdGdvJywgJ3Ayc2gnKTtcclxuXHJcbiAgICAgIGNvbnN0IHdhbGxldEtleXMgPSByb290V2FsbGV0S2V5cy5kZXJpdmVGb3JDaGFpbkFuZEluZGV4KHAydHJNdXNpZzJVbnNwZW50WzBdLmNoYWluLCBwMnRyTXVzaWcyVW5zcGVudFswXS5pbmRleCk7XHJcblxyXG4gICAgICBwc2J0LnNldEFsbElucHV0c011c2lnMk5vbmNlSEQocm9vdFdhbGxldEtleXMudXNlcik7XHJcbiAgICAgIHBzYnQuc2V0QWxsSW5wdXRzTXVzaWcyTm9uY2VIRChyb290V2FsbGV0S2V5cy5iaXRnbyk7XHJcblxyXG4gICAgICBwc2J0LmRhdGEuaW5wdXRzWzBdLnRhcE1lcmtsZVJvb3QgPSB1bmRlZmluZWQ7XHJcbiAgICAgIGFzc2VydC50aHJvd3MoXHJcbiAgICAgICAgKCkgPT5cclxuICAgICAgICAgIHBzYnQuc2lnblRhcHJvb3RNdXNpZzJJbnB1dCgwLCB7XHJcbiAgICAgICAgICAgIHB1YmxpY0tleTogd2FsbGV0S2V5cy51c2VyLnB1YmxpY0tleSxcclxuICAgICAgICAgICAgcHJpdmF0ZUtleTogd2FsbGV0S2V5cy51c2VyLnByaXZhdGVLZXkhLFxyXG4gICAgICAgICAgfSksXHJcbiAgICAgICAgKGU6IGFueSkgPT4gZS5tZXNzYWdlID09PSAnbm90IGEgdGFwcm9vdCBtdXNpZzIgaW5wdXQnXHJcbiAgICAgICk7XHJcbiAgICAgIGFzc2VydC5zdHJpY3RFcXVhbChwc2J0LmdldFByb3ByaWV0YXJ5S2V5VmFscygwKS5sZW5ndGgsIDMpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoYGZhaWxzIGlmIHBhcnRpY2lwYW50IHB1YiBrZXlzIGlzIG1pc3NpbmdgLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgIGNvbnN0IHBzYnQgPSBjb25zdHJ1Y3RQc2J0KHAydHJNdXNpZzJVbnNwZW50LCByb290V2FsbGV0S2V5cywgJ3VzZXInLCAnYml0Z28nLCAncDJzaCcpO1xyXG4gICAgICBwc2J0LnNldEFsbElucHV0c011c2lnMk5vbmNlSEQocm9vdFdhbGxldEtleXMudXNlcik7XHJcbiAgICAgIHBzYnQuc2V0QWxsSW5wdXRzTXVzaWcyTm9uY2VIRChyb290V2FsbGV0S2V5cy5iaXRnbyk7XHJcbiAgICAgIHBzYnQuZGF0YS5pbnB1dHNbMF0udW5rbm93bktleVZhbHMgPSBbXTtcclxuICAgICAgYXNzZXJ0LnRocm93cyhcclxuICAgICAgICAoKSA9PiBwc2J0LnNpZ25UYXByb290SW5wdXRIRCgwLCByb290V2FsbGV0S2V5cy51c2VyKSxcclxuICAgICAgICAoZTogYW55KSA9PiBlLm1lc3NhZ2UgPT09ICdGb3VuZCAwIG1hdGNoaW5nIHBhcnRpY2lwYW50IGtleSB2YWx1ZSBpbnN0ZWFkIG9mIDEnXHJcbiAgICAgICk7XHJcbiAgICAgIGFzc2VydC5zdHJpY3RFcXVhbChwc2J0LmdldFByb3ByaWV0YXJ5S2V5VmFscygwKS5sZW5ndGgsIDApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoYGZhaWxzIGlmIHNpZ25lciBwdWIga2V5IGlzIG5vdCBtYXRjaGluZyBhbnkgcGFydGljaXBhbnQgcHViIGtleXNgLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgIGNvbnN0IHBzYnQgPSBjb25zdHJ1Y3RQc2J0KHAydHJNdXNpZzJVbnNwZW50LCByb290V2FsbGV0S2V5cywgJ3VzZXInLCAnYml0Z28nLCAncDJzaCcpO1xyXG4gICAgICBwc2J0LnNldEFsbElucHV0c011c2lnMk5vbmNlSEQocm9vdFdhbGxldEtleXMudXNlcik7XHJcbiAgICAgIHBzYnQuc2V0QWxsSW5wdXRzTXVzaWcyTm9uY2VIRChyb290V2FsbGV0S2V5cy5iaXRnbyk7XHJcbiAgICAgIGFzc2VydC50aHJvd3MoXHJcbiAgICAgICAgKCkgPT5cclxuICAgICAgICAgIHBzYnQuc2lnblRhcHJvb3RNdXNpZzJJbnB1dCgwLCB7XHJcbiAgICAgICAgICAgIHByaXZhdGVLZXk6IHJvb3RXYWxsZXRLZXlzLmJhY2t1cC5wcml2YXRlS2V5ISxcclxuICAgICAgICAgICAgcHVibGljS2V5OiByb290V2FsbGV0S2V5cy5iYWNrdXAucHVibGljS2V5ISxcclxuICAgICAgICAgIH0pLFxyXG4gICAgICAgIChlOiBhbnkpID0+IGUubWVzc2FnZSA9PT0gJ3NpZ25lciBwdWIga2V5IHNob3VsZCBtYXRjaCBvbmUgb2YgcGFydGljaXBhbnQgcHViIGtleXMnXHJcbiAgICAgICk7XHJcbiAgICAgIGFzc2VydC5zdHJpY3RFcXVhbChwc2J0LmdldFByb3ByaWV0YXJ5S2V5VmFscygwKS5sZW5ndGgsIDMpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoYGZhaWxzIGlmIG1vcmUgdGhhbiAyIG5vbmNlIGtleSB2YWx1ZSBleGlzdHNgLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgIGNvbnN0IHBzYnQgPSBjb25zdHJ1Y3RQc2J0KHAydHJNdXNpZzJVbnNwZW50LCByb290V2FsbGV0S2V5cywgJ3VzZXInLCAnYml0Z28nLCAncDJzaCcpO1xyXG4gICAgICBwc2J0LnNldEFsbElucHV0c011c2lnMk5vbmNlSEQocm9vdFdhbGxldEtleXMudXNlcik7XHJcbiAgICAgIHBzYnQuc2V0QWxsSW5wdXRzTXVzaWcyTm9uY2VIRChyb290V2FsbGV0S2V5cy5iaXRnbyk7XHJcbiAgICAgIHBzYnQuZGF0YS5pbnB1dHNbMF0udW5rbm93bktleVZhbHM/LnB1c2gocHNidC5kYXRhLmlucHV0c1swXS51bmtub3duS2V5VmFsc1syXSk7XHJcbiAgICAgIGFzc2VydC50aHJvd3MoXHJcbiAgICAgICAgKCkgPT4gcHNidC5zaWduVGFwcm9vdElucHV0SEQoMCwgcm9vdFdhbGxldEtleXMudXNlciksXHJcbiAgICAgICAgKGU6IGFueSkgPT4gZS5tZXNzYWdlID09PSAnRm91bmQgMyBtYXRjaGluZyBub25jZSBrZXkgdmFsdWUgaW5zdGVhZCBvZiAxIG9yIDInXHJcbiAgICAgICk7XHJcbiAgICAgIGFzc2VydC5zdHJpY3RFcXVhbChwc2J0LmdldFByb3ByaWV0YXJ5S2V5VmFscygwKS5sZW5ndGgsIDQpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoYGZhaWxzIGlmIDIgbm9uY2Uga2V5IHZhbHVlIGRvIG5vdCBleGlzdGAsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgY29uc3QgcHNidCA9IGNvbnN0cnVjdFBzYnQocDJ0ck11c2lnMlVuc3BlbnQsIHJvb3RXYWxsZXRLZXlzLCAndXNlcicsICdiaXRnbycsICdwMnNoJyk7XHJcbiAgICAgIHBzYnQuc2V0QWxsSW5wdXRzTXVzaWcyTm9uY2VIRChyb290V2FsbGV0S2V5cy51c2VyKTtcclxuICAgICAgcHNidC5zZXRBbGxJbnB1dHNNdXNpZzJOb25jZUhEKHJvb3RXYWxsZXRLZXlzLmJpdGdvKTtcclxuICAgICAgcHNidC5kYXRhLmlucHV0c1swXS51bmtub3duS2V5VmFscz8uc3BsaWNlKDIpO1xyXG4gICAgICBhc3NlcnQudGhyb3dzKFxyXG4gICAgICAgICgpID0+IHBzYnQuc2lnblRhcHJvb3RJbnB1dEhEKDAsIHJvb3RXYWxsZXRLZXlzLnVzZXIpLFxyXG4gICAgICAgIChlOiBhbnkpID0+IGUubWVzc2FnZSA9PT0gJ0ZvdW5kIDEgbWF0Y2hpbmcgbm9uY2Uga2V5IHZhbHVlIGluc3RlYWQgb2YgMidcclxuICAgICAgKTtcclxuICAgICAgYXNzZXJ0LnN0cmljdEVxdWFsKHBzYnQuZ2V0UHJvcHJpZXRhcnlLZXlWYWxzKDApLmxlbmd0aCwgMik7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdChgZmFpbHMgaWYgbm9uY2Uga2V5ZGF0YSBzaXplIGlzIGludmFsaWRgLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgIGNvbnN0IHBzYnQgPSBjb25zdHJ1Y3RQc2J0KHAydHJNdXNpZzJVbnNwZW50LCByb290V2FsbGV0S2V5cywgJ3VzZXInLCAnYml0Z28nLCAncDJzaCcpO1xyXG4gICAgICBwc2J0LnNldEFsbElucHV0c011c2lnMk5vbmNlSEQocm9vdFdhbGxldEtleXMudXNlcik7XHJcbiAgICAgIHBzYnQuc2V0QWxsSW5wdXRzTXVzaWcyTm9uY2VIRChyb290V2FsbGV0S2V5cy5iaXRnbyk7XHJcblxyXG4gICAgICBjb25zdCBrZXlWYWxzID0gcHNidC5nZXRQcm9wcmlldGFyeUtleVZhbHMoMCwge1xyXG4gICAgICAgIGlkZW50aWZpZXI6IFBTQlRfUFJPUFJJRVRBUllfSURFTlRJRklFUixcclxuICAgICAgICBzdWJ0eXBlOiBQcm9wcmlldGFyeUtleVN1YnR5cGUuTVVTSUcyX1BVQl9OT05DRSxcclxuICAgICAgfSk7XHJcbiAgICAgIGtleVZhbHNbMV0ua2V5LmtleWRhdGEgPSBCdWZmZXIuY29uY2F0KFtrZXlWYWxzWzFdLmtleS5rZXlkYXRhLCBCdWZmZXIuZnJvbSgnZHVtbXknKV0pO1xyXG4gICAgICBwc2J0LmRhdGEuaW5wdXRzWzBdLnVua25vd25LZXlWYWxzPy5zcGxpY2UoMik7XHJcbiAgICAgIHBzYnQuYWRkUHJvcHJpZXRhcnlLZXlWYWxUb0lucHV0KDAsIGtleVZhbHNbMV0pO1xyXG4gICAgICBhc3NlcnQudGhyb3dzKFxyXG4gICAgICAgICgpID0+IHBzYnQuc2lnblRhcHJvb3RJbnB1dEhEKDAsIHJvb3RXYWxsZXRLZXlzLnVzZXIpLFxyXG4gICAgICAgIChlOiBhbnkpID0+IGUubWVzc2FnZSA9PT0gYEludmFsaWQga2V5ZGF0YSBzaXplICR7a2V5VmFsc1sxXS5rZXkua2V5ZGF0YS5sZW5ndGh9IGZvciBub25jZWBcclxuICAgICAgKTtcclxuICAgICAgYXNzZXJ0LnN0cmljdEVxdWFsKHBzYnQuZ2V0UHJvcHJpZXRhcnlLZXlWYWxzKDApLmxlbmd0aCwgMyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdChgZmFpbHMgaWYgbm9uY2UgdmFsdWVkYXRhIHNpemUgaXMgaW52YWxpZGAsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgY29uc3QgcHNidCA9IGNvbnN0cnVjdFBzYnQocDJ0ck11c2lnMlVuc3BlbnQsIHJvb3RXYWxsZXRLZXlzLCAndXNlcicsICdiaXRnbycsICdwMnNoJyk7XHJcbiAgICAgIHBzYnQuc2V0QWxsSW5wdXRzTXVzaWcyTm9uY2VIRChyb290V2FsbGV0S2V5cy51c2VyKTtcclxuICAgICAgcHNidC5zZXRBbGxJbnB1dHNNdXNpZzJOb25jZUhEKHJvb3RXYWxsZXRLZXlzLmJpdGdvKTtcclxuXHJcbiAgICAgIGNvbnN0IGtleVZhbHMgPSBwc2J0LmdldFByb3ByaWV0YXJ5S2V5VmFscygwLCB7XHJcbiAgICAgICAgaWRlbnRpZmllcjogUFNCVF9QUk9QUklFVEFSWV9JREVOVElGSUVSLFxyXG4gICAgICAgIHN1YnR5cGU6IFByb3ByaWV0YXJ5S2V5U3VidHlwZS5NVVNJRzJfUFVCX05PTkNFLFxyXG4gICAgICB9KTtcclxuICAgICAga2V5VmFsc1sxXS52YWx1ZSA9IEJ1ZmZlci5jb25jYXQoW2tleVZhbHNbMV0udmFsdWUsIEJ1ZmZlci5mcm9tKCdkdW1teScpXSk7XHJcbiAgICAgIHBzYnQuZGF0YS5pbnB1dHNbMF0udW5rbm93bktleVZhbHM/LnNwbGljZSgyKTtcclxuICAgICAgcHNidC5hZGRQcm9wcmlldGFyeUtleVZhbFRvSW5wdXQoMCwga2V5VmFsc1sxXSk7XHJcbiAgICAgIGFzc2VydC50aHJvd3MoXHJcbiAgICAgICAgKCkgPT4gcHNidC5zaWduVGFwcm9vdElucHV0SEQoMCwgcm9vdFdhbGxldEtleXMudXNlciksXHJcbiAgICAgICAgKGU6IGFueSkgPT4gZS5tZXNzYWdlID09PSBgSW52YWxpZCB2YWx1ZWRhdGEgc2l6ZSAke2tleVZhbHNbMV0udmFsdWUubGVuZ3RofSBmb3Igbm9uY2VgXHJcbiAgICAgICk7XHJcbiAgICAgIGFzc2VydC5zdHJpY3RFcXVhbChwc2J0LmdldFByb3ByaWV0YXJ5S2V5VmFscygwKS5sZW5ndGgsIDMpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoYGZhaWxzIGlmIG5vbmNlIGtleWRhdGEgaXMgaW52YWxpZGAsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgY29uc3QgcHNidCA9IGNvbnN0cnVjdFBzYnQocDJ0ck11c2lnMlVuc3BlbnQsIHJvb3RXYWxsZXRLZXlzLCAndXNlcicsICdiaXRnbycsICdwMnNoJyk7XHJcbiAgICAgIHBzYnQuc2V0QWxsSW5wdXRzTXVzaWcyTm9uY2VIRChyb290V2FsbGV0S2V5cy51c2VyKTtcclxuICAgICAgcHNidC5zZXRBbGxJbnB1dHNNdXNpZzJOb25jZUhEKHJvb3RXYWxsZXRLZXlzLmJpdGdvKTtcclxuXHJcbiAgICAgIGNvbnN0IGR1bW15Um9vdFdhbGxldEtleXMgPSBuZXcgUm9vdFdhbGxldEtleXMoZ2V0S2V5VHJpcGxlKCdkdW1teScpKTtcclxuICAgICAgY29uc3QgZHVtbXlQMnRyTXVzaWcyVW5zcGVudCA9IGdldFVuc3BlbnRzKFsncDJ0ck11c2lnMiddLCBkdW1teVJvb3RXYWxsZXRLZXlzKTtcclxuICAgICAgY29uc3QgZHVtbXlQc2J0ID0gY29uc3RydWN0UHNidChkdW1teVAydHJNdXNpZzJVbnNwZW50LCBkdW1teVJvb3RXYWxsZXRLZXlzLCAndXNlcicsICdiaXRnbycsICdwMnNoJyk7XHJcbiAgICAgIGR1bW15UHNidC5zZXRBbGxJbnB1dHNNdXNpZzJOb25jZUhEKGR1bW15Um9vdFdhbGxldEtleXMudXNlcik7XHJcbiAgICAgIGR1bW15UHNidC5zZXRBbGxJbnB1dHNNdXNpZzJOb25jZUhEKGR1bW15Um9vdFdhbGxldEtleXMuYml0Z28pO1xyXG5cclxuICAgICAgY29uc3QgZHVtbXlLZXlWYWxzID0gZHVtbXlQc2J0LmdldFByb3ByaWV0YXJ5S2V5VmFscygwLCB7XHJcbiAgICAgICAgaWRlbnRpZmllcjogUFNCVF9QUk9QUklFVEFSWV9JREVOVElGSUVSLFxyXG4gICAgICAgIHN1YnR5cGU6IFByb3ByaWV0YXJ5S2V5U3VidHlwZS5NVVNJRzJfUFVCX05PTkNFLFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIHBzYnQuZGF0YS5pbnB1dHNbMF0udW5rbm93bktleVZhbHM/LnNwbGljZSgxKTtcclxuICAgICAgZHVtbXlLZXlWYWxzLmZvckVhY2goKGt2LCBpKSA9PiBwc2J0LmFkZFByb3ByaWV0YXJ5S2V5VmFsVG9JbnB1dCgwLCBkdW1teUtleVZhbHNbaV0pKTtcclxuICAgICAgYXNzZXJ0LnRocm93cyhcclxuICAgICAgICAoKSA9PiBwc2J0LnNpZ25UYXByb290SW5wdXRIRCgwLCByb290V2FsbGV0S2V5cy51c2VyKSxcclxuICAgICAgICAoZTogYW55KSA9PiBlLm1lc3NhZ2UgPT09IGBJbnZhbGlkIG5vbmNlIGtleWRhdGEgcGFydGljaXBhbnQgcHViIGtleWBcclxuICAgICAgKTtcclxuICAgICAgYXNzZXJ0LnN0cmljdEVxdWFsKHBzYnQuZ2V0UHJvcHJpZXRhcnlLZXlWYWxzKDApLmxlbmd0aCwgMyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdChgZmFpbHMgaWYgbm9uY2Uga2V5ZGF0YSB0YXBPdXRwdXRLZXkgaXMgaW52YWxpZGAsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgY29uc3QgcHNidCA9IGNvbnN0cnVjdFBzYnQocDJ0ck11c2lnMlVuc3BlbnQsIHJvb3RXYWxsZXRLZXlzLCAndXNlcicsICdiaXRnbycsICdwMnNoJyk7XHJcbiAgICAgIHBzYnQuc2V0QWxsSW5wdXRzTXVzaWcyTm9uY2VIRChyb290V2FsbGV0S2V5cy51c2VyKTtcclxuICAgICAgcHNidC5zZXRBbGxJbnB1dHNNdXNpZzJOb25jZUhEKHJvb3RXYWxsZXRLZXlzLmJpdGdvKTtcclxuXHJcbiAgICAgIGNvbnN0IGtleVZhbHMgPSBwc2J0LmdldFByb3ByaWV0YXJ5S2V5VmFscygwLCB7XHJcbiAgICAgICAgaWRlbnRpZmllcjogUFNCVF9QUk9QUklFVEFSWV9JREVOVElGSUVSLFxyXG4gICAgICAgIHN1YnR5cGU6IFByb3ByaWV0YXJ5S2V5U3VidHlwZS5NVVNJRzJfUFVCX05PTkNFLFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGtleVZhbHNbMV0ua2V5LmtleWRhdGEgPSBCdWZmZXIuY29uY2F0KFtrZXlWYWxzWzFdLmtleS5rZXlkYXRhLnN1YmFycmF5KDAsIDMzKSwgZHVtbXlUYXBPdXRwdXRLZXldKTtcclxuXHJcbiAgICAgIHBzYnQuZGF0YS5pbnB1dHNbMF0udW5rbm93bktleVZhbHM/LnNwbGljZSgyKTtcclxuICAgICAgcHNidC5hZGRQcm9wcmlldGFyeUtleVZhbFRvSW5wdXQoMCwga2V5VmFsc1sxXSk7XHJcbiAgICAgIGFzc2VydC50aHJvd3MoXHJcbiAgICAgICAgKCkgPT4gcHNidC5zaWduVGFwcm9vdElucHV0SEQoMCwgcm9vdFdhbGxldEtleXMudXNlciksXHJcbiAgICAgICAgKGU6IGFueSkgPT4gZS5tZXNzYWdlID09PSBgSW52YWxpZCBub25jZSBrZXlkYXRhIHRhcE91dHB1dEtleWBcclxuICAgICAgKTtcclxuICAgICAgYXNzZXJ0LnN0cmljdEVxdWFsKHBzYnQuZ2V0UHJvcHJpZXRhcnlLZXlWYWxzKDApLmxlbmd0aCwgMyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ3AydHJNdXNpZzIgc2NyaXB0IHBhdGgnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICBpdChgcHNidCBjcmVhdGlvbiBzdWNjZXNzIGFuZCBtdXNpZzIgc2tpcHNgLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgIGxldCBwc2J0ID0gY29uc3RydWN0UHNidChwMnRyTXVzaWcyVW5zcGVudCwgcm9vdFdhbGxldEtleXMsICd1c2VyJywgJ2JhY2t1cCcsIG91dHB1dFR5cGUpO1xyXG4gICAgICBwc2J0LnNldEFsbElucHV0c011c2lnMk5vbmNlSEQocm9vdFdhbGxldEtleXMudXNlcik7XHJcbiAgICAgIHBzYnQuc2V0QWxsSW5wdXRzTXVzaWcyTm9uY2VIRChyb290V2FsbGV0S2V5cy5iYWNrdXApO1xyXG4gICAgICBhc3NlcnQuc3RyaWN0RXF1YWwocHNidC5nZXRQcm9wcmlldGFyeUtleVZhbHMoMCkubGVuZ3RoLCAwKTtcclxuICAgICAgcHNidC5zaWduQWxsSW5wdXRzSEQocm9vdFdhbGxldEtleXMudXNlcik7XHJcbiAgICAgIHBzYnQuc2lnbkFsbElucHV0c0hEKHJvb3RXYWxsZXRLZXlzLmJhY2t1cCk7XHJcbiAgICAgIHZhbGlkYXRlUHNidFAydHJNdXNpZzJJbnB1dChwc2J0LCAwLCBwMnRyTXVzaWcyVW5zcGVudFswXSwgJ3NjcmlwdFBhdGgnKTtcclxuICAgICAgdmFsaWRhdGVQc2J0UDJ0ck11c2lnMk91dHB1dChwc2J0LCAwKTtcclxuICAgICAgYXNzZXJ0Lm9rKHBzYnQudmFsaWRhdGVTaWduYXR1cmVzT2ZBbGxJbnB1dHMoKSk7XHJcbiAgICAgIHBzYnQuZmluYWxpemVBbGxJbnB1dHMoKTtcclxuICAgICAgdmFsaWRhdGVGaW5hbGl6ZWRJbnB1dChwc2J0LCAwLCBwMnRyTXVzaWcyVW5zcGVudFswXSwgJ3NjcmlwdFBhdGgnKTtcclxuICAgICAgbGV0IHR4ID0gcHNidC5leHRyYWN0VHJhbnNhY3Rpb24oKSBhcyBVdHhvVHJhbnNhY3Rpb248YmlnaW50PjtcclxuICAgICAgYXNzZXJ0Lm9rKHZlcmlmeUZ1bGx5U2lnbmVkU2lnbmF0dXJlcyh0eCwgcDJ0ck11c2lnMlVuc3BlbnQsIHJvb3RXYWxsZXRLZXlzLCAndXNlcicsICdiYWNrdXAnKSk7XHJcblxyXG4gICAgICBwc2J0ID0gY29uc3RydWN0UHNidChwMnRyTXVzaWcyVW5zcGVudCwgcm9vdFdhbGxldEtleXMsICdiaXRnbycsICdiYWNrdXAnLCBvdXRwdXRUeXBlKTtcclxuICAgICAgcHNidC5zZXRBbGxJbnB1dHNNdXNpZzJOb25jZUhEKHJvb3RXYWxsZXRLZXlzLmJpdGdvKTtcclxuICAgICAgcHNidC5zZXRBbGxJbnB1dHNNdXNpZzJOb25jZUhEKHJvb3RXYWxsZXRLZXlzLmJhY2t1cCk7XHJcbiAgICAgIHBzYnQuc2lnbkFsbElucHV0c0hEKHJvb3RXYWxsZXRLZXlzLmJpdGdvKTtcclxuICAgICAgcHNidC5zaWduQWxsSW5wdXRzSEQocm9vdFdhbGxldEtleXMuYmFja3VwKTtcclxuICAgICAgYXNzZXJ0LnN0cmljdEVxdWFsKHBzYnQuZ2V0UHJvcHJpZXRhcnlLZXlWYWxzKDApLmxlbmd0aCwgMCk7XHJcbiAgICAgIHZhbGlkYXRlUHNidFAydHJNdXNpZzJJbnB1dChwc2J0LCAwLCBwMnRyTXVzaWcyVW5zcGVudFswXSwgJ3NjcmlwdFBhdGgnKTtcclxuICAgICAgdmFsaWRhdGVQc2J0UDJ0ck11c2lnMk91dHB1dChwc2J0LCAwKTtcclxuICAgICAgYXNzZXJ0Lm9rKHBzYnQudmFsaWRhdGVTaWduYXR1cmVzT2ZBbGxJbnB1dHMoKSk7XHJcbiAgICAgIHBzYnQuZmluYWxpemVBbGxJbnB1dHMoKTtcclxuICAgICAgdmFsaWRhdGVGaW5hbGl6ZWRJbnB1dChwc2J0LCAwLCBwMnRyTXVzaWcyVW5zcGVudFswXSwgJ3NjcmlwdFBhdGgnKTtcclxuICAgICAgdHggPSBwc2J0LmV4dHJhY3RUcmFuc2FjdGlvbigpIGFzIFV0eG9UcmFuc2FjdGlvbjxiaWdpbnQ+O1xyXG4gICAgICBhc3NlcnQub2sodmVyaWZ5RnVsbHlTaWduZWRTaWduYXR1cmVzKHR4LCBwMnRyTXVzaWcyVW5zcGVudCwgcm9vdFdhbGxldEtleXMsICdiaXRnbycsICdiYWNrdXAnKSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdChgcGFyc2UgdHhgLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgIGNvbnN0IHBzYnQgPSBjb25zdHJ1Y3RQc2J0KHAydHJNdXNpZzJVbnNwZW50LCByb290V2FsbGV0S2V5cywgJ3VzZXInLCAnYmFja3VwJywgb3V0cHV0VHlwZSk7XHJcbiAgICAgIHZhbGlkYXRlUGFyc2VkVGFwcm9vdFNjcmlwdFBhdGhQc2J0KHBzYnQsIDAsICd1bnNpZ25lZCcpO1xyXG5cclxuICAgICAgcHNidC5zaWduQWxsSW5wdXRzSEQocm9vdFdhbGxldEtleXMudXNlcik7XHJcbiAgICAgIHZhbGlkYXRlUGFyc2VkVGFwcm9vdFNjcmlwdFBhdGhQc2J0KHBzYnQsIDAsICdoYWxmc2lnbmVkJyk7XHJcblxyXG4gICAgICBwc2J0LnNpZ25BbGxJbnB1dHNIRChyb290V2FsbGV0S2V5cy5iYWNrdXApO1xyXG4gICAgICB2YWxpZGF0ZVBhcnNlZFRhcHJvb3RTY3JpcHRQYXRoUHNidChwc2J0LCAwLCAnZnVsbHlzaWduZWQnKTtcclxuXHJcbiAgICAgIHBzYnQuZmluYWxpemVBbGxJbnB1dHMoKTtcclxuICAgICAgY29uc3QgdHggPSBwc2J0LmV4dHJhY3RUcmFuc2FjdGlvbigpIGFzIFV0eG9UcmFuc2FjdGlvbjxiaWdpbnQ+O1xyXG5cclxuICAgICAgY29uc3QgcHNidER1cGxpY2F0ZSA9IGNvbnN0cnVjdFBzYnQocDJ0ck11c2lnMlVuc3BlbnQsIHJvb3RXYWxsZXRLZXlzLCAndXNlcicsICdiYWNrdXAnLCBvdXRwdXRUeXBlKTtcclxuICAgICAgdmFsaWRhdGVQYXJzZWRUYXByb290U2NyaXB0UGF0aFR4SW5wdXQocHNidER1cGxpY2F0ZSwgdHgsIDApO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCd2YWxpZGF0ZSBwMnRyIE11c2lnMiBzaWduYXR1cmVzJywgZnVuY3Rpb24gKCkge1xyXG4gICAgaXQoYHZhbGlkYXRlIHdpdGggcHVia2V5YCwgZnVuY3Rpb24gKCkge1xyXG4gICAgICBjb25zdCB3YWxsZXRLZXlzID0gcm9vdFdhbGxldEtleXMuZGVyaXZlRm9yQ2hhaW5BbmRJbmRleChwMnRyTXVzaWcyVW5zcGVudFswXS5jaGFpbiwgcDJ0ck11c2lnMlVuc3BlbnRbMF0uaW5kZXgpO1xyXG4gICAgICBsZXQgcHNidCA9IGNvbnN0cnVjdFBzYnQocDJ0ck11c2lnMlVuc3BlbnQsIHJvb3RXYWxsZXRLZXlzLCAndXNlcicsICdiaXRnbycsIG91dHB1dFR5cGUpO1xyXG4gICAgICBwc2J0LnNldEFsbElucHV0c011c2lnMk5vbmNlKHdhbGxldEtleXMudXNlcik7XHJcbiAgICAgIHBzYnQuc2V0QWxsSW5wdXRzTXVzaWcyTm9uY2Uod2FsbGV0S2V5cy5iaXRnbyk7XHJcbiAgICAgIHBzYnQuc2lnbkFsbElucHV0c0hEKHJvb3RXYWxsZXRLZXlzLnVzZXIpO1xyXG4gICAgICBhc3NlcnQub2socHNidC52YWxpZGF0ZVRhcHJvb3RNdXNpZzJTaWduYXR1cmVzT2ZJbnB1dCgwLCB3YWxsZXRLZXlzLnVzZXIucHVibGljS2V5KSk7XHJcblxyXG4gICAgICBwc2J0ID0gY29uc3RydWN0UHNidChwMnRyTXVzaWcyVW5zcGVudCwgcm9vdFdhbGxldEtleXMsICd1c2VyJywgJ2JpdGdvJywgb3V0cHV0VHlwZSk7XHJcbiAgICAgIHBzYnQuc2V0SW5wdXRNdXNpZzJOb25jZSgwLCB3YWxsZXRLZXlzLnVzZXIpO1xyXG4gICAgICBwc2J0LnNldElucHV0TXVzaWcyTm9uY2VIRCgwLCByb290V2FsbGV0S2V5cy5iaXRnbyk7XHJcbiAgICAgIHBzYnQuc2lnbkFsbElucHV0c0hEKHJvb3RXYWxsZXRLZXlzLnVzZXIpO1xyXG4gICAgICBhc3NlcnQub2socHNidC52YWxpZGF0ZVRhcHJvb3RNdXNpZzJTaWduYXR1cmVzT2ZJbnB1dCgwLCB3YWxsZXRLZXlzLnVzZXIucHVibGljS2V5KSk7XHJcbiAgICAgIHBzYnQuc2lnbkFsbElucHV0c0hEKHJvb3RXYWxsZXRLZXlzLmJpdGdvKTtcclxuICAgICAgYXNzZXJ0Lm9rKHBzYnQudmFsaWRhdGVUYXByb290TXVzaWcyU2lnbmF0dXJlc09mSW5wdXQoMCwgd2FsbGV0S2V5cy5iaXRnby5wdWJsaWNLZXkpKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KGBmYWlscyBpZiBubyBzaWdgLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgIGNvbnN0IHdhbGxldEtleXMgPSByb290V2FsbGV0S2V5cy5kZXJpdmVGb3JDaGFpbkFuZEluZGV4KHAydHJNdXNpZzJVbnNwZW50WzBdLmNoYWluLCBwMnRyTXVzaWcyVW5zcGVudFswXS5pbmRleCk7XHJcbiAgICAgIGNvbnN0IHBzYnQgPSBjb25zdHJ1Y3RQc2J0KHAydHJNdXNpZzJVbnNwZW50LCByb290V2FsbGV0S2V5cywgJ3VzZXInLCAnYml0Z28nLCBvdXRwdXRUeXBlKTtcclxuICAgICAgYXNzZXJ0LnRocm93cyhcclxuICAgICAgICAoKSA9PiBwc2J0LnZhbGlkYXRlU2lnbmF0dXJlc09mQWxsSW5wdXRzKCksXHJcbiAgICAgICAgKGU6IGFueSkgPT4gZS5tZXNzYWdlID09PSBgTm8gc2lnbmF0dXJlcyB0byB2YWxpZGF0ZWBcclxuICAgICAgKTtcclxuXHJcbiAgICAgIHBzYnQuc2V0QWxsSW5wdXRzTXVzaWcyTm9uY2VIRChyb290V2FsbGV0S2V5cy51c2VyKTtcclxuICAgICAgcHNidC5zZXRBbGxJbnB1dHNNdXNpZzJOb25jZUhEKHJvb3RXYWxsZXRLZXlzLmJpdGdvKTtcclxuXHJcbiAgICAgIHBzYnQuc2lnbkFsbElucHV0c0hEKHJvb3RXYWxsZXRLZXlzLnVzZXIpO1xyXG5cclxuICAgICAgYXNzZXJ0LnRocm93cyhcclxuICAgICAgICAoKSA9PiBwc2J0LnZhbGlkYXRlVGFwcm9vdE11c2lnMlNpZ25hdHVyZXNPZklucHV0KDAsIHdhbGxldEtleXMuYml0Z28ucHVibGljS2V5KSxcclxuICAgICAgICAoZTogYW55KSA9PiBlLm1lc3NhZ2UgPT09IGBObyBzaWduYXR1cmVzIGZvciB0aGlzIHB1YmtleWBcclxuICAgICAgKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KGBmYWlscyBpZiBubyB0YXBJbnRlcm5hbEtleSBhbmQgdGFwTWVya2xlUm9vdGAsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgY29uc3Qgd2FsbGV0S2V5cyA9IHJvb3RXYWxsZXRLZXlzLmRlcml2ZUZvckNoYWluQW5kSW5kZXgocDJ0ck11c2lnMlVuc3BlbnRbMF0uY2hhaW4sIHAydHJNdXNpZzJVbnNwZW50WzBdLmluZGV4KTtcclxuICAgICAgY29uc3QgcHNidCA9IGNvbnN0cnVjdFBzYnQocDJ0ck11c2lnMlVuc3BlbnQsIHJvb3RXYWxsZXRLZXlzLCAndXNlcicsICdiaXRnbycsIG91dHB1dFR5cGUpO1xyXG4gICAgICBwc2J0LnNldEFsbElucHV0c011c2lnMk5vbmNlSEQocm9vdFdhbGxldEtleXMudXNlcik7XHJcbiAgICAgIHBzYnQuc2V0QWxsSW5wdXRzTXVzaWcyTm9uY2VIRChyb290V2FsbGV0S2V5cy5iaXRnbyk7XHJcbiAgICAgIHBzYnQuc2lnbkFsbElucHV0c0hEKHJvb3RXYWxsZXRLZXlzLnVzZXIpO1xyXG4gICAgICBwc2J0LnNpZ25BbGxJbnB1dHNIRChyb290V2FsbGV0S2V5cy5iaXRnbyk7XHJcblxyXG4gICAgICBjb25zdCB0YXBJbnRlcm5hbEtleSA9IHBzYnQuZGF0YS5pbnB1dHNbMF0udGFwSW50ZXJuYWxLZXk7XHJcbiAgICAgIHBzYnQuZGF0YS5pbnB1dHNbMF0udGFwSW50ZXJuYWxLZXkgPSB1bmRlZmluZWQ7XHJcbiAgICAgIGFzc2VydC50aHJvd3MoXHJcbiAgICAgICAgKCkgPT4gcHNidC52YWxpZGF0ZVRhcHJvb3RNdXNpZzJTaWduYXR1cmVzT2ZJbnB1dCgwKSxcclxuICAgICAgICAoZTogYW55KSA9PiBlLm1lc3NhZ2UgPT09IGBib3RoIHRhcEludGVybmFsS2V5IGFuZCB0YXBNZXJrbGVSb290IGFyZSByZXF1aXJlZGBcclxuICAgICAgKTtcclxuXHJcbiAgICAgIHBzYnQuZGF0YS5pbnB1dHNbMF0udGFwSW50ZXJuYWxLZXkgPSB0YXBJbnRlcm5hbEtleTtcclxuICAgICAgcHNidC5kYXRhLmlucHV0c1swXS50YXBNZXJrbGVSb290ID0gdW5kZWZpbmVkO1xyXG4gICAgICBhc3NlcnQudGhyb3dzKFxyXG4gICAgICAgICgpID0+IHBzYnQudmFsaWRhdGVUYXByb290TXVzaWcyU2lnbmF0dXJlc09mSW5wdXQoMCwgd2FsbGV0S2V5cy5iaXRnby5wdWJsaWNLZXkpLFxyXG4gICAgICAgIChlOiBhbnkpID0+IGUubWVzc2FnZSA9PT0gYGJvdGggdGFwSW50ZXJuYWxLZXkgYW5kIHRhcE1lcmtsZVJvb3QgYXJlIHJlcXVpcmVkYFxyXG4gICAgICApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoYGZhaWxzIGlmIG5vIG5vbmNlIGFuZCBzaWcgcHViIGtleSBtYXRjaGAsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgbGV0IHBzYnQgPSBjb25zdHJ1Y3RQc2J0KHAydHJNdXNpZzJVbnNwZW50LCByb290V2FsbGV0S2V5cywgJ3VzZXInLCAnYml0Z28nLCBvdXRwdXRUeXBlKTtcclxuICAgICAgcHNidC5zZXRBbGxJbnB1dHNNdXNpZzJOb25jZUhEKHJvb3RXYWxsZXRLZXlzLnVzZXIpO1xyXG4gICAgICBwc2J0LnNldEFsbElucHV0c011c2lnMk5vbmNlSEQocm9vdFdhbGxldEtleXMuYml0Z28pO1xyXG4gICAgICBwc2J0LnNpZ25BbGxJbnB1dHNIRChyb290V2FsbGV0S2V5cy51c2VyKTtcclxuICAgICAgcHNidC5zaWduQWxsSW5wdXRzSEQocm9vdFdhbGxldEtleXMuYml0Z28pO1xyXG5cclxuICAgICAgY29uc3QgcGFydGlhbFNpZ3MgPSBwc2J0LmdldFByb3ByaWV0YXJ5S2V5VmFscygwLCB7XHJcbiAgICAgICAgaWRlbnRpZmllcjogUFNCVF9QUk9QUklFVEFSWV9JREVOVElGSUVSLFxyXG4gICAgICAgIHN1YnR5cGU6IFByb3ByaWV0YXJ5S2V5U3VidHlwZS5NVVNJRzJfUEFSVElBTF9TSUcsXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgY29uc3QgbXlSb290V2FsbGV0S2V5cyA9IG5ldyBSb290V2FsbGV0S2V5cyhnZXRLZXlUcmlwbGUoJ2R1bW15JykpO1xyXG4gICAgICBjb25zdCBteVVuc3BlbnRzID0gZ2V0VW5zcGVudHMoWydwMnRyTXVzaWcyJ10sIG15Um9vdFdhbGxldEtleXMpO1xyXG4gICAgICBwc2J0ID0gY29uc3RydWN0UHNidChteVVuc3BlbnRzLCBteVJvb3RXYWxsZXRLZXlzLCAndXNlcicsICdiaXRnbycsIG91dHB1dFR5cGUpO1xyXG4gICAgICBwc2J0LnNldEFsbElucHV0c011c2lnMk5vbmNlSEQobXlSb290V2FsbGV0S2V5cy51c2VyKTtcclxuICAgICAgcHNidC5zZXRBbGxJbnB1dHNNdXNpZzJOb25jZUhEKG15Um9vdFdhbGxldEtleXMuYml0Z28pO1xyXG4gICAgICBwc2J0LnNpZ25BbGxJbnB1dHNIRChteVJvb3RXYWxsZXRLZXlzLnVzZXIpO1xyXG4gICAgICBwc2J0LnNpZ25BbGxJbnB1dHNIRChteVJvb3RXYWxsZXRLZXlzLmJpdGdvKTtcclxuXHJcbiAgICAgIGNvbnN0IHBhcnRpY2lwYW50cyA9IHBzYnQuZ2V0UHJvcHJpZXRhcnlLZXlWYWxzKDAsIHtcclxuICAgICAgICBpZGVudGlmaWVyOiBQU0JUX1BST1BSSUVUQVJZX0lERU5USUZJRVIsXHJcbiAgICAgICAgc3VidHlwZTogUHJvcHJpZXRhcnlLZXlTdWJ0eXBlLk1VU0lHMl9QQVJUSUNJUEFOVF9QVUJfS0VZUyxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCBub25jZXMgPSBwc2J0LmdldFByb3ByaWV0YXJ5S2V5VmFscygwLCB7XHJcbiAgICAgICAgaWRlbnRpZmllcjogUFNCVF9QUk9QUklFVEFSWV9JREVOVElGSUVSLFxyXG4gICAgICAgIHN1YnR5cGU6IFByb3ByaWV0YXJ5S2V5U3VidHlwZS5NVVNJRzJfUFVCX05PTkNFLFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIHBzYnQuZGF0YS5pbnB1dHNbMF0udW5rbm93bktleVZhbHMgPSB1bmRlZmluZWQ7XHJcbiAgICAgIHBzYnQuYWRkUHJvcHJpZXRhcnlLZXlWYWxUb0lucHV0KDAsIHBhcnRpY2lwYW50c1swXSk7XHJcbiAgICAgIHBzYnQuYWRkUHJvcHJpZXRhcnlLZXlWYWxUb0lucHV0KDAsIG5vbmNlc1swXSk7XHJcbiAgICAgIHBzYnQuYWRkUHJvcHJpZXRhcnlLZXlWYWxUb0lucHV0KDAsIG5vbmNlc1sxXSk7XHJcbiAgICAgIHBzYnQuYWRkUHJvcHJpZXRhcnlLZXlWYWxUb0lucHV0KDAsIHBhcnRpYWxTaWdzWzBdKTtcclxuICAgICAgcHNidC5hZGRQcm9wcmlldGFyeUtleVZhbFRvSW5wdXQoMCwgcGFydGlhbFNpZ3NbMV0pO1xyXG5cclxuICAgICAgYXNzZXJ0LnRocm93cyhcclxuICAgICAgICAoKSA9PiBwc2J0LnZhbGlkYXRlU2lnbmF0dXJlc09mQWxsSW5wdXRzKCksXHJcbiAgICAgICAgKGU6IGFueSkgPT4gZS5tZXNzYWdlID09PSBgRm91bmQgbm8gcHViIG5vbmNlIGZvciBwdWJrZXlgXHJcbiAgICAgICk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdChgZmFpbHMgaWYgbm8gdmFsaWQgc2lnYCwgZnVuY3Rpb24gKCkge1xyXG4gICAgICBjb25zdCBwc2J0ID0gY29uc3RydWN0UHNidChwMnRyTXVzaWcyVW5zcGVudCwgcm9vdFdhbGxldEtleXMsICd1c2VyJywgJ2JpdGdvJywgb3V0cHV0VHlwZSk7XHJcbiAgICAgIHBzYnQuc2V0QWxsSW5wdXRzTXVzaWcyTm9uY2VIRChyb290V2FsbGV0S2V5cy51c2VyKTtcclxuICAgICAgcHNidC5zZXRBbGxJbnB1dHNNdXNpZzJOb25jZUhEKHJvb3RXYWxsZXRLZXlzLmJpdGdvKTtcclxuICAgICAgcHNidC5zaWduQWxsSW5wdXRzSEQocm9vdFdhbGxldEtleXMudXNlcik7XHJcbiAgICAgIHBzYnQuc2lnbkFsbElucHV0c0hEKHJvb3RXYWxsZXRLZXlzLmJpdGdvKTtcclxuXHJcbiAgICAgIGNvbnN0IHBhcnRpYWxTaWdzID0gcHNidC5nZXRQcm9wcmlldGFyeUtleVZhbHMoMCwge1xyXG4gICAgICAgIGlkZW50aWZpZXI6IFBTQlRfUFJPUFJJRVRBUllfSURFTlRJRklFUixcclxuICAgICAgICBzdWJ0eXBlOiBQcm9wcmlldGFyeUtleVN1YnR5cGUuTVVTSUcyX1BBUlRJQUxfU0lHLFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIHBhcnRpYWxTaWdzWzFdLnZhbHVlID0gZHVtbXlQYXJ0aWFsU2lnO1xyXG4gICAgICBwc2J0LmFkZE9yVXBkYXRlUHJvcHJpZXRhcnlLZXlWYWxUb0lucHV0KDAsIHBhcnRpYWxTaWdzWzFdKTtcclxuXHJcbiAgICAgIGFzc2VydC5vayghcHNidC52YWxpZGF0ZVNpZ25hdHVyZXNPZkFsbElucHV0cygpKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnZmluYWxpemVUYXByb290TXVzaWcySW5wdXQnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICBpdCgnZmFpbHMgaWYgaW52YWxpZCBudW1iZXIgZm9yIHNpZ3MnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgIGNvbnN0IHBzYnQgPSBjb25zdHJ1Y3RQc2J0KHAydHJNdXNpZzJVbnNwZW50LCByb290V2FsbGV0S2V5cywgJ3VzZXInLCAnYml0Z28nLCBvdXRwdXRUeXBlKTtcclxuICAgICAgcHNidC5zZXRBbGxJbnB1dHNNdXNpZzJOb25jZUhEKHJvb3RXYWxsZXRLZXlzLnVzZXIpO1xyXG4gICAgICBwc2J0LnNldEFsbElucHV0c011c2lnMk5vbmNlSEQocm9vdFdhbGxldEtleXMuYml0Z28pO1xyXG4gICAgICBwc2J0LnNpZ25BbGxJbnB1dHNIRChyb290V2FsbGV0S2V5cy51c2VyKTtcclxuXHJcbiAgICAgIGFzc2VydC50aHJvd3MoXHJcbiAgICAgICAgKCkgPT4gcHNidC5maW5hbGl6ZUFsbElucHV0cygpLFxyXG4gICAgICAgIChlOiBhbnkpID0+IGUubWVzc2FnZSA9PT0gYGludmFsaWQgbnVtYmVyIG9mIHBhcnRpYWwgc2lnbmF0dXJlcyAxIHRvIGZpbmFsaXplYFxyXG4gICAgICApO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdQc2J0IG11c2lnMiBjb21tb24gZnVuY3Rpb25zJywgZnVuY3Rpb24gKCkge1xyXG4gICAgaXQoJ291dHB1dCBzY3JpcHQgc2hvdWxkIG1hdGNoIHRoZSBzY3JpcHRQdWJLZXkgaW4gdGhlIHByZXZvdXQnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgIGNvbnN0IG15Um9vdFdhbGxldEtleXMgPSBuZXcgUm9vdFdhbGxldEtleXMoZ2V0S2V5VHJpcGxlKCdkdW1teScpKTtcclxuICAgICAgY29uc3QgdW5zcGVudHMgPSBnZXRVbnNwZW50cyhcclxuICAgICAgICBzY3JpcHRUeXBlczJPZjMubWFwKCh0KSA9PiB0KSxcclxuICAgICAgICBteVJvb3RXYWxsZXRLZXlzXHJcbiAgICAgICk7XHJcblxyXG4gICAgICBjb25zdCBwc2J0ID0gY29uc3RydWN0UHNidCh1bnNwZW50cywgcm9vdFdhbGxldEtleXMsICd1c2VyJywgJ2JpdGdvJywgb3V0cHV0VHlwZSk7XHJcbiAgICAgIHVuc3BlbnRzLmZvckVhY2goKHUsIGluZGV4KSA9PiB7XHJcbiAgICAgICAgY29uc3Qgc2NyaXB0VHlwZSA9IHNjcmlwdFR5cGVGb3JDaGFpbih1LmNoYWluKTtcclxuICAgICAgICBhc3NlcnQudGhyb3dzKFxyXG4gICAgICAgICAgKCkgPT5cclxuICAgICAgICAgICAgc2NyaXB0VHlwZSA9PT0gJ3AydHJNdXNpZzInXHJcbiAgICAgICAgICAgICAgPyBwc2J0LnNldEFsbElucHV0c011c2lnMk5vbmNlSEQocm9vdFdhbGxldEtleXMudXNlcilcclxuICAgICAgICAgICAgICA6IHNjcmlwdFR5cGUgPT09ICdwMnRyJ1xyXG4gICAgICAgICAgICAgID8gcHNidC5zaWduVGFwcm9vdElucHV0SEQoaW5kZXgsIHJvb3RXYWxsZXRLZXlzLnVzZXIpXHJcbiAgICAgICAgICAgICAgOiBwc2J0LnNpZ25JbnB1dEhEKGluZGV4LCByb290V2FsbGV0S2V5cy51c2VyKSxcclxuICAgICAgICAgIChlOiBhbnkpID0+XHJcbiAgICAgICAgICAgIGlzU2Vnd2l0KHUuY2hhaW4pICYmIHNjcmlwdFR5cGUgIT09ICdwMnNoUDJ3c2gnXHJcbiAgICAgICAgICAgICAgPyBlLm1lc3NhZ2UgPT09IGBXaXRuZXNzIHNjcmlwdCBmb3IgaW5wdXQgIyR7aW5kZXh9IGRvZXNuJ3QgbWF0Y2ggdGhlIHNjcmlwdFB1YktleSBpbiB0aGUgcHJldm91dGBcclxuICAgICAgICAgICAgICA6IGUubWVzc2FnZSA9PT0gYFJlZGVlbSBzY3JpcHQgZm9yIGlucHV0ICMke2luZGV4fSBkb2Vzbid0IG1hdGNoIHRoZSBzY3JpcHRQdWJLZXkgaW4gdGhlIHByZXZvdXRgXHJcbiAgICAgICAgKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCBwMnRyTXVzaWcyU2NyaXB0UGF0aFBzYnQgPSBjb25zdHJ1Y3RQc2J0KFt1bnNwZW50c1s0XV0sIHJvb3RXYWxsZXRLZXlzLCAndXNlcicsICdiYWNrdXAnLCBvdXRwdXRUeXBlKTtcclxuICAgICAgYXNzZXJ0LnRocm93cyhcclxuICAgICAgICAoKSA9PiBwMnRyTXVzaWcyU2NyaXB0UGF0aFBzYnQuc2lnblRhcHJvb3RJbnB1dEhEKDAsIHJvb3RXYWxsZXRLZXlzLnVzZXIpLFxyXG4gICAgICAgIChlOiBhbnkpID0+IGUubWVzc2FnZSA9PT0gYFdpdG5lc3Mgc2NyaXB0IGZvciBpbnB1dCAjMCBkb2Vzbid0IG1hdGNoIHRoZSBzY3JpcHRQdWJLZXkgaW4gdGhlIHByZXZvdXRgXHJcbiAgICAgICk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdChgZGVjb2RlUHNidE11c2lnMlBhcnRpY2lwYW50c0tleVZhbERhdGEgZmFpbHMgaWYgaW52YWxpZCBzdWJ0eXBlIG9yIGlkZW50aWZpZXIgaXMgcGFzc2VkYCwgZnVuY3Rpb24gKCkge1xyXG4gICAgICBjb25zdCBrdiA9IHtcclxuICAgICAgICBrZXk6IHtcclxuICAgICAgICAgIGlkZW50aWZpZXI6ICdkdW1teScsXHJcbiAgICAgICAgICBzdWJ0eXBlOiAweDA1LFxyXG4gICAgICAgICAga2V5ZGF0YTogQnVmZmVyLmFsbG9jVW5zYWZlKDEpLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdmFsdWU6IEJ1ZmZlci5hbGxvY1Vuc2FmZSgxKSxcclxuICAgICAgfTtcclxuXHJcbiAgICAgIGFzc2VydC50aHJvd3MoXHJcbiAgICAgICAgKCkgPT4gZGVjb2RlUHNidE11c2lnMlBhcnRpY2lwYW50cyhrdiksXHJcbiAgICAgICAgKGU6IGFueSkgPT5cclxuICAgICAgICAgIGUubWVzc2FnZSA9PT0gYEludmFsaWQgaWRlbnRpZmllciAke2t2LmtleS5pZGVudGlmaWVyfSBvciBzdWJ0eXBlICR7a3Yua2V5LnN1YnR5cGV9IGZvciBwYXJ0aWNpcGFudHMgcHViIGtleXNgXHJcbiAgICAgICk7XHJcblxyXG4gICAgICBrdi5rZXkuaWRlbnRpZmllciA9IFBTQlRfUFJPUFJJRVRBUllfSURFTlRJRklFUjtcclxuICAgICAgYXNzZXJ0LnRocm93cyhcclxuICAgICAgICAoKSA9PiBkZWNvZGVQc2J0TXVzaWcyUGFydGljaXBhbnRzKGt2KSxcclxuICAgICAgICAoZTogYW55KSA9PlxyXG4gICAgICAgICAgZS5tZXNzYWdlID09PSBgSW52YWxpZCBpZGVudGlmaWVyICR7a3Yua2V5LmlkZW50aWZpZXJ9IG9yIHN1YnR5cGUgJHtrdi5rZXkuc3VidHlwZX0gZm9yIHBhcnRpY2lwYW50cyBwdWIga2V5c2BcclxuICAgICAgKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KGBkZWNvZGVQc2J0TXVzaWcyTm9uY2VLZXlWYWxEYXRhIGZhaWxzIGlmIGludmFsaWQgc3VidHlwZSBvciBpZGVudGlmaWVyIGlzIHBhc3NlZGAsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgY29uc3Qga3YgPSB7XHJcbiAgICAgICAga2V5OiB7XHJcbiAgICAgICAgICBpZGVudGlmaWVyOiAnZHVtbXknLFxyXG4gICAgICAgICAgc3VidHlwZTogMHgwNSxcclxuICAgICAgICAgIGtleWRhdGE6IEJ1ZmZlci5hbGxvY1Vuc2FmZSgxKSxcclxuICAgICAgICB9LFxyXG4gICAgICAgIHZhbHVlOiBCdWZmZXIuYWxsb2NVbnNhZmUoMSksXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBhc3NlcnQudGhyb3dzKFxyXG4gICAgICAgICgpID0+IGRlY29kZVBzYnRNdXNpZzJOb25jZShrdiksXHJcbiAgICAgICAgKGU6IGFueSkgPT4gZS5tZXNzYWdlID09PSBgSW52YWxpZCBpZGVudGlmaWVyICR7a3Yua2V5LmlkZW50aWZpZXJ9IG9yIHN1YnR5cGUgJHtrdi5rZXkuc3VidHlwZX0gZm9yIG5vbmNlYFxyXG4gICAgICApO1xyXG5cclxuICAgICAga3Yua2V5LmlkZW50aWZpZXIgPSBQU0JUX1BST1BSSUVUQVJZX0lERU5USUZJRVI7XHJcbiAgICAgIGFzc2VydC50aHJvd3MoXHJcbiAgICAgICAgKCkgPT4gZGVjb2RlUHNidE11c2lnMk5vbmNlKGt2KSxcclxuICAgICAgICAoZTogYW55KSA9PiBlLm1lc3NhZ2UgPT09IGBJbnZhbGlkIGlkZW50aWZpZXIgJHtrdi5rZXkuaWRlbnRpZmllcn0gb3Igc3VidHlwZSAke2t2LmtleS5zdWJ0eXBlfSBmb3Igbm9uY2VgXHJcbiAgICAgICk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdChgdmFsaWRhdGVQc2J0TXVzaWcyTm9uY2VzS2V5VmFsRGF0YSBmYWlscyBpZiBwYXJ0aWNpcGFudCBwdWIga2V5cyBhcmUgZHVwbGljYXRlYCwgZnVuY3Rpb24gKCkge1xyXG4gICAgICBjb25zdCBub25jZUtleVZhbERhdGEgPSBbMCwgMV0ubWFwKChpKSA9PiAoe1xyXG4gICAgICAgIHBhcnRpY2lwYW50UHViS2V5OiBkdW1teVBhcnRpY2lwYW50UHViS2V5c1tpXSxcclxuICAgICAgICB0YXBPdXRwdXRLZXk6IGR1bW15VGFwT3V0cHV0S2V5LFxyXG4gICAgICAgIHB1Yk5vbmNlOiBkdW1teVB1Yk5vbmNlLFxyXG4gICAgICB9KSk7XHJcblxyXG4gICAgICBsZXQgcGFydGljaXBhbnRLZXlWYWxEYXRhID0ge1xyXG4gICAgICAgIHBhcnRpY2lwYW50UHViS2V5czogZHVtbXlQYXJ0aWNpcGFudFB1YktleXMsXHJcbiAgICAgICAgdGFwSW50ZXJuYWxLZXk6IGR1bW15VGFwSW50ZXJuYWxLZXksXHJcbiAgICAgICAgdGFwT3V0cHV0S2V5OiBpbnZhbGlkVGFwT3V0cHV0S2V5LFxyXG4gICAgICB9O1xyXG5cclxuICAgICAgYXNzZXJ0LnRocm93cyhcclxuICAgICAgICAoKSA9PiBhc3NlcnRQc2J0TXVzaWcyTm9uY2VzKG5vbmNlS2V5VmFsRGF0YSwgcGFydGljaXBhbnRLZXlWYWxEYXRhKSxcclxuICAgICAgICAoZTogYW55KSA9PiBlLm1lc3NhZ2UgPT09IGBpbnZhbGlkIHNpemUgMS4gTXVzdCB1c2UgeC1vbmx5IGtleS5gXHJcbiAgICAgICk7XHJcblxyXG4gICAgICBwYXJ0aWNpcGFudEtleVZhbERhdGEgPSB7XHJcbiAgICAgICAgcGFydGljaXBhbnRQdWJLZXlzOiBbaW52YWxpZFBhcnRpY2lwYW50UHViS2V5c1swXSwgZHVtbXlQYXJ0aWNpcGFudFB1YktleXNbMF1dLFxyXG4gICAgICAgIHRhcEludGVybmFsS2V5OiBkdW1teVRhcEludGVybmFsS2V5LFxyXG4gICAgICAgIHRhcE91dHB1dEtleTogZHVtbXlUYXBPdXRwdXRLZXksXHJcbiAgICAgIH07XHJcbiAgICAgIGFzc2VydC50aHJvd3MoXHJcbiAgICAgICAgKCkgPT4gYXNzZXJ0UHNidE11c2lnMk5vbmNlcyhub25jZUtleVZhbERhdGEsIHBhcnRpY2lwYW50S2V5VmFsRGF0YSksXHJcbiAgICAgICAgKGU6IGFueSkgPT4gZS5tZXNzYWdlID09PSBgaW52YWxpZCBzaXplIDEuIE11c3QgdXNlIHBsYWluIGtleS5gXHJcbiAgICAgICk7XHJcblxyXG4gICAgICBwYXJ0aWNpcGFudEtleVZhbERhdGEgPSB7XHJcbiAgICAgICAgcGFydGljaXBhbnRQdWJLZXlzOiBbZHVtbXlQYXJ0aWNpcGFudFB1YktleXNbMF0sIGR1bW15UGFydGljaXBhbnRQdWJLZXlzWzBdXSxcclxuICAgICAgICB0YXBJbnRlcm5hbEtleTogZHVtbXlUYXBJbnRlcm5hbEtleSxcclxuICAgICAgICB0YXBPdXRwdXRLZXk6IGR1bW15VGFwT3V0cHV0S2V5LFxyXG4gICAgICB9O1xyXG4gICAgICBhc3NlcnQudGhyb3dzKFxyXG4gICAgICAgICgpID0+IGFzc2VydFBzYnRNdXNpZzJOb25jZXMobm9uY2VLZXlWYWxEYXRhLCBwYXJ0aWNpcGFudEtleVZhbERhdGEpLFxyXG4gICAgICAgIChlOiBhbnkpID0+IGUubWVzc2FnZSA9PT0gYER1cGxpY2F0ZSBwYXJ0aWNpcGFudCBwdWIga2V5cyBmb3VuZGBcclxuICAgICAgKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KGBjcmVhdGVUYXBUd2VhayBmYWlscyBpZiBpbnZhbGlkIHRhcEludGVybmFsS2V5IG9yIHRhcE1lcmtsZVJvb3QgaXMgcGFzc2VkYCwgZnVuY3Rpb24gKCkge1xyXG4gICAgICBhc3NlcnQudGhyb3dzKFxyXG4gICAgICAgICgpID0+IGNyZWF0ZVRhcFR3ZWFrKGludmFsaWRUYXBJbnB1dEtleSwgZHVtbXlUYXBPdXRwdXRLZXkpLFxyXG4gICAgICAgIChlOiBhbnkpID0+IGUubWVzc2FnZSA9PT0gYGludmFsaWQgc2l6ZSAxLiBNdXN0IHVzZSB4LW9ubHkga2V5LmBcclxuICAgICAgKTtcclxuXHJcbiAgICAgIGFzc2VydC50aHJvd3MoXHJcbiAgICAgICAgKCkgPT4gY3JlYXRlVGFwVHdlYWsoZHVtbXlUYXBJbnRlcm5hbEtleSwgaW52YWxpZFRhcE91dHB1dEtleSksXHJcbiAgICAgICAgKGU6IGFueSkgPT4gZS5tZXNzYWdlID09PSBgaW52YWxpZCBzaXplIDEuIE11c3QgdXNlIHRhcCBtZXJrbGUgcm9vdC5gXHJcbiAgICAgICk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdChgbXVzaWcyUGFydGlhbFNpZ24gZmFpbHMgaWYgaW52YWxpZCB0eEhhc2ggaXMgcGFzc2VkYCwgZnVuY3Rpb24gKCkge1xyXG4gICAgICBhc3NlcnQudGhyb3dzKFxyXG4gICAgICAgICgpID0+XHJcbiAgICAgICAgICBtdXNpZzJQYXJ0aWFsU2lnbihcclxuICAgICAgICAgICAgZHVtbXlQcml2YXRlS2V5LFxyXG4gICAgICAgICAgICBkdW1teVB1Yk5vbmNlLFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgcHVibGljS2V5OiBkdW1teVBhcnRpY2lwYW50UHViS2V5c1swXSxcclxuICAgICAgICAgICAgICBhZ2dOb25jZTogZHVtbXlBZ2dOb25jZSxcclxuICAgICAgICAgICAgICBtc2c6IGludmFsaWRUeEhhc2gsXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIG5ldyBNdXNpZzJOb25jZVN0b3JlKClcclxuICAgICAgICAgICksXHJcbiAgICAgICAgKGU6IGFueSkgPT4gZS5tZXNzYWdlID09PSBgaW52YWxpZCBzaXplIDEuIE11c3QgdXNlIHR4IGhhc2guYFxyXG4gICAgICApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoYGVuY29kZVBzYnRNdXNpZzJQYXJ0aWFsU2lnS2V5S2V5VmFsRGF0YSBmYWlscyBpZiBpbnZhbGlkIHR4SGFzaCBpcyBwYXNzZWRgLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgIGFzc2VydC50aHJvd3MoXHJcbiAgICAgICAgKCkgPT5cclxuICAgICAgICAgIGVuY29kZVBzYnRNdXNpZzJQYXJ0aWFsU2lnKHtcclxuICAgICAgICAgICAgcGFydGlhbFNpZzogaW52YWxpZFBhcnRpYWxTaWcsXHJcbiAgICAgICAgICAgIHBhcnRpY2lwYW50UHViS2V5OiBkdW1teVBhcnRpY2lwYW50UHViS2V5c1swXSxcclxuICAgICAgICAgICAgdGFwT3V0cHV0S2V5OiBkdW1teVRhcE91dHB1dEtleSxcclxuICAgICAgICAgIH0pLFxyXG4gICAgICAgIChlOiBhbnkpID0+IGUubWVzc2FnZSA9PT0gYEludmFsaWQgcGFydGlhbFNpZyBsZW5ndGggMWBcclxuICAgICAgKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KGBkZWxldGVQcm9wcmlldGFyeUtleVZhbHNgLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgIGNvbnN0IHBzYnQgPSBjb25zdHJ1Y3RQc2J0KHAydHJNdXNpZzJVbnNwZW50LCByb290V2FsbGV0S2V5cywgJ3VzZXInLCAnYml0Z28nLCBvdXRwdXRUeXBlKTtcclxuICAgICAgcHNidC5zZXRBbGxJbnB1dHNNdXNpZzJOb25jZUhEKHJvb3RXYWxsZXRLZXlzLnVzZXIpO1xyXG4gICAgICBwc2J0LnNldEFsbElucHV0c011c2lnMk5vbmNlSEQocm9vdFdhbGxldEtleXMuYml0Z28pO1xyXG4gICAgICBjb25zdCBrZXkgPSB7XHJcbiAgICAgICAgaWRlbnRpZmllcjogJ0RVTU1ZJyxcclxuICAgICAgICBzdWJ0eXBlOiAxMDAsXHJcbiAgICAgICAga2V5ZGF0YTogZHVtbXlUYXBPdXRwdXRLZXksXHJcbiAgICAgIH07XHJcbiAgICAgIHBzYnQuYWRkUHJvcHJpZXRhcnlLZXlWYWxUb0lucHV0KDAsIHsga2V5LCB2YWx1ZTogZHVtbXlUYXBJbnRlcm5hbEtleSB9KTtcclxuICAgICAgcHNidC5kZWxldGVQcm9wcmlldGFyeUtleVZhbHMoMCwgeyBpZGVudGlmaWVyOiBQU0JUX1BST1BSSUVUQVJZX0lERU5USUZJRVIgfSk7XHJcbiAgICAgIGNvbnN0IGtleVZhbCA9IHBzYnQuZ2V0UHJvcHJpZXRhcnlLZXlWYWxzKDApO1xyXG4gICAgICBhc3NlcnQuc3RyaWN0RXF1YWwoa2V5VmFsLmxlbmd0aCwgMSk7XHJcbiAgICAgIGFzc2VydC5zdHJpY3RFcXVhbChrZXlWYWxbMF0ua2V5LmlkZW50aWZpZXIsICdEVU1NWScpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn0pO1xyXG4iXX0=