"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const assert = require("assert");
const path = require("path");
const fs = require("fs-extra");
const src_1 = require("../../../src");
const bitgo_1 = require("../../../src/bitgo");
const testutil_1 = require("../../../src/testutil");
const network = src_1.networks.litecoin;
async function getFixture(name) {
    const p = path.join(__dirname, 'fixtures', name);
    return JSON.parse(await fs.readFile(p, 'utf-8'));
}
async function getFixtureAsBuffer(name) {
    return Buffer.from(await getFixture(name), 'hex');
}
async function getTransaction(mweb) {
    return (0, bitgo_1.createTransactionFromBuffer)(await getFixtureAsBuffer(`ltc-${mweb ? 'mweb-' : ''}transaction.json`), network, {
        amountType: 'bigint',
    });
}
describe('Litecoin Transaction', function () {
    it('mweb transaction gets round-tripped to a non-mweb transaction', async function () {
        const mweb = await getTransaction(true);
        assert(mweb instanceof bitgo_1.LitecoinTransaction);
        const nonMwebFixture = await getFixture(`ltc-transaction.json`);
        assert.deepStrictEqual(mweb.toHex(), nonMwebFixture);
    });
    it('non-mweb transaction gets round-tripped to a non-mweb transaction', async function () {
        const nonMweb = await getTransaction(false);
        assert(nonMweb instanceof bitgo_1.LitecoinTransaction);
        const nonMwebFixture = await getFixture(`ltc-transaction.json`);
        assert.deepStrictEqual(nonMweb.toHex(), nonMwebFixture);
    });
    it(`mweb transaction read from hex and buffer serialize to the same fixture`, async function () {
        const mweb = await getTransaction(true);
        const hex = await getFixture(`ltc-mweb-transaction.json`);
        const mwebBuffer = (0, bitgo_1.createTransactionFromBuffer)(Buffer.from(hex, 'hex'), network, { amountType: 'bigint' });
        assert.deepStrictEqual(mweb.toHex(), mwebBuffer.toHex());
    });
});
describe('Litecoin Psbt', function () {
    it('LitecoinPsbt can read hex of a mweb transaction', async function () {
        const mwebTransaction = await getTransaction(true);
        const psbt = (0, bitgo_1.createPsbtFromTransaction)(mwebTransaction, [
            {
                script: Buffer.from('f955ddd1845eb0cb2c4542ff04ace2695f9f88c6b7a1ac2fba0b91662cffacc9', 'hex'),
                value: BigInt(10000),
            },
        ]);
        assert(psbt instanceof bitgo_1.LitecoinPsbt);
        assert.deepStrictEqual(psbt.getUnsignedTx().toHex(), await getFixture(`ltc-transaction.json`));
    });
    it('can add an input to a psbt whose prev transaction has a mweb serialization', async function () {
        const rootWalletKeys = (0, testutil_1.getDefaultWalletKeys)();
        const buf = await getFixtureAsBuffer(`ltc-mweb-transaction.json`);
        const tx = await (0, bitgo_1.createTransactionFromBuffer)(buf, network, { amountType: 'bigint' });
        const psbt = (0, bitgo_1.createPsbtForNetwork)({ network });
        assert(psbt instanceof bitgo_1.LitecoinPsbt);
        const u = (0, testutil_1.mockWalletUnspent)(network, BigInt(9500), {
            chain: 0,
            index: 0,
            keys: rootWalletKeys,
            vout: 0,
            id: `${tx.getId()}:0`,
        });
        (0, bitgo_1.addWalletUnspentToPsbt)(psbt, {
            ...u,
            prevTx: buf,
        }, rootWalletKeys, 'user', 'bitgo');
        assert(psbt.data.inputs.length > 0);
        // Check that the previous transaction buffer added does not have a MWEB flag
        const prevTxBuffer = psbt.data.inputs[0].nonWitnessUtxo;
        assert(prevTxBuffer);
        assert.deepStrictEqual(prevTxBuffer.toString('hex'), await getFixture(`ltc-transaction.json`));
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibXdlYkJlaGF2aW9yLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vdGVzdC9iaXRnby9saXRlY29pbi9td2ViQmVoYXZpb3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxpQ0FBaUM7QUFFakMsNkJBQTZCO0FBQzdCLCtCQUErQjtBQUUvQixzQ0FBd0M7QUFDeEMsOENBUTRCO0FBQzVCLG9EQUFnRjtBQUVoRixNQUFNLE9BQU8sR0FBRyxjQUFRLENBQUMsUUFBUSxDQUFDO0FBRWxDLEtBQUssVUFBVSxVQUFVLENBQUksSUFBWTtJQUN2QyxNQUFNLENBQUMsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxVQUFVLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDakQsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQztBQUNuRCxDQUFDO0FBRUQsS0FBSyxVQUFVLGtCQUFrQixDQUFDLElBQVk7SUFDNUMsT0FBTyxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sVUFBVSxDQUFTLElBQUksQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDO0FBQzVELENBQUM7QUFFRCxLQUFLLFVBQVUsY0FBYyxDQUFDLElBQWE7SUFDekMsT0FBTyxJQUFBLG1DQUEyQixFQUFDLE1BQU0sa0JBQWtCLENBQUMsT0FBTyxJQUFJLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRSxrQkFBa0IsQ0FBQyxFQUFFLE9BQU8sRUFBRTtRQUNsSCxVQUFVLEVBQUUsUUFBUTtLQUNyQixDQUFDLENBQUM7QUFDTCxDQUFDO0FBRUQsUUFBUSxDQUFDLHNCQUFzQixFQUFFO0lBQy9CLEVBQUUsQ0FBQywrREFBK0QsRUFBRSxLQUFLO1FBQ3ZFLE1BQU0sSUFBSSxHQUFHLE1BQU0sY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3hDLE1B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QUFJO1NBQ3RCLENBQUMsQ0FBQztRQUVILElBQUEsOEJBQXNCLEVBQ3BCLElBQUksRUFDSjtZQUNFLEdBQUcsQ0FBQztZQUNKLE1BQU0sRUFBRSxHQUFHO1NBQ3VCLEVBQ3BDLGNBQWMsRUFDZCxNQUFNLEVBQ04sT0FBTyxDQUNSLENBQUM7UUFDRixNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBRXBDLDZFQUE2RTtRQUM3RSxNQUFNLFlBQVksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxjQUFjLENBQUM7UUFDeEQsTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQ3JCLE1BQU0sQ0FBQyxlQUFlLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsRUFBRSxNQUFNLFVBQVUsQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLENBQUM7SUFDakcsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGFzc2VydCBmcm9tICdhc3NlcnQnO1xyXG5cclxuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcclxuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMtZXh0cmEnO1xyXG5cclxuaW1wb3J0IHsgbmV0d29ya3MgfSBmcm9tICcuLi8uLi8uLi9zcmMnO1xyXG5pbXBvcnQge1xyXG4gIGFkZFdhbGxldFVuc3BlbnRUb1BzYnQsXHJcbiAgY3JlYXRlUHNidEZvck5ldHdvcmssXHJcbiAgY3JlYXRlUHNidEZyb21UcmFuc2FjdGlvbixcclxuICBjcmVhdGVUcmFuc2FjdGlvbkZyb21CdWZmZXIsXHJcbiAgTGl0ZWNvaW5Qc2J0LFxyXG4gIExpdGVjb2luVHJhbnNhY3Rpb24sXHJcbiAgTm9uV2l0bmVzc1dhbGxldFVuc3BlbnQsXHJcbn0gZnJvbSAnLi4vLi4vLi4vc3JjL2JpdGdvJztcclxuaW1wb3J0IHsgZ2V0RGVmYXVsdFdhbGxldEtleXMsIG1vY2tXYWxsZXRVbnNwZW50IH0gZnJvbSAnLi4vLi4vLi4vc3JjL3Rlc3R1dGlsJztcclxuXHJcbmNvbnN0IG5ldHdvcmsgPSBuZXR3b3Jrcy5saXRlY29pbjtcclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGdldEZpeHR1cmU8VD4obmFtZTogc3RyaW5nKTogUHJvbWlzZTxUPiB7XHJcbiAgY29uc3QgcCA9IHBhdGguam9pbihfX2Rpcm5hbWUsICdmaXh0dXJlcycsIG5hbWUpO1xyXG4gIHJldHVybiBKU09OLnBhcnNlKGF3YWl0IGZzLnJlYWRGaWxlKHAsICd1dGYtOCcpKTtcclxufVxyXG5cclxuYXN5bmMgZnVuY3Rpb24gZ2V0Rml4dHVyZUFzQnVmZmVyKG5hbWU6IHN0cmluZyk6IFByb21pc2U8QnVmZmVyPiB7XHJcbiAgcmV0dXJuIEJ1ZmZlci5mcm9tKGF3YWl0IGdldEZpeHR1cmU8c3RyaW5nPihuYW1lKSwgJ2hleCcpO1xyXG59XHJcblxyXG5hc3luYyBmdW5jdGlvbiBnZXRUcmFuc2FjdGlvbihtd2ViOiBib29sZWFuKTogUHJvbWlzZTxMaXRlY29pblRyYW5zYWN0aW9uPGJpZ2ludD4+IHtcclxuICByZXR1cm4gY3JlYXRlVHJhbnNhY3Rpb25Gcm9tQnVmZmVyKGF3YWl0IGdldEZpeHR1cmVBc0J1ZmZlcihgbHRjLSR7bXdlYiA/ICdtd2ViLScgOiAnJ310cmFuc2FjdGlvbi5qc29uYCksIG5ldHdvcmssIHtcclxuICAgIGFtb3VudFR5cGU6ICdiaWdpbnQnLFxyXG4gIH0pO1xyXG59XHJcblxyXG5kZXNjcmliZSgnTGl0ZWNvaW4gVHJhbnNhY3Rpb24nLCBmdW5jdGlvbiAoKSB7XHJcbiAgaXQoJ213ZWIgdHJhbnNhY3Rpb24gZ2V0cyByb3VuZC10cmlwcGVkIHRvIGEgbm9uLW13ZWIgdHJhbnNhY3Rpb24nLCBhc3luYyBmdW5jdGlvbiAoKSB7XHJcbiAgICBjb25zdCBtd2ViID0gYXdhaXQgZ2V0VHJhbnNhY3Rpb24odHJ1ZSk7XHJcbiAgICBhc3NlcnQobXdlYiBpbnN0YW5jZW9mIExpdGVjb2luVHJhbnNhY3Rpb24pO1xyXG4gICAgY29uc3Qgbm9uTXdlYkZpeHR1cmUgPSBhd2FpdCBnZXRGaXh0dXJlKGBsdGMtdHJhbnNhY3Rpb24uanNvbmApO1xyXG4gICAgYXNzZXJ0LmRlZXBTdHJpY3RFcXVhbChtd2ViLnRvSGV4KCksIG5vbk13ZWJGaXh0dXJlKTtcclxuICB9KTtcclxuXHJcbiAgaXQoJ25vbi1td2ViIHRyYW5zYWN0aW9uIGdldHMgcm91bmQtdHJpcHBlZCB0byBhIG5vbi1td2ViIHRyYW5zYWN0aW9uJywgYXN5bmMgZnVuY3Rpb24gKCkge1xyXG4gICAgY29uc3Qgbm9uTXdlYiA9IGF3YWl0IGdldFRyYW5zYWN0aW9uKGZhbHNlKTtcclxuXHJcbiAgICBhc3NlcnQobm9uTXdlYiBpbnN0YW5jZW9mIExpdGVjb2luVHJhbnNhY3Rpb24pO1xyXG5cclxuICAgIGNvbnN0IG5vbk13ZWJGaXh0dXJlID0gYXdhaXQgZ2V0Rml4dHVyZShgbHRjLXRyYW5zYWN0aW9uLmpzb25gKTtcclxuICAgIGFzc2VydC5kZWVwU3RyaWN0RXF1YWwobm9uTXdlYi50b0hleCgpLCBub25Nd2ViRml4dHVyZSk7XHJcbiAgfSk7XHJcblxyXG4gIGl0KGBtd2ViIHRyYW5zYWN0aW9uIHJlYWQgZnJvbSBoZXggYW5kIGJ1ZmZlciBzZXJpYWxpemUgdG8gdGhlIHNhbWUgZml4dHVyZWAsIGFzeW5jIGZ1bmN0aW9uICgpIHtcclxuICAgIGNvbnN0IG13ZWIgPSBhd2FpdCBnZXRUcmFuc2FjdGlvbih0cnVlKTtcclxuICAgIGNvbnN0IGhleDogc3RyaW5nID0gYXdhaXQgZ2V0Rml4dHVyZShgbHRjLW13ZWItdHJhbnNhY3Rpb24uanNvbmApO1xyXG4gICAgY29uc3QgbXdlYkJ1ZmZlciA9IGNyZWF0ZVRyYW5zYWN0aW9uRnJvbUJ1ZmZlcihCdWZmZXIuZnJvbShoZXgsICdoZXgnKSwgbmV0d29yaywgeyBhbW91bnRUeXBlOiAnYmlnaW50JyB9KTtcclxuICAgIGFzc2VydC5kZWVwU3RyaWN0RXF1YWwobXdlYi50b0hleCgpLCBtd2ViQnVmZmVyLnRvSGV4KCkpO1xyXG4gIH0pO1xyXG59KTtcclxuXHJcbmRlc2NyaWJlKCdMaXRlY29pbiBQc2J0JywgZnVuY3Rpb24gKCkge1xyXG4gIGl0KCdMaXRlY29pblBzYnQgY2FuIHJlYWQgaGV4IG9mIGEgbXdlYiB0cmFuc2FjdGlvbicsIGFzeW5jIGZ1bmN0aW9uICgpIHtcclxuICAgIGNvbnN0IG13ZWJUcmFuc2FjdGlvbiA9IGF3YWl0IGdldFRyYW5zYWN0aW9uKHRydWUpO1xyXG4gICAgY29uc3QgcHNidCA9IGNyZWF0ZVBzYnRGcm9tVHJhbnNhY3Rpb24obXdlYlRyYW5zYWN0aW9uLCBbXHJcbiAgICAgIHtcclxuICAgICAgICBzY3JpcHQ6IEJ1ZmZlci5mcm9tKCdmOTU1ZGRkMTg0NWViMGNiMmM0NTQyZmYwNGFjZTI2OTVmOWY4OGM2YjdhMWFjMmZiYTBiOTE2NjJjZmZhY2M5JywgJ2hleCcpLFxyXG4gICAgICAgIHZhbHVlOiBCaWdJbnQoMTAwMDApLFxyXG4gICAgICB9LFxyXG4gICAgXSk7XHJcbiAgICBhc3NlcnQocHNidCBpbnN0YW5jZW9mIExpdGVjb2luUHNidCk7XHJcbiAgICBhc3NlcnQuZGVlcFN0cmljdEVxdWFsKHBzYnQuZ2V0VW5zaWduZWRUeCgpLnRvSGV4KCksIGF3YWl0IGdldEZpeHR1cmUoYGx0Yy10cmFuc2FjdGlvbi5qc29uYCkpO1xyXG4gIH0pO1xyXG5cclxuICBpdCgnY2FuIGFkZCBhbiBpbnB1dCB0byBhIHBzYnQgd2hvc2UgcHJldiB0cmFuc2FjdGlvbiBoYXMgYSBtd2ViIHNlcmlhbGl6YXRpb24nLCBhc3luYyBmdW5jdGlvbiAoKSB7XHJcbiAgICBjb25zdCByb290V2FsbGV0S2V5cyA9IGdldERlZmF1bHRXYWxsZXRLZXlzKCk7XHJcblxyXG4gICAgY29uc3QgYnVmID0gYXdhaXQgZ2V0Rml4dHVyZUFzQnVmZmVyKGBsdGMtbXdlYi10cmFuc2FjdGlvbi5qc29uYCk7XHJcbiAgICBjb25zdCB0eCA9IGF3YWl0IGNyZWF0ZVRyYW5zYWN0aW9uRnJvbUJ1ZmZlcihidWYsIG5ldHdvcmssIHsgYW1vdW50VHlwZTogJ2JpZ2ludCcgfSk7XHJcblxyXG4gICAgY29uc3QgcHNidCA9IGNyZWF0ZVBzYnRGb3JOZXR3b3JrKHsgbmV0d29yayB9KTtcclxuICAgIGFzc2VydChwc2J0IGluc3RhbmNlb2YgTGl0ZWNvaW5Qc2J0KTtcclxuXHJcbiAgICBjb25zdCB1ID0gbW9ja1dhbGxldFVuc3BlbnQobmV0d29yaywgQmlnSW50KDk1MDApLCB7XHJcbiAgICAgIGNoYWluOiAwLFxyXG4gICAgICBpbmRleDogMCxcclxuICAgICAga2V5czogcm9vdFdhbGxldEtleXMsXHJcbiAgICAgIHZvdXQ6IDAsXHJcbiAgICAgIGlkOiBgJHt0eC5nZXRJZCgpfTowYCxcclxuICAgIH0pO1xyXG5cclxuICAgIGFkZFdhbGxldFVuc3BlbnRUb1BzYnQoXHJcbiAgICAgIHBzYnQsXHJcbiAgICAgIHtcclxuICAgICAgICAuLi51LFxyXG4gICAgICAgIHByZXZUeDogYnVmLFxyXG4gICAgICB9IGFzIE5vbldpdG5lc3NXYWxsZXRVbnNwZW50PGJpZ2ludD4sXHJcbiAgICAgIHJvb3RXYWxsZXRLZXlzLFxyXG4gICAgICAndXNlcicsXHJcbiAgICAgICdiaXRnbydcclxuICAgICk7XHJcbiAgICBhc3NlcnQocHNidC5kYXRhLmlucHV0cy5sZW5ndGggPiAwKTtcclxuXHJcbiAgICAvLyBDaGVjayB0aGF0IHRoZSBwcmV2aW91cyB0cmFuc2FjdGlvbiBidWZmZXIgYWRkZWQgZG9lcyBub3QgaGF2ZSBhIE1XRUIgZmxhZ1xyXG4gICAgY29uc3QgcHJldlR4QnVmZmVyID0gcHNidC5kYXRhLmlucHV0c1swXS5ub25XaXRuZXNzVXR4bztcclxuICAgIGFzc2VydChwcmV2VHhCdWZmZXIpO1xyXG4gICAgYXNzZXJ0LmRlZXBTdHJpY3RFcXVhbChwcmV2VHhCdWZmZXIudG9TdHJpbmcoJ2hleCcpLCBhd2FpdCBnZXRGaXh0dXJlKGBsdGMtdHJhbnNhY3Rpb24uanNvbmApKTtcclxuICB9KTtcclxufSk7XHJcbiJdfQ==